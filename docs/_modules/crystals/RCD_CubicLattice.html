
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>crystals.RCD_CubicLattice &#8212; script_inception_public  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for crystals.RCD_CubicLattice</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">BFDTD+GWL class system + GUI::</span>

<span class="sd">  class PhotonicCrystallineDiamond(object):</span>
<span class="sd">    \&#39;&#39;&#39;</span>
    <span class="n">Also</span> <span class="n">known</span> <span class="k">as</span><span class="p">:</span>
    <span class="o">-</span><span class="n">Photonic</span> <span class="n">Crystalline</span> <span class="n">Diamond</span> <span class="p">(</span><span class="n">PCD</span><span class="p">)</span>
    <span class="o">-</span><span class="n">ice</span> <span class="n">crystal</span>
    <span class="o">-</span><span class="n">spin</span><span class="o">-</span><span class="n">ice</span>
    <span class="o">-</span><span class="n">diamond</span>
    \<span class="s1">&#39;&#39;&#39;</span>

<span class="s1">    def __init__(self,</span>
<span class="s1">      mesh = None):</span>
<span class="s1">      return</span>

<span class="s1">  class PhotonicCrystallineDiamond_F_RD(PhotonicCrystallineDiamond):</span>
<span class="s1">    def __init__(self,</span>
<span class="s1">      mesh = None):</span>
<span class="s1">      return</span>

<span class="s1">But then we will want defects... :/ There is no way out. We need GUIs (with script support and parameter based structure design (like in RSOFT))...</span>

<span class="s1">idea: The RCD class should use generic lines/cylinders (independent of FDTD or GWL usage). It could even define multiple different ones (ex: vertical and non-vertical lines).</span>
<span class="s1">  These lines/cylinders could then be actually written using different classes: parallelepiped, spiral cylinder, flat lines, BFDTD cylinders, etc</span>
<span class="s1">  Depending on the chosen class (or maybe even class instance, which would then be copied over), different attributes like permittivity, writing direction, voxel distance, etc could then be defined.</span>
<span class="s1">  The generic crystal should store a list of lines to write with maybe an indication on whether or not to connect the current line to the next one ([a,b,c] instead of [[a,b],[b,c]]).</span>
<span class="s1">  (This mean it could be a GWLobject. The subclasses would just read the GWL object and replace A-B lines with some other random structure from A to B.)</span>
<span class="s1">  To optimize speed, it would be better to pass the &quot;line function&quot; to the writer process instead of first getting a list of lines and then looping through it again to write.</span>

<span class="s1">.. todo:: icecrystals with continuous lines</span>

<span class="s1">.. todo:: review this code and document it.</span>

<span class="s1">.. todo:: Parallepiped should also support inner+outer radius? :/</span>

<span class="s1">.. todo:: both BFDTD and GWL objects should have location/rotation properties -&gt; need more abstract parent class, which could also handle parenting, grouping, array modifiers, etc. Again, very similar to the Blender system. It might be worth checking out how Blender, FreeCAD, Cascade, LibreCAD, OpenEMS, VTK, etc handle this. 2D applications like for the FIB or e-beam lithography could also profit from it.</span>

<span class="s1">attributes:</span>

<span class="s1">  * output location (only used on writing, does not need to be an object attribute (except maybe for BFDTD or other classes writing multiple files)):</span>

<span class="s1">    * outdir&#39;, action=&quot;store&quot;, dest=&quot;outdir&quot;, default=tempfile.gettempdir(), help=&#39;output directory&#39;)</span>
<span class="s1">    * basename&#39;, action=&quot;store&quot;, dest=&quot;basename&quot;, default=&#39;RCD&#39;, help=&#39;output basename&#39;)</span>

<span class="s1">  * general RCD properties:</span>

<span class="s1">    * cube_side&quot;, help=&quot;length of unit cube side&quot;, type=float, default=2.8)</span>
<span class="s1">    * Nx&quot;, help=&quot;number of periods in the X direction&quot;, type=int, default=3)</span>
<span class="s1">    * Ny&quot;, help=&quot;number of periods in the Y direction&quot;, type=int, default=3)</span>
<span class="s1">    * Nz&quot;, help=&quot;number of periods in the Z direction&quot;, type=int, default=3)</span>
<span class="s1">    * &quot;--centro_X&quot;, help=&quot;Centre X position&quot;, type=float, default=0)</span>
<span class="s1">    * &quot;--centro_Y&quot;, help=&quot;Centre Y position&quot;, type=float, default=0)</span>
<span class="s1">    * &quot;--centro_Z&quot;, help=&quot;Centre Z position&quot;, type=float, default=0)</span>

<span class="s1">  * GWL:</span>
<span class="s1">  </span>
<span class="s1">    * special attributes (not sure where to put them):</span>
<span class="s1">    </span>
<span class="s1">      * TopDownWriting/downwardWriting&quot;, help=&quot;Write from top to bottom&quot;, action=&quot;store_true&quot;, default=True)</span>
<span class="s1">    </span>
<span class="s1">    * GWLobject properties:</span>
<span class="s1">    </span>
<span class="s1">      * &quot;--set-lower-to-origin&quot;, help=&#39;offset structure so that its &quot;lower corner&quot; is moved to the (0,0,0) coordinates. This will make all coordinates positive.&#39;, action=&quot;store_true&quot;)</span>

<span class="s1">      * GWL power compensation:</span>

<span class="s1">        * &quot;--write-power&quot;, help=&quot;Write power values using the power compensation (PC) parameters.&quot;, action=&quot;store_true&quot;)</span>
<span class="s1">        </span>
<span class="s1">        * &quot;--PC_laser_power_at_z0&quot;, help=&quot;PC: laser power at z0&quot;, type=float, default=100)</span>
<span class="s1">        * &quot;--PC_slope&quot;, help=&quot;PC: power compensation slope&quot;, type=float, default=0)</span>
<span class="s1">        * &quot;--PC_interfaceAt&quot;, help=&quot;PC: interface position&quot;, type=float, default=0)</span>
<span class="s1">        * &quot;--PC_bool_InverseWriting&quot;, help=&quot;PC: To write a file designed for use with the InvertZAxis command&quot;, action=&quot;store_true&quot;, default=False)</span>
<span class="s1">        * &quot;--PC_float_height&quot;, help=&#39;PC: &quot;substrate height&quot;, in practice just a value added to the interfaceAt value&#39;, type=float, default=0)</span>
<span class="s1">        * &quot;--PC_bool_LaserPowerCommand&quot;, help=&quot;PC: Use the LaserPower command instead of a 4th coordinate for power.&quot;, action=&quot;store_true&quot;, default=False)</span>

<span class="s1">    * GWL Parallelepiped:</span>
<span class="s1">    </span>
<span class="s1">      * rod_height&quot;, help=&quot;rod height&quot;, type=float, default=0.375)</span>
<span class="s1">      * rod_width&quot;, help=&quot;rod width&quot;, type=float, default=0.25)</span>
<span class="s1">      * connected&quot;, help=&quot;connect lines&quot;, action=&quot;store_true&quot;)</span>
<span class="s1">      * orthogonal&quot;, help=&#39;orthogonal &quot;z-axis&quot;&#39;, action=&quot;store_true&quot;)</span>
<span class="s1">      * axis0&quot;, help=&quot;index of axis 0&quot;, choices=[0,1,2],  default=0, type=int)</span>
<span class="s1">      * axis1&quot;, help=&quot;index of axis 1&quot;, choices=[0,1,2],  default=1, type=int)</span>
<span class="s1">      * axis2&quot;, help=&quot;index of axis 2&quot;, choices=[0,1,2],  default=2, type=int)</span>
<span class="s1">      * N0&quot;, help=&quot;number of lines along axis 0&quot;, type=int, default=3)</span>
<span class="s1">      * N1&quot;, help=&quot;number of lines along axis 1&quot;, type=int, default=3)</span>
<span class="s1">      * N2&quot;, help=&quot;number of lines along axis 2&quot;, type=int, default=3)</span>

<span class="s1">    * GWL Cylinder/Tube:</span>
<span class="s1">    </span>
<span class="s1">      * &quot;--method&quot;, help=&quot;writing method&quot;, type=str, choices=[&#39;spiral&#39;, &#39;vertical lines&#39;, &#39;horizontal disks&#39;],  default=&#39;spiral&#39;)</span>

<span class="s1">      * inner_radius</span>
<span class="s1">      * outer_radius</span>

<span class="s1">      * &quot;--PointDistance_r&quot;, help=&quot;PointDistance_r&quot;, type=float, default=0.2)</span>
<span class="s1">      * &quot;--PointDistance_theta&quot;, help=&quot;PointDistance_theta&quot;, type=float, default=0.2)</span>
<span class="s1">      * &quot;--PointDistance_z&quot;, help=&quot;PointDistance_z&quot;, type=float, default=0.2)</span>

<span class="s1">      * &quot;--zigzag&quot;, help=&quot;zigzag&quot;, action=&quot;store_true&quot;)</span>
<span class="s1">      * &quot;--rotateSpirals&quot;, help=&quot;rotateSpirals&quot;, action=&quot;store_true&quot;)</span>
<span class="s1">      * &quot;--add_flat_ends&quot;, help=&quot;add_flat_ends&quot;, action=&quot;store_true&quot;)</span>
<span class="s1">      * &quot;--closed_loop&quot;, help=&quot;closed_loop&quot;, action=&quot;store_true&quot;)</span>

<span class="s1">  * BFDTD:</span>

<span class="s1">    * BFDTD RCD properties:</span>
<span class="s1">  </span>
<span class="s1">      * cylinder_radius_normalized</span>

<span class="s1">      * BFDTD refractive indices:</span>

<span class="s1">        * n_defect</span>
<span class="s1">        * n_crystal</span>
<span class="s1">        * n_backfill</span>

<span class="s1">    * BFDTD .inp file:</span>

<span class="s1">      * fmin_normalized</span>
<span class="s1">      * fmax_normalized</span>
<span class="s1">    </span>
<span class="s1">    * BFDTD defect:</span>

<span class="s1">      * i_sub_defect</span>
<span class="s1">      * k_sub_defect</span>

<span class="s1">.. todo:: Create special &quot;line class&quot; or similar to add/replace lines with normal lines, cylinders, blocks and other crazy ideas... Maybe even general N-points -&gt; recipe conversions...</span>
<span class="s1">.. todo:: Optimize by not recalculating similar lines... (only 4 different line orientations in principle)</span>

<span class="s1">.. todo:: The *User* (yes, yes, that crazy guy...) might want to write the RCD &quot;line structures&quot; (cylinders, paras, etc) with different powers and not use the simple Z-based power compensation.</span>
<span class="s1">.. todo:: tapered RCD and other crazy stuff...</span>
<span class="s1">.. todo:: F-RD...</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">argparseui</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">linspace</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">bfdtd.BFDTDobject</span> <span class="k">import</span> <span class="n">BFDTDobject</span>
<span class="kn">from</span> <span class="nn">bfdtd.GeometryObjects</span> <span class="k">import</span> <span class="n">GeometryObject</span><span class="p">,</span> <span class="n">Sphere</span><span class="p">,</span> <span class="n">Block</span><span class="p">,</span> <span class="n">Distorted</span><span class="p">,</span> <span class="n">Parallelepiped</span><span class="p">,</span> <span class="n">Cylinder</span><span class="p">,</span> <span class="n">Rotation</span><span class="p">,</span> <span class="n">MeshBox</span>

<span class="kn">from</span> <span class="nn">bfdtd.excitation</span> <span class="k">import</span> <span class="n">Excitation</span><span class="p">,</span> <span class="n">ExcitationWithGaussianTemplate</span><span class="p">,</span> <span class="n">ExcitationWithUniformTemplate</span>
<span class="kn">from</span> <span class="nn">constants.physcon</span> <span class="k">import</span> <span class="n">get_c0</span>
<span class="kn">from</span> <span class="nn">GWL.GWL_parser</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">GWL.parallelepiped</span> <span class="k">import</span> <span class="n">Parallelepiped</span>

<div class="viewcode-block" id="RCD_CubicLattice"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_CubicLattice">[docs]</a><span class="k">class</span> <span class="nc">RCD_CubicLattice</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  .. note:: Keeping thing independent from GWL and BFDTD here for the moment.</span>

<span class="sd">  * cube_side: length of unit cube side</span>
<span class="sd">  * Nx: number of periods in the X direction</span>
<span class="sd">  * Ny: number of periods in the Y direction</span>
<span class="sd">  * Nz: number of periods in the Z direction</span>
<span class="sd">  * location</span>
<span class="sd">  * rotation (later)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nz</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; location &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span>
  <span class="nd">@location</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="RCD_CubicLattice.add_arguments"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_CubicLattice.add_arguments">[docs]</a>  <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--Nx&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of periods in the X direction&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--Ny&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of periods in the Y direction&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--Nz&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of periods in the Z direction&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cube_side&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;length of unit cube side&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--location_X&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;X position&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--location_Y&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Y position&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--location_Z&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Z position&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_CubicLattice.setAttributesFromParsedOptions"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_CubicLattice.setAttributesFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">cube_side</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">Nx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">Ny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nz</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">Nz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">options</span><span class="o">.</span><span class="n">location_X</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">location_Y</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">location_Z</span><span class="p">])</span>
    <span class="k">return</span></div>
    
  <span class="c1">#def line_structure_function(self, start_point, end_point):</span>
    <span class="c1">#self.addLine(start_point, end_point)</span>
    <span class="c1">#return</span>
    
<div class="viewcode-block" id="RCD_CubicLattice.createRCD"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_CubicLattice.createRCD">[docs]</a>  <span class="k">def</span> <span class="nf">createRCD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_structure_function</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. todo:: implement options for continuous writing:</span>
<span class="sd">        * line_structure_function(start_point, end_point, end_with_write, write_first_point)</span>
<span class="sd">        * start_point: array of size 3</span>
<span class="sd">        * end_point: array of size 3</span>
<span class="sd">        * end_with_write: True/False</span>
<span class="sd">        * write_first_point: True/False</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1">#line_structure_function([1,2,3],[4,5,6])</span>
    <span class="c1">#return</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span><span class="p">:</span>
      <span class="n">k_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">k_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nz</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_range</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
      <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.75</span>
      <span class="c1"># y = x + M + 0.5 lines</span>
      <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">:</span>
              <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
              <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
              <span class="n">line_structure_function</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

      <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.5</span>
      <span class="c1"># j = -i + M lines</span>
      <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">:</span>
              <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
              <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
              <span class="n">line_structure_function</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

      <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.25</span>
      <span class="c1"># j = i + M lines</span>
      <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)):</span>
          <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">:</span>
              <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
              <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
              <span class="n">line_structure_function</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

      <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">0</span>
      <span class="c1"># y = -x + M + 0.5 lines</span>
      <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">:</span>
              <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
              <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
              <span class="n">line_structure_function</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="k">return</span></div></div>

<div class="viewcode-block" id="RCD_GWL_Parallelepiped"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped">[docs]</a><span class="k">class</span> <span class="nc">RCD_GWL_Parallelepiped</span><span class="p">(</span><span class="n">GWLobject</span><span class="p">,</span> <span class="n">RCD_CubicLattice</span><span class="p">):</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">rod_height</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rod_width</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orthogonal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N0</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N1</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="k">return</span>

<div class="viewcode-block" id="RCD_GWL_Parallelepiped.add_arguments"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.add_arguments">[docs]</a>  <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--TopDownWriting&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Write from top to bottom&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--rod_height&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;rod height&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--rod_width&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;rod width&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--connected&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;connect lines&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--orthogonal&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;orthogonal &quot;z-axis&quot;&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--axis0&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;index of axis 0&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>  <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--axis1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;index of axis 1&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>  <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--axis2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;index of axis 2&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>  <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--N0&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of lines along axis 0&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--N1&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of lines along axis 1&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--N2&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of lines along axis 2&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span></div>
  
<div class="viewcode-block" id="RCD_GWL_Parallelepiped.get_argument_parser"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.get_argument_parser">[docs]</a>  <span class="k">def</span> <span class="nf">get_argument_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Create an RCD based on cubic unit cells and Parallelepiped objects.&#39;</span><span class="p">,</span> <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span><span class="s1">&#39;--outdir&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output directory&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="s1">&#39;--basename&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;basename&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;RCD&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output basename&#39;</span><span class="p">)</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span></div>
    
<div class="viewcode-block" id="RCD_GWL_Parallelepiped.setAttributesFromParsedOptions"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.setAttributesFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">TopDownWriting</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">rod_height</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">rod_height</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rod_width</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">rod_width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">connected</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orthogonal</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">orthogonal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">axis0</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">axis1</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">axis2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N0</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">N0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N1</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">N1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">N2</span>

    <span class="k">return</span></div>
    
<div class="viewcode-block" id="RCD_GWL_Parallelepiped.writeFromParsedOptions"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.writeFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">writeFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Options: &quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>    
    <span class="bp">self</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">computePoints</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateLimits</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeGWLWithPowerCompensation</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Parallelepiped.addParallelepiped"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.addParallelepiped">[docs]</a>  <span class="k">def</span> <span class="nf">addParallelepiped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">):</span>
    <span class="n">para</span> <span class="o">=</span> <span class="n">Parallelepiped</span><span class="p">()</span>
    <span class="n">para</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
    <span class="n">res_vec3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">N0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N2</span><span class="p">]</span>
    <span class="n">para</span><span class="o">.</span><span class="n">LineNumber_vec3</span> <span class="o">=</span> <span class="p">[</span><span class="n">res_vec3</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">res_vec3</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">res_vec3</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="n">para</span><span class="o">.</span><span class="n">setFromLine</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rod_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rod_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orthogonal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
    <span class="n">para</span><span class="o">.</span><span class="n">computePoints</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addGWLobject</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Parallelepiped.computePoints"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Parallelepiped.computePoints">[docs]</a>  <span class="k">def</span> <span class="nf">computePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">createRCD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addParallelepiped</span><span class="p">)</span>
    <span class="k">return</span></div></div>

<div class="viewcode-block" id="RCD_GWL_Cylinder"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder">[docs]</a><span class="k">class</span> <span class="nc">RCD_GWL_Cylinder</span><span class="p">(</span><span class="n">GWLobject</span><span class="p">,</span> <span class="n">RCD_CubicLattice</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  .. todo:: Use the tube class once rotated tubes are implemented.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">inner_radius</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outer_radius</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="s1">&#39;vertical lines&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_r</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_theta</span> <span class="o">=</span> <span class="mf">0.02</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_z</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zigzag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotateSpirals</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_flat_ends</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">closed_loop</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">return</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; method &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span>
  <span class="nd">@method</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">allowed_values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;spiral&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical lines&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontal disks&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">allowed_values</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;method must be one of:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">allowed_values</span><span class="p">))</span>

<div class="viewcode-block" id="RCD_GWL_Cylinder.add_arguments"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.add_arguments">[docs]</a>  <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--TopDownWriting&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Write from top to bottom&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--inner-radius&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--outer-radius&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--method&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;writing method&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spiral&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical lines&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontal disks&#39;</span><span class="p">],</span>  <span class="n">default</span><span class="o">=</span><span class="s1">&#39;spiral&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--PointDistance_r&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PointDistance_r&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--PointDistance_theta&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PointDistance_theta&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--PointDistance_z&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;PointDistance_z&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--zigzag&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;zigzag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--rotateSpirals&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;rotateSpirals&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--add_flat_ends&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;add_flat_ends&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--closed_loop&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;closed_loop&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Cylinder.get_argument_parser"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.get_argument_parser">[docs]</a>  <span class="k">def</span> <span class="nf">get_argument_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Create an RCD based on cubic unit cells and Parallelepiped objects.&#39;</span><span class="p">,</span> <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span><span class="s1">&#39;--outdir&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output directory&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="s1">&#39;--basename&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;basename&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;RCD&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output basename&#39;</span><span class="p">)</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span></div>
    
<div class="viewcode-block" id="RCD_GWL_Cylinder.writeFromParsedOptions"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.writeFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">writeFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Options: &quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>    
    <span class="bp">self</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">computePoints</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateLimits</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writeGWLWithPowerCompensation</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Cylinder.setAttributesFromParsedOptions"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.setAttributesFromParsedOptions">[docs]</a>  <span class="k">def</span> <span class="nf">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="n">RCD_CubicLattice</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">GWLobject</span><span class="o">.</span><span class="n">setAttributesFromParsedOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">TopDownWriting</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">TopDownWriting</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">inner_radius</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">inner_radius</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outer_radius</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">outer_radius</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_r</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">PointDistance_r</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_theta</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">PointDistance_theta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_z</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">PointDistance_z</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zigzag</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">zigzag</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotateSpirals</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">rotateSpirals</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_flat_ends</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">add_flat_ends</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">closed_loop</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">closed_loop</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Cylinder.addTube"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.addTube">[docs]</a>  <span class="k">def</span> <span class="nf">addTube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PC_laser_power_at_z0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PointDistance_theta</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="RCD_GWL_Cylinder.computePoints"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.RCD_GWL_Cylinder.computePoints">[docs]</a>  <span class="k">def</span> <span class="nf">computePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">createRCD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addTube</span><span class="p">)</span>
    <span class="k">return</span></div></div>

<div class="viewcode-block" id="createIceCrystal_GWL_singleLine_UnitcellByUnitcell"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.createIceCrystal_GWL_singleLine_UnitcellByUnitcell">[docs]</a><span class="k">def</span> <span class="nf">createIceCrystal_GWL_singleLine_UnitcellByUnitcell</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; unit cell by unit cell &#39;&#39;&#39;</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;IceCrystal&#39;</span>

  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">offset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

  <span class="n">crystal</span> <span class="o">=</span> <span class="n">GWLobject</span><span class="p">()</span>

  <span class="n">Nx</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">Ny</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="p">):</span>
      <span class="n">P0</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

      <span class="n">P1</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
      <span class="n">P2</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
      <span class="n">P3</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

      <span class="n">P4</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
      <span class="n">P5</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
      <span class="n">P6</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
      <span class="n">P7</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P0</span><span class="p">,</span><span class="n">P4</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span><span class="n">P4</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span><span class="n">P4</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span><span class="n">P4</span><span class="p">)</span>

      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P5</span><span class="p">,</span><span class="n">P0</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P6</span><span class="p">,</span><span class="n">P0</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span><span class="n">P0</span><span class="p">)</span>

      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">P5</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">P5</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">P5</span><span class="p">)</span>

      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">P6</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">P6</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">P6</span><span class="p">)</span>

      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">P7</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">P7</span><span class="p">)</span>
      <span class="n">crystal</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">P7</span><span class="p">)</span>

  <span class="p">(</span><span class="n">mini</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">getLimits</span><span class="p">()</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeGWL</span><span class="p">(</span><span class="n">DSTDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">,</span> <span class="n">writingOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-mini[0],-mini[1],-mini[2],0] )</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-0.5*(mini[0]+maxi[0]),-0.5*(mini[1]+maxi[1]),-mini[2],0] )</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="createIceCrystal_GWL_TopDown"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.createIceCrystal_GWL_TopDown">[docs]</a><span class="k">def</span> <span class="nf">createIceCrystal_GWL_TopDown</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; layer by layer &#39;&#39;&#39;</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;IceCrystalTopDown&#39;</span>
  <span class="c1">#name = &#39;createIceCrystal_GWL_TopDown.singleLines&#39;</span>
  <span class="c1">##  name = &#39;createIceCrystal_GWL_TopDown.linearCylinder.radius0.150&#39;</span>
  <span class="c1">##  name = &#39;createIceCrystal_GWL_TopDown.linearCylinder.radius0.500&#39;</span>

  <span class="c1">#a=1.600</span>
  <span class="c1">#a=3.200</span>
  <span class="c1">##  a=10/numpy.sqrt(2)</span>
  <span class="c1">##  cube_side = numpy.sqrt(2)*a</span>
  <span class="n">cube_side</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="n">offset</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

  <span class="n">crystal</span> <span class="o">=</span> <span class="n">GWLobject</span><span class="p">()</span>

  <span class="n">Nx</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">Ny</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">Nz</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="c1">##  outer_radius = 0.500</span>
  <span class="c1">##  outer_radius = 0.150</span>
  <span class="n">outer_radius</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">PointDistance_r</span> <span class="o">=</span> <span class="mf">0.150</span>
  <span class="n">PointDistance_theta</span> <span class="o">=</span> <span class="mf">0.150</span>

  <span class="c1"># TODO: Make lines continuous (should be one long zigzag line for each &quot;rod&quot;)</span>
  <span class="c1"># TODO: Flat lines instead of cylinders. WIP.</span>

  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.75</span>
    <span class="c1"># y = x + M + 0.5 lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.5</span>
    <span class="c1"># j = -i + M lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.25</span>
    <span class="c1"># j = i + M lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="n">Nx</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">0</span>
    <span class="c1"># y = -x + M + 0.5 lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

  <span class="p">(</span><span class="n">mini</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">getLimits</span><span class="p">()</span>

  <span class="n">crystal</span><span class="o">.</span><span class="n">writeGWL</span><span class="p">(</span><span class="n">DSTDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">,</span> <span class="n">writingOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-mini[0],-mini[1],-mini[2],0] )</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="createIceCrystal_GWL_TopDownFlatLines"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.createIceCrystal_GWL_TopDownFlatLines">[docs]</a><span class="k">def</span> <span class="nf">createIceCrystal_GWL_TopDownFlatLines</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; layer by layer &#39;&#39;&#39;</span>
  
  <span class="c1"># TODO: Alternate line direction in each layer to optimize speed</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;IceCrystalTopDownFlatLines&#39;</span>

  <span class="n">line_distance</span> <span class="o">=</span> <span class="mf">0.100</span>
  <span class="n">line_number</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="c1">##  name = &#39;createIceCrystal_GWL_TopDown.linearCylinder.radius0.150&#39;</span>
  <span class="c1">##  name = &#39;createIceCrystal_GWL_TopDown.linearCylinder.radius0.500&#39;</span>

  <span class="c1">#a=1.600</span>
  <span class="c1">#a=3.200</span>
  <span class="c1">##  a=10/numpy.sqrt(2)</span>
  <span class="c1">##  cube_side = numpy.sqrt(2)*a</span>
  <span class="n">cube_side</span> <span class="o">=</span> <span class="mi">10</span>

  <span class="n">offset</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

  <span class="n">crystal</span> <span class="o">=</span> <span class="n">GWLobject</span><span class="p">()</span>

  <span class="n">Nx</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">Ny</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">Nz</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="c1">#inner_radius = 0</span>

  <span class="c1">##  outer_radius = 0.500</span>
  <span class="c1">##  outer_radius = 0.150</span>
  <span class="c1">#outer_radius = 0</span>
  <span class="c1">#PointDistance_r = 0.150</span>
  <span class="c1">#PointDistance_theta = 0.150</span>

  <span class="c1"># TODO: Make lines continuous (should be one long zigzag line for each &quot;rod&quot;)</span>
  <span class="c1"># TODO: Flat lines instead of cylinders. WIP.</span>

  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.75</span>
    <span class="c1"># y = x + M + 0.5 lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addFlatLine</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">line_distance</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.5</span>
    <span class="c1"># j = -i + M lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addFlatLine</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">line_distance</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mf">0.25</span>
    <span class="c1"># j = i + M lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="n">Nx</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addFlatLine</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">line_distance</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">0</span>
    <span class="c1"># y = -x + M + 0.5 lines</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">crystal</span><span class="o">.</span><span class="n">addFlatLine</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">]),</span><span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">]),</span> <span class="n">line_distance</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

  <span class="p">(</span><span class="n">mini</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">getLimits</span><span class="p">()</span>

  <span class="n">crystal</span><span class="o">.</span><span class="n">writeGWL</span><span class="p">(</span><span class="n">DSTDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">,</span> <span class="n">writingOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-mini[0],-mini[1],-mini[2],0] )</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-0.5*(mini[0]+maxi[0]),-0.5*(mini[1]+maxi[1]),-mini[2],0] )</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-0.5*(mini[0]+maxi[0]), -0.5*(mini[1]+maxi[1]), -mini[2] ,0] )</span>
  <span class="c1">##  crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-7.5,-7.5,-7.5,0] )</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="createIceCrystal_GWL_WithCylinders"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.createIceCrystal_GWL_WithCylinders">[docs]</a><span class="k">def</span> <span class="nf">createIceCrystal_GWL_WithCylinders</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; unit cell by unit cell &#39;&#39;&#39;</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;IceCrystalWithCylinders&#39;</span>

  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="n">offset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

  <span class="n">crystal</span> <span class="o">=</span> <span class="n">GWLobject</span><span class="p">()</span>

  <span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="n">outer_radius</span> <span class="o">=</span> <span class="mf">0.3</span>
  <span class="n">PointDistance_r</span> <span class="o">=</span> <span class="mf">0.150</span>
  <span class="n">PointDistance_theta</span> <span class="o">=</span> <span class="mf">0.150</span>

  <span class="n">Nx</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">Ny</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="p">):</span>
         <span class="n">P0</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

         <span class="n">P1</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
         <span class="n">P2</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
         <span class="n">P3</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

         <span class="n">P4</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
         <span class="n">P5</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
         <span class="n">P6</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>
         <span class="n">P7</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">k</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]))</span>

         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P0</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P5</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P6</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">P5</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">P5</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">P5</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">P6</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">P6</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">P6</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">P7</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">P7</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>
         <span class="n">crystal</span><span class="o">.</span><span class="n">addLineCylinder</span><span class="p">(</span><span class="n">P1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">P7</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">inner_radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">PointDistance_r</span><span class="p">,</span> <span class="n">PointDistance_theta</span><span class="p">)</span>

  <span class="p">(</span><span class="n">mini</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">getLimits</span><span class="p">()</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeGWL</span><span class="p">(</span><span class="n">DSTDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.gwl&#39;</span><span class="p">,</span> <span class="n">writingOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-mini[0],-mini[1],-mini[2],0] )</span>
  <span class="c1">#crystal.writeGWL(DSTDIR + os.path.sep + name + &#39;.gwl&#39;, writingOffset = [-0.5*(mini[0]+maxi[0]),-0.5*(mini[1]+maxi[1]),-mini[2],0] )</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="createIceCrystal_BFDTD"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.createIceCrystal_BFDTD">[docs]</a><span class="k">def</span> <span class="nf">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  To prepare a BFDTD simulation with an RCD/FRD structure.</span>
<span class="sd">  </span>
<span class="sd">  .. warning:: FRD currently broken! + 2 backfills are created in the case of FRD. DO NOT USE AS IS!!!  </span>

<span class="sd">  BFDTD export WIP</span>
<span class="sd">  </span>
<span class="sd">  .. todo:: review this code and document it.</span>
<span class="sd">  .. todo:: Idea: Add clipping function to BFDTD to remove any objects outside a certain area. (could maybe even be extended to advanced boolean stuff! :) )</span>
<span class="sd">  </span>
<span class="sd">  * a : unit cube size</span>
<span class="sd">  * c0 : speed of light</span>
<span class="sd">  * Nx : number of periods in the X direction</span>
<span class="sd">  * Ny : number of periods in the Y direction</span>
<span class="sd">  * Nz : number of periods in the Z direction</span>
<span class="sd">  * n_defect : refractive index of the defect</span>
<span class="sd">  * n_crystal : refractive index of the crystal</span>
<span class="sd">  * n_backfill : refractive index of the backfill</span>
<span class="sd">  * cylinder_radius_normalized : r/a</span>
<span class="sd">  * excitation_frequency_normalized  : f/(c0/a)</span>
<span class="sd">  * fmin_normalized  : fmin/(c0/a)</span>
<span class="sd">  * fmax_normalized  : fmax/(c0/a)</span>

<span class="sd">  .. todo:: A lot of things:</span>
<span class="sd">  </span>
<span class="sd">    * Centre excitation on defect</span>
<span class="sd">    * Centre defect in sim box</span>
<span class="sd">    * adapt size of sim box to geometry</span>
<span class="sd">    * clip geometry to given bounding box</span>
<span class="sd">    * add epsilon sanpshots</span>
<span class="sd">    * add frequency snapshots</span>
<span class="sd">    * add time snapshots</span>
<span class="sd">    * make it easier to add excitation with specific orientation, size, bandwidth, etc</span>
<span class="sd">    * pass orientation through matrix/basis vectors</span>
<span class="sd">  </span>
<span class="sd">  working in mm, ms, kHz</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;PhotonicCrystallineDiamond&#39;</span>

  <span class="n">cube_side</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">cyl_length</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">outer_radius</span> <span class="o">=</span> <span class="n">cylinder_radius_normalized</span><span class="o">*</span><span class="n">cube_side</span>
  <span class="c1">#outer_radius = 0.123</span>
  <span class="c1">#cyl_length = 42</span>

  <span class="c1">#cyl_length = 3</span>
  <span class="c1">#n_crystal = 1</span>
  <span class="c1">#n_backfill = 3.3</span>
  
  <span class="c1"># number of periods in the X,Y,Z directions</span>
  <span class="c1"># Note: FRD is currently only correct when Nx=Ny (simple 90 degree rotation system)</span>
  <span class="c1">#Nx = 3</span>
  <span class="c1">#Ny = 3</span>
  <span class="c1">#Nz = 3</span>
  <span class="c1">#cube_side = (4/sqrt(3))*cyl_length</span>
  <span class="c1">#outer_radius = 0.26*cyl_length</span>
  <span class="c1">#outer_radius = 0.263018408555208*cube_side</span>
  <span class="c1">#fmin_kHz = 18e6</span>
  <span class="c1">#fmax_kHz = 35e6</span>
  <span class="c1">#f0 = 0.5*(fmin_kHz+fmax_kHz)</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="c1">#f0 = excitation_frequency_normalized*get_c0()/cube_side</span>
  <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin_normalized</span><span class="o">*</span><span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">cube_side</span>
  <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax_normalized</span><span class="o">*</span><span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">cube_side</span>

  <span class="n">f0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fmin</span><span class="o">+</span><span class="n">fmax</span><span class="p">)</span>
  <span class="n">Lambda_mm</span> <span class="o">=</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">f0</span>
  <span class="n">probe_distance</span> <span class="o">=</span> <span class="n">cyl_length</span>
  <span class="n">dipole_length</span> <span class="o">=</span> <span class="n">outer_radius</span>

  <span class="c1">#line_distance = 0.1</span>
  <span class="c1">#line_number = 3</span>
  <span class="c1">#rod_height = 0.05</span>
  <span class="c1">#rod_width = 0.05</span>
  <span class="c1">#orientation = [2,0,1]</span>
  <span class="c1">#orthogonal = True</span>
  <span class="n">offset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">PointDistance_r</span> <span class="o">=</span> <span class="mf">0.150</span>
  <span class="n">PointDistance_theta</span> <span class="o">=</span> <span class="mf">0.150</span>

  <span class="c1"># defect parameters</span>
  <span class="n">i_defect</span> <span class="o">=</span> <span class="n">Nx</span><span class="o">//</span><span class="mi">2</span>
  <span class="n">j_defect</span> <span class="o">=</span> <span class="n">Ny</span><span class="o">//</span><span class="mi">2</span>
  <span class="n">k_defect</span> <span class="o">=</span> <span class="n">Nz</span><span class="o">//</span><span class="mi">2</span>
  <span class="c1">#i_sub_defect = 0</span>
  <span class="c1">#k_sub_defect = 1</span>
  <span class="c1">#n_defect = 4</span>

  <span class="n">defect_list</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">crystal</span> <span class="o">=</span> <span class="n">BFDTDobject</span><span class="p">()</span>
  
  <span class="n">backfill</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">backfill</span><span class="p">)</span>

  <span class="c1"># k : index of current &quot;Z-layer&quot;</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    
    <span class="n">k_sub</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">k_sub</span><span class="o">*</span><span class="mf">0.25</span>
    <span class="c1"># y = x + M + 0.5 lines</span>
    <span class="n">M_defect</span> <span class="o">=</span> <span class="n">j_defect</span> <span class="o">-</span> <span class="n">i_defect</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
            <span class="n">cyl</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">()</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setInnerRadius</span><span class="p">(</span><span class="n">inner_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setOuterRadius</span><span class="p">(</span><span class="n">outer_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setStartEndPoints</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(((</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">cube_side</span><span class="p">)</span>
            <span class="c1">#print(&#39;(k={}, k_defect={}, M={}, M_defect={}, i={}, i_defect={}, i_sub={}, i_sub_defect={}, k_sub={}, k_sub_defect={})&#39;.format(k,k_defect,M,M_defect,i,i_defect,i_sub,i_sub_defect,k_sub,k_sub_defect))</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">k_defect</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="n">j_defect</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">i_defect</span> <span class="ow">and</span> <span class="n">i_sub</span> <span class="o">==</span> <span class="n">i_sub_defect</span> <span class="ow">and</span> <span class="n">k_sub</span> <span class="o">==</span> <span class="n">k_sub_defect</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;defect&#39;</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_defect</span><span class="p">)</span>
              <span class="n">defect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added defect!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_crystal</span><span class="p">)</span>
              <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
          <span class="c1">#else:</span>
            <span class="c1">#print(&#39;This should not happen&#39;, file=sys.stderr)</span>

    <span class="n">k_sub</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">k_sub</span><span class="o">*</span><span class="mf">0.25</span>
    <span class="c1"># y = -x + M lines</span>
    <span class="n">M_defect</span> <span class="o">=</span> <span class="n">j_defect</span> <span class="o">+</span> <span class="n">i_defect</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
            <span class="n">cyl</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">()</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setInnerRadius</span><span class="p">(</span><span class="n">inner_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setOuterRadius</span><span class="p">(</span><span class="n">outer_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setStartEndPoints</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="c1">#print((k,k_defect,M-1,M_defect,i,i_defect,i_sub,i_sub_defect,k_sub,k_sub_defect))</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">k_defect</span> <span class="ow">and</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">M_defect</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">i_defect</span> <span class="ow">and</span> <span class="n">i_sub</span> <span class="o">==</span> <span class="n">i_sub_defect</span> <span class="ow">and</span> <span class="n">k_sub</span> <span class="o">==</span> <span class="n">k_sub_defect</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;defect&#39;</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_defect</span><span class="p">)</span>
              <span class="n">defect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added defect!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_crystal</span><span class="p">)</span>
              <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
          <span class="c1">#else:</span>
            <span class="c1">#print(&#39;This should not happen&#39;, file=sys.stderr)</span>

    <span class="n">k_sub</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">k_sub</span><span class="o">*</span><span class="mf">0.25</span>
    <span class="c1"># y = x + M lines</span>
    <span class="n">M_defect</span> <span class="o">=</span> <span class="n">j_defect</span> <span class="o">-</span> <span class="n">i_defect</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="n">M</span><span class="p">,</span><span class="n">Nx</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">M</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
            <span class="n">cyl</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">()</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setInnerRadius</span><span class="p">(</span><span class="n">inner_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setOuterRadius</span><span class="p">(</span><span class="n">outer_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setStartEndPoints</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="c1">#print((k,k_defect,M,M_defect,i,i_defect,i_sub,i_sub_defect,k_sub,k_sub_defect))</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">k_defect</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">==</span> <span class="n">M_defect</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">i_defect</span> <span class="ow">and</span> <span class="n">i_sub</span> <span class="o">==</span> <span class="n">i_sub_defect</span> <span class="ow">and</span> <span class="n">k_sub</span> <span class="o">==</span> <span class="n">k_sub_defect</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;defect&#39;</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_defect</span><span class="p">)</span>
              <span class="n">defect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added defect!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_crystal</span><span class="p">)</span>
              <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
          <span class="c1">#else:</span>
            <span class="c1">#print(&#39;This should not happen&#39;, file=sys.stderr)</span>

    <span class="n">k_sub</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">k_sub</span><span class="o">*</span><span class="mf">0.25</span>
    <span class="c1"># y = -x + M + 0.5 lines</span>
    <span class="n">M_defect</span> <span class="o">=</span> <span class="n">j_defect</span> <span class="o">+</span> <span class="n">i_defect</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="o">+</span><span class="n">Ny</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i_sub</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z1</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i_sub</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
          <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x2</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.5</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">Z</span><span class="o">+</span><span class="mf">0.25</span><span class="o">*</span><span class="p">((</span><span class="n">i_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x1</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">x2</span><span class="o">&lt;=</span><span class="n">Nx</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y1</span><span class="o">&lt;=</span><span class="n">Ny</span> <span class="ow">and</span> <span class="mi">0</span><span class="o">&lt;=</span><span class="n">y2</span><span class="o">&lt;=</span><span class="n">Ny</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">])</span>
            <span class="n">cyl</span> <span class="o">=</span> <span class="n">Cylinder</span><span class="p">()</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setInnerRadius</span><span class="p">(</span><span class="n">inner_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setOuterRadius</span><span class="p">(</span><span class="n">outer_radius</span><span class="p">)</span>
            <span class="n">cyl</span><span class="o">.</span><span class="n">setStartEndPoints</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(((</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">cube_side</span><span class="p">)</span>
            <span class="c1">#print(&#39;(k={}, k_defect={}, M={}, M_defect={}, i={}, i_defect={}, i_sub={}, i_sub_defect={}, k_sub={}, k_sub_defect={})&#39;.format(k,k_defect,M,M_defect,i,i_defect,i_sub,i_sub_defect,k_sub,k_sub_defect))</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">k_defect</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="n">j_defect</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">i_defect</span> <span class="ow">and</span> <span class="n">i_sub</span> <span class="o">==</span> <span class="n">i_sub_defect</span> <span class="ow">and</span> <span class="n">k_sub</span> <span class="o">==</span> <span class="n">k_sub_defect</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;defect&#39;</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_defect</span><span class="p">)</span>
              <span class="n">defect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added defect!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">cyl</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_crystal</span><span class="p">)</span>
              <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
          <span class="c1">#else:</span>
            <span class="c1">#print(&#39;This should not happen&#39;, file=sys.stderr)</span>

  <span class="c1"># add defect at the end to put it over the other defects</span>
  <span class="c1"># TODO: Maybe add option to put it under the other cylinders? (add layer system and move to front/back/layer X system to BFDTDobject)</span>
  
  <span class="n">defect_pos</span> <span class="o">=</span> <span class="n">defect_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
  <span class="n">defect</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">()</span>
  <span class="n">defect</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">defect_pos</span><span class="p">)</span>
  <span class="n">defect</span><span class="o">.</span><span class="n">setInnerRadius</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">defect</span><span class="o">.</span><span class="n">setOuterRadius</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cyl_length</span><span class="p">)</span>
  <span class="n">defect</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;defect&#39;</span>
  <span class="n">defect</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_defect</span><span class="p">)</span>
  <span class="c1">#defect_list = [defect]</span>
  
  <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">defect</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">defect_list</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding defect </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">defect_list</span><span class="p">)))</span>
    <span class="n">crystal</span><span class="o">.</span><span class="n">appendGeometryObject</span><span class="p">(</span><span class="n">defect</span><span class="p">)</span>

  <span class="n">crystal</span><span class="o">.</span><span class="n">setSizeAndResolution</span><span class="p">(</span><span class="n">cube_side</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="n">Nx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">Ny</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">Nz</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span><span class="mi">20</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="n">Nx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">Ny</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">Nz</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
  <span class="n">foo1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">foo2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">foo3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">foo</span> <span class="o">=</span> <span class="n">foo1</span> <span class="o">+</span> <span class="n">foo2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">foo3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setXmesh</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setYmesh</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setZmesh</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

  <span class="p">(</span><span class="n">xmesh</span><span class="p">,</span> <span class="n">ymesh</span><span class="p">,</span> <span class="n">zmesh</span><span class="p">)</span> <span class="o">=</span> <span class="n">crystal</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getMesh</span><span class="p">()</span>
  <span class="n">delta</span> <span class="o">=</span> <span class="n">xmesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xmesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
  <span class="c1"># TODO: Add backfill option to BFDTD object (when writing without geom, should leave in backfill)</span>

  <span class="c1">#crystal.writeGeoFile(DSTDIR + os.path.sep + name + &#39;.geo&#39;)</span>

  <span class="n">geometry_translation_vector</span> <span class="o">=</span> <span class="n">cube_side</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">geometry_translation_vector</span><span class="p">)</span>
  <span class="c1"># rotate here</span>
  <span class="c1">#crystal.rotate([0,0,0], [0,1,0], 90)</span>

  <span class="n">backfill</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">crystal</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
  <span class="n">backfill</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">crystal</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getCentro</span><span class="p">())</span>
  <span class="n">backfill</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="n">n_backfill</span><span class="p">)</span>

  <span class="n">P_input_excitation</span> <span class="o">=</span> <span class="n">defect_pos</span> <span class="o">+</span> <span class="n">geometry_translation_vector</span>

  <span class="n">probe_defect</span> <span class="o">=</span> <span class="n">Probe</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">P_input_excitation</span><span class="p">);</span> <span class="n">probe_defect</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;probe_defect_Centro&#39;</span>
  <span class="n">probe_defect</span><span class="o">.</span><span class="n">setStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probe_defect</span><span class="p">)</span>

  <span class="n">probe_defect</span> <span class="o">=</span> <span class="n">Probe</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">P_input_excitation</span> <span class="o">+</span> <span class="n">probe_distance</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]));</span> <span class="n">probe_defect</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;probe_defect_X&#39;</span>
  <span class="n">probe_defect</span><span class="o">.</span><span class="n">setStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probe_defect</span><span class="p">)</span>

  <span class="n">probe_defect</span> <span class="o">=</span> <span class="n">Probe</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">P_input_excitation</span> <span class="o">+</span> <span class="n">probe_distance</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]));</span> <span class="n">probe_defect</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;probe_defect_Y&#39;</span>
  <span class="n">probe_defect</span><span class="o">.</span><span class="n">setStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probe_defect</span><span class="p">)</span>

  <span class="n">probe_defect</span> <span class="o">=</span> <span class="n">Probe</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">P_input_excitation</span> <span class="o">+</span> <span class="n">probe_distance</span><span class="o">*</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]));</span> <span class="n">probe_defect</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;probe_defect_Z&#39;</span>
  <span class="n">probe_defect</span><span class="o">.</span><span class="n">setStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">probe_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probe_defect</span><span class="p">)</span>

  <span class="c1">#crystal.boundaries.setBoundaryConditionsToPML()</span>

  <span class="c1">#crystal.setIterations(100)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="mf">2e6</span><span class="p">)</span>

  <span class="c1">##################</span>
  <span class="c1"># excitation</span>

  <span class="c1">#excitation = Excitation()</span>
  <span class="c1">#excitation.setLambda(cube_side)</span>
  <span class="c1">#delta = array([0,0,0.25*cube_side])</span>
  <span class="c1">#excitation.setExtension(crystal.box.getCentro()-delta,crystal.box.getCentro()+delta)</span>
  <span class="c1">#crystal.appendExcitation(excitation)</span>

  <span class="c1">#C = crystal.box.getCentro()</span>
  <span class="c1">#C[2] = 0.5*cube_side</span>

  <span class="c1">#radius = 0.5*Lambda_mm</span>

  <span class="c1">#excitation = ExcitationWithGaussianTemplate()</span>
  <span class="c1">#excitation = ExcitationWithUniformTemplate()</span>
  <span class="n">excitation</span> <span class="o">=</span> <span class="n">Excitation</span><span class="p">()</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
  <span class="c1">#excitation.setFrequency(f0)</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setFrequencyRange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span><span class="n">fmax</span><span class="p">)</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setCentro</span><span class="p">(</span><span class="n">P_input_excitation</span><span class="p">)</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setEx</span><span class="p">()</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setSize</span><span class="p">([</span><span class="n">dipole_length</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

  <span class="c1">#excitation.sigma_x = radius</span>
  <span class="c1">#excitation.sigma_y = radius</span>
  <span class="c1">#excitation.amplitude = 1</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">plane_direction</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
  <span class="c1">#excitation.excitation_direction = [&#39;Exre&#39;]</span>
  
  <span class="c1">#excitation.template_filename = &#39;input.dat&#39;</span>
  
  <span class="c1">#L = crystal.box.getLower()</span>
  <span class="c1">#print((&#39;L = &#39;,L))</span>
  <span class="c1">#U = crystal.box.getUpper()</span>
  <span class="c1">#L[2] = P_input_excitation[2]</span>
  <span class="c1">#print((&#39;L = &#39;,L))</span>
  <span class="c1">#U[2] = P_input_excitation[2]</span>
  <span class="c1">#L = L + 8*array([delta, delta, 0])</span>
  <span class="c1">#print((&#39;L = &#39;,L))</span>
  <span class="c1">#U = U - 8*array([delta, delta, 0])</span>
  <span class="c1">#L = [0,0,0]</span>
  <span class="c1">#print((&#39;L = &#39;,L))</span>
  
  <span class="c1">#excitation.setExtension(defect_pos + 0.5*excitation_size*excitation_direction,)</span>
  
  <span class="c1">#print(excitation)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">appendExcitation</span><span class="p">(</span><span class="n">excitation</span><span class="p">)</span>
  <span class="c1">##################</span>

  <span class="c1">##################</span>
  <span class="c1">## measurement objects</span>
  <span class="c1">#C = crystal.box.getCentro()</span>
  <span class="c1">#C[2] = 0.75*cube_side</span>
  <span class="c1">#P_input = C</span>

  <span class="c1">#C = crystal.box.getCentro()</span>
  <span class="c1">#C[2] = crystal.box.getUpper()[2] - 0.5*cube_side</span>
  <span class="c1">#P_output = C</span>

  <span class="c1">#probe_input = Probe(position = P_input); probe_input.name = &#39;probe_input&#39;</span>
  <span class="c1">#crystal.probe_list.append(probe_input)</span>
  <span class="c1">#probe_output = Probe(position = P_output); probe_output.name = &#39;probe_output&#39;</span>
  <span class="c1">#crystal.probe_list.append(probe_output)</span>

  <span class="c1">#crystal.addModeFilteredProbe(&#39;z&#39;,P_input)</span>
  <span class="c1">#crystal.addModeFilteredProbe(&#39;z&#39;,P_output)</span>
  <span class="c1">##################</span>

  <span class="n">crystal</span><span class="o">.</span><span class="n">setExecutable</span><span class="p">(</span><span class="s1">&#39;fdtd64_2013&#39;</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">setWallTime</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">setFileBaseName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

  <span class="n">excitation</span><span class="o">.</span><span class="n">setEx</span><span class="p">()</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setSize</span><span class="p">([</span><span class="n">dipole_length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeTorqueJobDirectory</span><span class="p">(</span><span class="n">DSTDIR</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;Ex&#39;</span><span class="p">)</span>

  <span class="n">excitation</span><span class="o">.</span><span class="n">setEy</span><span class="p">()</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setSize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">dipole_length</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeTorqueJobDirectory</span><span class="p">(</span><span class="n">DSTDIR</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;Ey&#39;</span><span class="p">)</span>

  <span class="n">excitation</span><span class="o">.</span><span class="n">setEz</span><span class="p">()</span>
  <span class="n">excitation</span><span class="o">.</span><span class="n">setSize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dipole_length</span><span class="p">])</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeTorqueJobDirectory</span><span class="p">(</span><span class="n">DSTDIR</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
  
  <span class="c1">##################</span>
  <span class="c1"># ROTATION STUFF, to finish later eventually</span>

  <span class="c1">#(xmesh, ymesh, zmesh) = crystal.mesh.getMesh()</span>

  <span class="c1">#for x in xmesh:</span>
    <span class="c1">#crystal.addEpsilonSnapshot(&#39;x&#39;,x)</span>

  <span class="c1">#crystal.addEpsilonSnapshot(&#39;x&#39;,crystal.box.getCentro())</span>
  <span class="c1">#crystal.addEpsilonSnapshot(&#39;y&#39;,crystal.box.getCentro())</span>
  <span class="c1">#crystal.addEpsilonSnapshot(&#39;z&#39;,crystal.box.getCentro())</span>

  <span class="c1">#alpha_to_xy_deg = degrees(numpy.arctan(1/sqrt(2)))</span>
  <span class="c1">#alpha_to_z_deg = degrees(numpy.arccos(-1/sqrt(3)))</span>
  <span class="c1">#rotation_centro = defect_pos + geometry_translation_vector</span>

  <span class="c1">#crystal.writeGeoFile(DSTDIR+os.path.sep+&#39;normal.geo&#39;)</span>
  <span class="c1">#return</span>
  
  <span class="c1">#Xaligned = copy.deepcopy(crystal)</span>
  <span class="c1">#Xaligned.rotate(rotation_centro, [1,-1,0], alpha_to_xy_deg)</span>
  <span class="c1">#Xaligned.rotate(rotation_centro, [0,0,1], -45)</span>
  <span class="c1">##Xaligned.excitation_li</span>
  <span class="c1">#Xaligned.writeGeoFile(DSTDIR+os.path.sep+&#39;X.geo&#39;)</span>

  <span class="c1">#Yaligned = copy.deepcopy(crystal)</span>
  <span class="c1">#Yaligned.rotate(rotation_centro, [1,-1,0], alpha_to_xy_deg)</span>
  <span class="c1">#Yaligned.rotate(rotation_centro, [0,0,1], 45)</span>
  <span class="c1">#Yaligned.writeGeoFile(DSTDIR+os.path.sep+&#39;Y.geo&#39;)</span>
  
  <span class="c1">#Zaligned = copy.deepcopy(crystal)</span>
  <span class="c1">#Zaligned.rotate(rotation_centro, [1,-1,0], alpha_to_z_deg)</span>
  <span class="c1">#Zaligned.rotate(rotation_centro, [0,0,1], -45)</span>
  <span class="c1">#Zaligned.writeGeoFile(DSTDIR+os.path.sep+&#39;Z.geo&#39;)</span>

  <span class="c1">##crystal.writeGeoFile(DSTDIR+os.path.sep+&#39;rotated45.geo&#39;)</span>
  <span class="c1">##crystal.rotate([0,0,0], [0,1,0], 90)</span>
  <span class="c1">##crystal.writeGeoFile(DSTDIR+os.path.sep+&#39;rotated90.geo&#39;)</span>
  <span class="c1">#return</span>
  
  <span class="c1">#superfunc = lambda x: crystal.writeShellScript(x, BASENAME=None, EXE=&#39;fdtd64_2013&#39;, WORKDIR=&#39;$JOBDIR&#39;, WALLTIME=360)</span>

  <span class="c1">#crystal.writeAll(DSTDIR+os.path.sep+&#39;PCD_withGeom&#39;, name, withGeom=True, writeShellScriptFunction=superfunc)</span>
  <span class="c1">#crystal.writeAll(DSTDIR+os.path.sep+&#39;PCD_withoutGeom&#39;,name, withGeom=False, writeShellScriptFunction=superfunc)</span>

  <span class="n">FRD</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">crystal</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">FRD</span><span class="p">:</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">crystal</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getCentro</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">setRefractiveIndex</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">geometry_object_list</span> <span class="o">+=</span> <span class="n">FRD</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">clearFileList</span><span class="p">()</span> <span class="c1"># TODO: Maybe do something so this isn&#39;t necessary anymore? Is unintuitive.</span>

  <span class="n">crystal</span><span class="o">.</span><span class="n">setFileBaseName</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_FRD&#39;</span><span class="p">)</span>
  <span class="n">crystal</span><span class="o">.</span><span class="n">writeTorqueJobDirectory</span><span class="p">(</span><span class="n">DSTDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;FRD_withGeom&#39;</span><span class="p">)</span>
  <span class="c1">#crystal.writeAll(DSTDIR+os.path.sep+&#39;FRD_withoutGeom&#39;,name+&#39;_FRD&#39;, withGeom=False, writeShellScriptFunction=superfunc)</span>

  <span class="k">return</span></div>

<div class="viewcode-block" id="test_RCD_GWL"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.test_RCD_GWL">[docs]</a><span class="k">def</span> <span class="nf">test_RCD_GWL</span><span class="p">():</span>
  <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
  
  <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Output in &#39;</span> <span class="o">+</span> <span class="n">DSTDIR</span><span class="p">)</span>

  <span class="n">createIceCrystal_GWL_singleLine_UnitcellByUnitcell</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">)</span>
  <span class="n">createIceCrystal_GWL_WithCylinders</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">)</span>
  <span class="n">createIceCrystal_GWL_TopDown</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">)</span>
  <span class="n">createIceCrystal_GWL_TopDownFlatLines</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elapsed time: </span><span class="si">%.4f</span><span class="s2"> sec&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">))</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="test_RCD_BFDTD_unitcell"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.test_RCD_BFDTD_unitcell">[docs]</a><span class="k">def</span> <span class="nf">test_RCD_BFDTD_unitcell</span><span class="p">():</span>

  <span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

  <span class="n">N</span><span class="o">=</span><span class="mi">1</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">1.00</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mf">3.60</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">1.52</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.26</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.45</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.65</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

  <span class="k">for</span> <span class="n">i_sub_defect</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">k_sub_defect</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i_sub_defect = &#39;</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k_sub_defect = &#39;</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>
      <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;i-</span><span class="si">{}</span><span class="s1">_j-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_sub_defect</span><span class="p">,</span><span class="n">k_sub_defect</span><span class="p">)</span>
      <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="k">return</span></div>

<div class="viewcode-block" id="test_RCD_BFDTD_0"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.test_RCD_BFDTD_0">[docs]</a><span class="k">def</span> <span class="nf">test_RCD_BFDTD_0</span><span class="p">():</span>
  
  <span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
  
  <span class="n">res_vec3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">base_name</span> <span class="o">=</span> <span class="s1">&#39;IcePara&#39;</span>
  <span class="n">PCslope</span> <span class="o">=</span> <span class="mf">0.0137</span>
  <span class="n">iface</span> <span class="o">=</span> <span class="mf">0.5</span>

  <span class="n">i_sub_defect</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">k_sub_defect</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">delta_f</span> <span class="o">=</span> <span class="mf">1.2</span>

  <span class="n">N</span><span class="o">=</span><span class="mi">3</span>
  
  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mf">3.6</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">1.52</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.26</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">excitation_frequency_normalized</span><span class="o">=</span><span class="mf">0.52</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">4.1</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="n">n_backfill</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.27</span>
  <span class="n">excitation_frequency_normalized</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6226</span><span class="o">+</span><span class="mf">0.4467</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">3.5</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="n">n_backfill</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.27</span>
  <span class="n">excitation_frequency_normalized</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5147</span><span class="o">+</span><span class="mf">0.6785</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">3.3</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="n">n_backfill</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.26</span>
  <span class="n">excitation_frequency_normalized</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5140</span><span class="o">+</span><span class="mf">0.6598</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">2.4</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="n">n_backfill</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.24</span>
  <span class="n">excitation_frequency_normalized</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6210</span><span class="o">+</span><span class="mf">0.6941</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>

  <span class="k">return</span></div>

<div class="viewcode-block" id="test_RCD_BFDTD_1"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.test_RCD_BFDTD_1">[docs]</a><span class="k">def</span> <span class="nf">test_RCD_BFDTD_1</span><span class="p">():</span>

  <span class="n">WORKDIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

  <span class="n">N</span><span class="o">=</span><span class="mi">3</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">1.00</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">4</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mi">2</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.26</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.45</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.65</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">2.40</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">2.40</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.5542563</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.621</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.6941</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">3.30</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">3.30</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.6004443</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.514</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.6598</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">3.50</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">3.50</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.6235383</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.5147</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.6785</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>

  <span class="n">Nx</span><span class="o">=</span><span class="n">Ny</span><span class="o">=</span><span class="n">Nz</span><span class="o">=</span><span class="n">N</span>
  <span class="n">n_backfill</span><span class="o">=</span><span class="mf">4.10</span>
  <span class="n">n_crystal</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">n_defect</span><span class="o">=</span><span class="mf">4.10</span>
  <span class="n">cylinder_radius_normalized</span><span class="o">=</span><span class="mf">0.6235383</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mf">0.4467</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mf">0.6226</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmin_normalized</span><span class="o">+</span><span class="n">fmax_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">WORKDIR</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;N=</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">.n_defect=</span><span class="si">{:.2f}</span><span class="s1">.n_crystal=</span><span class="si">{:.2f}</span><span class="s1">.n_backfill=</span><span class="si">{:.2f}</span><span class="s1">.rn=</span><span class="si">{:.3f}</span><span class="s1">.f0n=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="test_RCD_BFDTD_2"><a class="viewcode-back" href="../../crystals.html#crystals.RCD_CubicLattice.test_RCD_BFDTD_2">[docs]</a><span class="k">def</span> <span class="nf">test_RCD_BFDTD_2</span><span class="p">():</span>
  <span class="n">DSTDIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
  <span class="n">Nx</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">Ny</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">Nz</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">n_defect</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">n_crystal</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">n_backfill</span> <span class="o">=</span> <span class="mi">4</span>
  <span class="n">cylinder_radius_normalized</span> <span class="o">=</span> <span class="mf">0.1</span>
  <span class="n">excitation_frequency_normalized</span> <span class="o">=</span> <span class="mi">6</span>
  <span class="n">fmin_normalized</span> <span class="o">=</span> <span class="mi">7</span>
  <span class="n">fmax_normalized</span> <span class="o">=</span> <span class="mi">8</span>
  <span class="n">i_sub_defect</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">k_sub_defect</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="n">delta_f</span> <span class="o">=</span> <span class="mf">3.4</span>
  
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">-</span><span class="n">delta_f</span><span class="p">,</span> <span class="n">excitation_frequency_normalized</span><span class="o">+</span><span class="n">delta_f</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">)</span>
  <span class="n">createIceCrystal_BFDTD</span><span class="p">(</span><span class="n">DSTDIR</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">n_defect</span><span class="p">,</span> <span class="n">n_crystal</span><span class="p">,</span> <span class="n">n_backfill</span><span class="p">,</span> <span class="n">cylinder_radius_normalized</span><span class="p">,</span> <span class="n">fmin_normalized</span><span class="p">,</span> <span class="n">fmax_normalized</span><span class="p">,</span> <span class="n">i_sub_defect</span><span class="p">,</span> <span class="n">k_sub_defect</span><span class="p">)</span>
  <span class="k">return</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="c1"># TODO: Fix FRD cylinder rotation and double backfill</span>
  <span class="n">test_RCD_GWL</span><span class="p">()</span>
  <span class="n">test_RCD_BFDTD_unitcell</span><span class="p">()</span>
  <span class="n">test_RCD_BFDTD_0</span><span class="p">()</span>
  <span class="n">test_RCD_BFDTD_1</span><span class="p">()</span>
  <span class="n">test_RCD_BFDTD_2</span><span class="p">()</span>
  
  <span class="n">obj</span> <span class="o">=</span> <span class="n">RCD_GWL_Parallelepiped</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">computePoints</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">updateLimits</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">writeGWLWithPowerCompensation</span><span class="p">(</span><span class="s1">&#39;/tmp/RCD.gwl&#39;</span><span class="p">)</span>

  <span class="n">obj</span> <span class="o">=</span> <span class="n">RCD_GWL_Cylinder</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">computePoints</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">updateLimits</span><span class="p">()</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">writeGWLWithPowerCompensation</span><span class="p">(</span><span class="s1">&#39;/tmp/lol.gwl&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Mike Taverne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>