
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>meshing.meshing &#8212; script_inception_public  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for meshing.meshing</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;This module handles the new meshing system.</span>

<span class="sd">Currently only designed for BFDTD simulations, i.e. for a final heterogeneous rectilinear grid.</span>
<span class="sd">But it is completely independent of BFDTDobject or any other FDTD related code.</span>
<span class="sd">VTK-related code will be added to it later eventually.</span>

<span class="sd">The class design is as follows:</span>

<span class="sd">* **Mesh3D**: Consists of 3 *MultiMesh1D*, for the X, Y and Z directions.</span>

<span class="sd">  * **MultiMesh1D**: Contains a list of *Mesh1D* or *MultiMesh1D* objects.</span>

<span class="sd">    * **Mesh1D**: A generic parent class for 1D meshes.</span>

<span class="sd">      * **HeterogeneousMesh1D**: A heterogeneous mesh defined by its attribute *coordinates*.</span>
<span class="sd">      * **HomogeneousMesh1D**: A homogeneous mesh defined by its attributes *pos_min*, *pos_max*, *spacing_max*. *spacing_max* is used to determine the number of points/cells.</span>
<span class="sd">      </span>
<span class="sd">        * **HomogeneousMeshParameters1D**: A subclass of *HomogeneousMesh1D*, but for which the *MultiMesh1D::getLocalCoordinates()* function will take *spacing_max* into account to merge multiple *HomogeneousMeshParameters1D* in a smart way.</span>
<span class="sd">      </span>
<span class="sd">.. digraph:: meshing_system_diagram</span>

<span class="sd">   edge [style=dashed,color=red, dir=back];</span>
<span class="sd">   &quot;Mesh3D&quot; -&gt; &quot;MultiMesh1D&quot; -&gt; &quot;Mesh1D&quot;;</span>
<span class="sd">   edge [style=solid,color=black, dir=back];</span>
<span class="sd">   &quot;Mesh1D&quot; -&gt; {&quot;HomogeneousMesh1D&quot;,&quot;HeterogeneousMesh1D&quot;};</span>
<span class="sd">   &quot;HomogeneousMesh1D&quot; -&gt; &quot;HomogeneousMeshParameters1D&quot;</span>

<span class="sd">.. todo:: Mesh3D might be left out completely. It means we have to give each geometric object 3 attributes, but allows for more flexibility. In any case, it&#39;s better to finish the mesh1D system first and deal with Mesh3D later.</span>
<span class="sd">.. todo:: MultiMesh3D?</span>

<span class="sd">idea: Make various meshing algorithms available and allow user-created ones (ex: structure-specific meshing algorithms, tests of meshing on simulation results).</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">array</span>

<div class="viewcode-block" id="Mesh3D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D">[docs]</a><span class="k">class</span> <span class="nc">Mesh3D</span><span class="p">():</span>
  <span class="sd">&#39;&#39;&#39;A rectilinear structured 3D mesh/grid.&#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="c1">#: a name for easier debugging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span> <span class="o">=</span> <span class="n">MultiMesh1D</span><span class="p">()</span> <span class="c1">#: the 1D mesh in the X direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span> <span class="o">=</span> <span class="n">MultiMesh1D</span><span class="p">()</span> <span class="c1">#: the 1D mesh in the Y direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span> <span class="o">=</span> <span class="n">MultiMesh1D</span><span class="p">()</span> <span class="c1">#: the 1D mesh in the Z direction</span>
    <span class="k">return</span>

  <span class="c1">#@property</span>
  <span class="c1">#def location(self):</span>
    <span class="c1">#return array([self.xmesh.location, self.ymesh.location, self.zmesh.location])</span>

  <span class="c1">#@location.setter</span>
  <span class="c1">#def location(self, value):</span>
    <span class="c1">#self.xmesh.location = value[0]</span>
    <span class="c1">#self.ymesh.location = value[1]</span>
    <span class="c1">#self.zmesh.location = value[2]</span>

  <span class="c1">#@property</span>
  <span class="c1">#def parent(self):</span>
    <span class="c1">#return array([self.xmesh.location, self.ymesh.location, self.zmesh.location])</span>

  <span class="c1">#@parent.setter</span>
  <span class="c1">#def parent(self, value):</span>
    <span class="c1">#self.xmesh.parent = value.xmesh</span>
    <span class="c1">#self.ymesh.parent = value.ymesh</span>
    <span class="c1">#self.zmesh.parent = value.zmesh</span>

<div class="viewcode-block" id="Mesh3D.getGlobalLocation"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.getGlobalLocation">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mesh3D.PrintSelf"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.PrintSelf">[docs]</a>  <span class="k">def</span> <span class="nf">PrintSelf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function with indent&#39;&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;name = &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;location = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.name = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = None&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;xmesh:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;ymesh:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;zmesh:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">()</span>

<div class="viewcode-block" id="Mesh3D.setUseForMeshing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.setUseForMeshing">[docs]</a>  <span class="k">def</span> <span class="nf">setUseForMeshing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *useForMeshing* attribute to *bool_value* for xmesh, ymesh and zmesh.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">setUseForMeshing</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">setUseForMeshing</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">setUseForMeshing</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Mesh3D.setAllowResolutionScaling"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.setAllowResolutionScaling">[docs]</a>  <span class="k">def</span> <span class="nf">setAllowResolutionScaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *allowResolutionScaling* attribute to *bool_value* for xmesh, ymesh and zmesh.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">setAllowResolutionScaling</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">setAllowResolutionScaling</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">setAllowResolutionScaling</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Mesh3D.setResolutionScalingFactor"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.setResolutionScalingFactor">[docs]</a>  <span class="k">def</span> <span class="nf">setResolutionScalingFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *resolutionScalingFactor* attribute to *bool_value* for xmesh, ymesh and zmesh.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">setResolutionScalingFactor</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">setResolutionScalingFactor</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">setResolutionScalingFactor</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Mesh3D.getGlobalXCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.getGlobalXCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalXCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;get the grid coordinates in the x-direction.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">())</span></div>

<div class="viewcode-block" id="Mesh3D.getGlobalYCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.getGlobalYCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalYCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;get the grid coordinates in the y-direction.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">())</span></div>

<div class="viewcode-block" id="Mesh3D.getGlobalZCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh3D.getGlobalZCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalZCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;get the grid coordinates in the z-direction.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">())</span></div></div>

<div class="viewcode-block" id="MultiMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D">[docs]</a><span class="k">class</span> <span class="nc">MultiMesh1D</span><span class="p">():</span>
  <span class="sd">&#39;&#39;&#39;An object consisting of multiple **Mesh1D** or **MultiMesh1D** objects.</span>
<span class="sd">  </span>
<span class="sd">  The idea is to for example create one main mesh for the FDTD simulation consisiting of multiple submeshes for each FDTD object in the simulation.</span>
<span class="sd">  Each of these object submeshes can then also consist of multiple submeshes, again being either **Mesh1D** or **MultiMesh1D**.</span>
<span class="sd">  </span>
<span class="sd">  *getLocalCoordinates()* will go through all those meshes recursively and return a single merged one.</span>
<span class="sd">  </span>
<span class="sd">  The extension of that system to 3 or more or less dimensions is then straightforward and done via the **Mesh3D** class.</span>
<span class="sd">  </span>
<span class="sd">  .. todo:: Use the submesh order when merging the submeshes as a &quot;priority system&quot;.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="c1">#: a name for easier debugging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: The list of **Mesh1D** or **MultiMesh1D** objects.</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">minimum_mesh_delta</span> <span class="o">=</span> <span class="mf">1e-3</span> <span class="c1">#: The minimum cell size allowed. This is used when merging the various submeshes. Default: 1e-3. Set to ``None`` to disable.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maximum_mesh_delta_ratio</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#: For creating a smooth mesh. Neighboring cell sizes should not exceed a factor of *maximum_mesh_delta_ratio*. Default: 2. Set to ``None`` to disable.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maximum_mesh_delta_vacuum</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: If set, the mesh will be checked for any cells larger than ``maximum_mesh_delta_vacuum * spacing_max`` (*spacing_max* set to 1 if the *Mesh1D* object does not provide it). Default: None. Set to ``None`` to disable.</span>

    <span class="c1"># for vol ratio max = 2</span>
    <span class="c1"># TODO: make default? (after submitting RCD jobs)</span>
    <span class="c1">#self.maximum_mesh_delta_ratio = pow(2,1/3)    </span>

    <span class="k">return</span>

  <span class="c1"># TODO: Looks like things are getting out of hand again. Do we really need such a flexible/complicated system???</span>
<div class="viewcode-block" id="MultiMesh1D.addChild"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.addChild">[docs]</a>  <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="MultiMesh1D.makeAllSubMeshesChildren"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.makeAllSubMeshesChildren">[docs]</a>  <span class="k">def</span> <span class="nf">makeAllSubMeshesChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MultiMesh1D.getGlobalLocation"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.getGlobalLocation">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiMesh1D.PrintSelf"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.PrintSelf">[docs]</a>  <span class="k">def</span> <span class="nf">PrintSelf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function with indent&#39;&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;name = &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;location = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.name = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = None&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;minimum_mesh_delta = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_mesh_delta</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;maximum_mesh_delta_ratio = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_mesh_delta_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;maximum_mesh_delta_vacuum = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_mesh_delta_vacuum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;mesh_list:</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="n">submesh</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;mesh_list: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ret</span></div>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">()</span>
    
<div class="viewcode-block" id="MultiMesh1D.setUseForMeshing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.setUseForMeshing">[docs]</a>  <span class="k">def</span> <span class="nf">setUseForMeshing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *useForMeshing* attribute to *bool_value* for all submeshes.&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">setUseForMeshing</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="MultiMesh1D.setAllowResolutionScaling"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.setAllowResolutionScaling">[docs]</a>  <span class="k">def</span> <span class="nf">setAllowResolutionScaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *allowResolutionScaling* attribute to *bool_value* for all submeshes.&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">setAllowResolutionScaling</span><span class="p">(</span><span class="n">bool_value</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="MultiMesh1D.setResolutionScalingFactor"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.setResolutionScalingFactor">[docs]</a>  <span class="k">def</span> <span class="nf">setResolutionScalingFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *resolutionScalingFactor* attribute to *float_value* for all submeshes.&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">setResolutionScalingFactor</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="MultiMesh1D.getMesh1DList"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.getMesh1DList">[docs]</a>  <span class="k">def</span> <span class="nf">getMesh1DList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Converts the submesh list into one containing only Mesh1D objects by iterating through the submeshes recursively.&#39;&#39;&#39;</span>
    
    <span class="n">mesh1D_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">submesh</span><span class="p">,</span> <span class="n">MultiMesh1D</span><span class="p">):</span>
        <span class="n">mesh1D_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">submesh</span><span class="o">.</span><span class="n">getMesh1DList</span><span class="p">())</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">submesh</span><span class="p">,</span> <span class="n">Mesh1D</span><span class="p">):</span>
        <span class="n">mesh1D_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Invalid mesh type: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">submesh</span><span class="p">))</span> <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mesh1D_list</span></div>

<div class="viewcode-block" id="MultiMesh1D.getGlobalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.getGlobalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MultiMesh1D.getLocalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.getLocalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getLocalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of merged and sorted coordinates from all submeshes.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: Meshes of type *HomogeneousMesh1D* are handled in a special way, in the sense that their *spacing_max* values are compared to choose the smallest one in case of overlap.</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># The list of coordinates that will be returned at the end.</span>
    <span class="n">merged_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># list of only mesh1D objects</span>
    <span class="n">mesh1D_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMesh1DList</span><span class="p">()</span>
    
    <span class="c1"># list of &quot;meshing parameters&quot; which need to be merged in a smart way.</span>
    <span class="n">meshing_parameters_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># list of normal meshes that can be merged directly.</span>
    <span class="n">direct_mesh_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># loop through the Mesh1D objects</span>
    <span class="k">for</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="n">mesh1D_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">submesh</span><span class="p">,</span> <span class="n">Mesh1D</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Invalid mesh type: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">submesh</span><span class="p">))</span> <span class="p">)</span>
      
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">submesh</span><span class="p">,</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">):</span>
        <span class="n">meshing_parameters_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">direct_mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">meshing_parameters_list</span><span class="p">:</span>
      
      <span class="c1"># quick hack to submit RCD111 jobs...</span>
      <span class="n">meshing_parameters_list</span> <span class="o">=</span> <span class="n">hackMesh</span><span class="p">(</span><span class="n">meshing_parameters_list</span><span class="p">)</span>
      
      <span class="c1"># create a direct mesh from the meshing parameters</span>
      <span class="n">coords</span> <span class="o">=</span> <span class="n">mergeMeshingParameters</span><span class="p">(</span><span class="n">meshing_parameters_list</span><span class="p">)</span>
      <span class="n">merged_parametrized_meshes</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>    
      
      <span class="c1"># add the new direct mesh to direct_mesh_list</span>
      <span class="n">direct_mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_parametrized_meshes</span><span class="p">)</span>
    
    <span class="c1"># merge the direct meshes together (sort-&gt;unique)</span>
    <span class="k">for</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="n">direct_mesh_list</span><span class="p">:</span>
      <span class="n">merged_coordinates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">submesh</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">())</span>
    
    <span class="n">merged_coordinates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">merged_coordinates</span><span class="p">))</span>
    
    <span class="c1"># TODO: re-enable this, once new RCD structures are submitted?</span>
    <span class="c1">#checkMesh(merged_coordinates, self.minimum_mesh_delta, self.maximum_mesh_delta_ratio)</span>
    
    <span class="c1">#thickness_list = numpy.diff(merged_coordinates)</span>
    <span class="c1">#for (idx, thickness) in enumerate(thickness_list):</span>
      <span class="c1">#if self.minimum_mesh_delta:</span>
        <span class="c1">#if thickness &lt; self.minimum_mesh_delta:</span>
          <span class="c1">#raise Exception(&#39;(thickness={}) &lt; (minimum_mesh_delta={})&#39;.format(thickness, self.minimum_mesh_delta))</span>
      <span class="c1">#if self.maximum_mesh_delta_ratio:</span>
        <span class="c1">#if idx+1 &lt; len(thickness_list):</span>
          <span class="c1">#t0 = thickness_list[idx]</span>
          <span class="c1">#t1 = thickness_list[idx+1]</span>
          <span class="c1">#if max(t0,t1)/min(t0,t1) &gt; self.maximum_mesh_delta_ratio:</span>
            <span class="c1">#raise Exception(&#39;max(t0,t1)={}/min(t0,t1)={} &gt; self.maximum_mesh_delta_ratio={}&#39;.format(max(t0,t1), min(t0,t1), self.maximum_mesh_delta_ratio))</span>
    
    <span class="k">return</span> <span class="n">merged_coordinates</span></div>

<div class="viewcode-block" id="MultiMesh1D.renderInBlender"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.renderInBlender">[docs]</a>  <span class="k">def</span> <span class="nf">renderInBlender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">renderInBlender</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="MultiMesh1D.renderXMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.renderXMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderXMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">renderXMesh1D</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="MultiMesh1D.renderYMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.renderYMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderYMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">renderYMesh1D</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="MultiMesh1D.renderZMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.MultiMesh1D.renderZMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderZMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_list</span><span class="p">:</span>
      <span class="n">m</span><span class="o">.</span><span class="n">renderZMesh1D</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="k">return</span></div></div>

<div class="viewcode-block" id="hackMesh"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.hackMesh">[docs]</a><span class="k">def</span> <span class="nf">hackMesh</span><span class="p">(</span><span class="n">meshing_parameters_list</span><span class="p">):</span>
  
  <span class="n">nuke_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
  <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
  <span class="k">for</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="n">meshing_parameters_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">submesh</span><span class="o">.</span><span class="n">nukeothers</span><span class="p">:</span>
      <span class="n">nuke_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
      <span class="n">L</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">)</span>
      <span class="n">U</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">L</span>
      <span class="k">if</span> <span class="n">U</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">U</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuke_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">meshing_parameters_list</span>

  <span class="n">new_list</span> <span class="o">=</span> <span class="n">nuke_list</span>

  <span class="k">for</span> <span class="n">submesh</span> <span class="ow">in</span> <span class="n">meshing_parameters_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">submesh</span><span class="o">.</span><span class="n">nukeothers</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lower</span><span class="p">:</span>
        <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">min</span><span class="p">(</span><span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">&lt;=</span> <span class="n">upper</span> <span class="ow">and</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">&lt;=</span> <span class="n">upper</span><span class="p">:</span>
          <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">&lt;=</span> <span class="n">upper</span> <span class="ow">and</span> <span class="n">upper</span> <span class="o">&lt;</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">:</span>
          <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">=</span> <span class="n">upper</span>
          <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">&lt;</span> <span class="n">lower</span> <span class="ow">and</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">&lt;=</span> <span class="n">upper</span><span class="p">:</span>
          <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">=</span> <span class="n">lower</span>
          <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">&lt;</span> <span class="n">lower</span> <span class="ow">and</span> <span class="n">upper</span> <span class="o">&lt;</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">:</span>
          <span class="n">submesh1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
          <span class="n">submesh2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">submesh</span><span class="p">)</span>
          <span class="n">submesh1</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">=</span> <span class="n">lower</span>
          <span class="n">submesh2</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">=</span> <span class="n">upper</span>
          <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh1</span><span class="p">)</span>
          <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submesh2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;submesh: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">lower: </span><span class="si">{}</span><span class="s1"> upper: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">submesh</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">pos_max</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span>
      
  <span class="k">return</span> <span class="n">new_list</span></div>

<div class="viewcode-block" id="Mesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D">[docs]</a><span class="k">class</span> <span class="nc">Mesh1D</span><span class="p">():</span>
  <span class="sd">&#39;&#39;&#39;Generic parent class for 1D meshes.</span>
<span class="sd">  It is used for *HeterogeneousMesh1D* and *HomogeneousMesh1D*.</span>
<span class="sd">  Other mesh types like a logarithmic mesh for example, could be added later.</span>
<span class="sd">  </span>
<span class="sd">  Subclasses must all re-implement the following functions:</span>
<span class="sd">  </span>
<span class="sd">  * *getLocalCoordinates()*</span>
<span class="sd">  </span>
<span class="sd">  :ivar bool useForMeshing: If true, it will be used to create the final mesh. Default: True.</span>
<span class="sd">  :ivar bool allowResolutionScaling: If true, changing the resolution settings to increase or decrease the number of cells will be allowed. Default: True.</span>
<span class="sd">  :ivar float resolutionScalingFactor: Allows increasing or decreasing the number of total cells in the mesh (if the mesh class supports it). Default: 1.</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="c1">#: a name for easier debugging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">useForMeshing</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#: If true, it will be used to create the final mesh. Default: True.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">allowResolutionScaling</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#: If true, changing the resolution settings to increase or decrease the number of cells will be allowed. Default: True.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolutionScalingFactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#: Allows increasing or decreasing the number of total cells in the mesh (if the mesh class supports it). Default: 1.</span>
    <span class="k">return</span>

<div class="viewcode-block" id="Mesh1D.getGlobalLocation"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.getGlobalLocation">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span></div>
  
<div class="viewcode-block" id="Mesh1D.PrintSelf"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.PrintSelf">[docs]</a>  <span class="k">def</span> <span class="nf">PrintSelf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function with indent&#39;&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;name = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;location = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.name = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;parent.id = None&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;useForMeshing = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">useForMeshing</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;allowResolutionScaling = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowResolutionScaling</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;resolutionScalingFactor = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolutionScalingFactor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">()</span>
  
<div class="viewcode-block" id="Mesh1D.setUseForMeshing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.setUseForMeshing">[docs]</a>  <span class="k">def</span> <span class="nf">setUseForMeshing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *useForMeshing* attribute to *bool_value*.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">useForMeshing</span> <span class="o">=</span> <span class="n">bool_value</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Mesh1D.setAllowResolutionScaling"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.setAllowResolutionScaling">[docs]</a>  <span class="k">def</span> <span class="nf">setAllowResolutionScaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bool_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *allowResolutionScaling* attribute to *bool_value*.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">allowResolutionScaling</span> <span class="o">=</span> <span class="n">bool_value</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Mesh1D.setResolutionScalingFactor"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.setResolutionScalingFactor">[docs]</a>  <span class="k">def</span> <span class="nf">setResolutionScalingFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float_value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the *resolutionScalingFactor* attribute to *float_value*.&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolutionScalingFactor</span> <span class="o">=</span> <span class="n">float_value</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="Mesh1D.getGlobalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.getGlobalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getGlobalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span></div>
  
<div class="viewcode-block" id="Mesh1D.getLocalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.getLocalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getLocalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of coordinates. **Must be re-implemented.**</span>
<span class="sd">    </span>
<span class="sd">    .. note:: Do not forget to take into account the Mesh1D attributes when implementing *getLocalCoordinates()*.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;You should not use Mesh1D::getLocalCoordinates directly. It must be re-implemented in a subclass instead.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh1D.getBounds"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.getBounds">[docs]</a>  <span class="k">def</span> <span class="nf">getBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the minimum and maximum values of the coordinates in the form (pos_min, pos_max).&#39;&#39;&#39;</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coordinates</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coordinates</span><span class="p">))</span></div>

<div class="viewcode-block" id="Mesh1D.getThicknessList"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.Mesh1D.getThicknessList">[docs]</a>  <span class="k">def</span> <span class="nf">getThicknessList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns a list of the thicknesses of each section.&#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()))</span> <span class="p">)</span></div></div>

<div class="viewcode-block" id="LogMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.LogMesh1D">[docs]</a><span class="k">class</span> <span class="nc">LogMesh1D</span><span class="p">(</span><span class="n">Mesh1D</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;A logarithmic mesh.&#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="HeterogeneousMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HeterogeneousMesh1D">[docs]</a><span class="k">class</span> <span class="nc">HeterogeneousMesh1D</span><span class="p">(</span><span class="n">Mesh1D</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Very basic class storing parameters for a heterogeneous 1D mesh.&#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>
    
    <span class="c1"># call any parent&#39;s class constructor.</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span> <span class="c1">#: list of the position of mesh lines. Type: List of floats. Default: [0, 1]</span>
    
    <span class="k">return</span>

<div class="viewcode-block" id="HeterogeneousMesh1D.PrintSelf"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HeterogeneousMesh1D.PrintSelf">[docs]</a>  <span class="k">def</span> <span class="nf">PrintSelf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function with indent&#39;&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;coordinates = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">()</span>

<div class="viewcode-block" id="HeterogeneousMesh1D.getLocalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HeterogeneousMesh1D.getLocalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getLocalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of coordinates.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span></div>

<div class="viewcode-block" id="HeterogeneousMesh1D.createFromThicknessList"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HeterogeneousMesh1D.createFromThicknessList">[docs]</a>  <span class="k">def</span> <span class="nf">createFromThicknessList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_min</span><span class="p">,</span> <span class="n">ThicknessList</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Creates a list of coordinates of the form:</span>
<span class="sd">    </span>
<span class="sd">    * pos_min</span>
<span class="sd">    * pos_min + ThicknessList[0]</span>
<span class="sd">    * pos_min + ThicknessList[0] + ThicknessList[1]</span>
<span class="sd">    * ...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">ThicknessList</span><span class="p">))))</span>
    <span class="k">return</span></div></div>

<div class="viewcode-block" id="HomogeneousMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D">[docs]</a><span class="k">class</span> <span class="nc">HomogeneousMesh1D</span><span class="p">(</span><span class="n">Mesh1D</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Class storing parameters for a homogeneous 1D mesh.</span>

<span class="sd">  This class uses *spacing_max* as main attribute instead of a given number of cells for more flexibility.</span>
<span class="sd">  This is useful when merging meshes (cf: :py:class:`HomogeneousMeshParameters1D`).</span>
<span class="sd">  But when a thickness or position list is requested, we simply switch to &quot;N&quot; as main, i.e. we create a homogeneous mesh.</span>
<span class="sd">    </span>
<span class="sd">  In general, for FDTD, we want: ``spacing_max &lt; F*lambda*1/n``, with ``n=sqrt(epsilon_r)``.</span>
<span class="sd">  </span>
<span class="sd">  Since the factor *F* (usually around 1/15) and *lambda* are the only &quot;geometry independent&quot; settings, we bind them together into the *resolutionScalingFactor*.</span>
<span class="sd">  </span>
<span class="sd">  So we use the remaining &quot;geometry dependent&quot; terms *n* (refractive index) and *epsilon_r* (relative permittivity) to define *spacing_max*.</span>
<span class="sd">  </span>
<span class="sd">  Thus we define the following &quot;terms&quot; for use in this class and the meshing system:</span>
<span class="sd">  </span>
<span class="sd">  * **refractive index** *n*: ``1/spacing_max``</span>
<span class="sd">  * **relative permittivity** *epsilon_r*: ``(1/spacing_max)^2``</span>
<span class="sd">  * **resolutionScalingFactor**: ``1/(F*lambda)`` (so that increasing it, decreases *spacing_max* and therefore increases *NcellsMin*)</span>
<span class="sd">  * **Minimum number of cells** *NcellsMin* : ``ceil( abs(pos_max-pos_min)/spacing_max )``</span>

<span class="sd">  *spacing_max* can then be set via:</span>
<span class="sd">  </span>
<span class="sd">  * setSpacingMax(spacing_max)</span>
<span class="sd">  * setRefractiveIndexMin(n)</span>
<span class="sd">  * setRelativePermittivityMin(epsilon_r)</span>
<span class="sd">  * setNcellsMin(NcellsMin)</span>
<span class="sd">  </span>
<span class="sd">  Corresponding *get* functions are also available.</span>

<span class="sd">  .. note:: **resolutionScalingFactor** is only used when getLocalCoordinates() is called!</span>

<span class="sd">  :param float pos_min: minimum position</span>
<span class="sd">  :param float pos_max: maximum position</span>
<span class="sd">  :param float spacing_max: maximum *delta*, i.e. cell thickness.</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pos_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spacing_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;constructor&#39;&#39;&#39;</span>

    <span class="c1"># call any parent&#39;s class constructor.</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pos_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pos_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">pos_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pos_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">spacing_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">spacing_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">pos_max</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">pos_max</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="o">=</span> <span class="n">spacing_max</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nukeothers</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">forceEvenNumberOfCells</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span>

<div class="viewcode-block" id="HomogeneousMesh1D.PrintSelf"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.PrintSelf">[docs]</a>  <span class="k">def</span> <span class="nf">PrintSelf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function with indent&#39;&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;pos_min = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;pos_max = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;spacing_max = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;printing function&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">()</span>

<div class="viewcode-block" id="HomogeneousMesh1D.getLocalCoordinates"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.getLocalCoordinates">[docs]</a>  <span class="k">def</span> <span class="nf">getLocalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the list of coordinates. It takes into account **Mesh1D::resolutionScalingFactor**.</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Possible code duplication reduction.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowResolutionScaling</span><span class="p">:</span>
      <span class="c1"># mesh extension</span>
      <span class="n">Delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span><span class="p">)</span>
      <span class="c1"># We take the absolute value to avoid problems with linspace and the ceiling because it is a minimum value.</span>
      <span class="n">NcellsMin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolutionScalingFactor</span> <span class="o">*</span> <span class="n">Delta</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">NcellsMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNcellsMin</span><span class="p">()</span>
    
    <span class="c1"># Make sure we have at least one cell.</span>
    <span class="k">if</span> <span class="n">NcellsMin</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">NcellsMin</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1">#raise</span>
    <span class="c1">#if self.forceEvenNumberOfCells:</span>
      <span class="c1">#raise</span>
      <span class="c1">#if NcellsMin%2 == 1:</span>
        <span class="c1">#NcellsMin += 1</span>
    
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span><span class="p">,</span> <span class="n">NcellsMin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="HomogeneousMesh1D.setExtension"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.setExtension">[docs]</a>  <span class="k">def</span> <span class="nf">setExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_min</span><span class="p">,</span> <span class="n">pos_max</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;set the extension&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">pos_max</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">pos_max</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="HomogeneousMesh1D.setSpacingMax"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.setSpacingMax">[docs]</a>  <span class="k">def</span> <span class="nf">setSpacingMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing_max</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; set the maximum spacing &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="o">=</span> <span class="n">spacing_max</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.getSpacingMax"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.getSpacingMax">[docs]</a>  <span class="k">def</span> <span class="nf">getSpacingMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; get the maximum spacing &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span><span class="p">)</span></div>

<div class="viewcode-block" id="HomogeneousMesh1D.setNcellsMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.setNcellsMin">[docs]</a>  <span class="k">def</span> <span class="nf">setNcellsMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NcellsMin</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; set the minimum number of &quot;cells&quot; in the mesh (NOT the number of &quot;positions&quot;, which is ``NcellsMin + 1``) &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">NcellsMin</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="HomogeneousMesh1D.getNcellsMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.getNcellsMin">[docs]</a>  <span class="k">def</span> <span class="nf">getNcellsMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; get the minimum number of &quot;cells&quot; in the mesh (NOT the number of &quot;positions&quot;, which is ``NcellsMin + 1``) &#39;&#39;&#39;</span>
    <span class="n">NcellsMin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_max</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_min</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">NcellsMin</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">NcellsMin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">NcellsMin</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="HomogeneousMesh1D.setRelativePermittivityMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.setRelativePermittivityMin">[docs]</a>  <span class="k">def</span> <span class="nf">setRelativePermittivityMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon_r</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; set the minimum &quot;relative permittivity&quot; defined as ``(1/spacing_max)^2`` &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epsilon_r</span><span class="p">)</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.getRelativePermittivityMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.getRelativePermittivityMin">[docs]</a>  <span class="k">def</span> <span class="nf">getRelativePermittivityMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; get the minimum &quot;relative permittivity&quot; defined as ``(1/spacing_max)^2`` &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="HomogeneousMesh1D.setRefractiveIndexMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.setRefractiveIndexMin">[docs]</a>  <span class="k">def</span> <span class="nf">setRefractiveIndexMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RefractiveIndexMin</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; set the minimum &quot;refractive index&quot; defined as ``1/spacing_max`` &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">RefractiveIndexMin</span>
    <span class="k">return</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.getRefractiveIndexMin"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.getRefractiveIndexMin">[docs]</a>  <span class="k">def</span> <span class="nf">getRefractiveIndexMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; get the minimum &quot;refractive index&quot; defined as ``1/spacing_max`` &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing_max</span> <span class="p">)</span></div>
  
<div class="viewcode-block" id="HomogeneousMesh1D.renderInBlender"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.renderInBlender">[docs]</a>  <span class="k">def</span> <span class="nf">renderInBlender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">bpy</span>
    <span class="kn">import</span> <span class="nn">bmesh</span>
    <span class="kn">from</span> <span class="nn">mathutils</span> <span class="k">import</span> <span class="n">Vector</span>
    <span class="kn">from</span> <span class="nn">bpy_extras</span> <span class="k">import</span> <span class="n">object_utils</span> <span class="c1">#Blender 2.63</span>
        
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
      <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">idx</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">object_utils</span><span class="o">.</span><span class="n">object_data_add</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">group_link</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.renderXMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.renderXMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderXMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">bpy</span>
    <span class="kn">import</span> <span class="nn">bmesh</span>
    <span class="kn">from</span> <span class="nn">mathutils</span> <span class="k">import</span> <span class="n">Vector</span>
    <span class="kn">from</span> <span class="nn">bpy_extras</span> <span class="k">import</span> <span class="n">object_utils</span> <span class="c1">#Blender 2.63</span>
        
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
      <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">idx</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">object_utils</span><span class="o">.</span><span class="n">object_data_add</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">group_link</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.renderYMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.renderYMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderYMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">bpy</span>
    <span class="kn">import</span> <span class="nn">bmesh</span>
    <span class="kn">from</span> <span class="nn">mathutils</span> <span class="k">import</span> <span class="n">Vector</span>
    <span class="kn">from</span> <span class="nn">bpy_extras</span> <span class="k">import</span> <span class="n">object_utils</span> <span class="c1">#Blender 2.63</span>
        
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
      <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">idx</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">object_utils</span><span class="o">.</span><span class="n">object_data_add</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">group_link</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="HomogeneousMesh1D.renderZMesh1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMesh1D.renderZMesh1D">[docs]</a>  <span class="k">def</span> <span class="nf">renderZMesh1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;meshes&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">bpy</span>
    <span class="kn">import</span> <span class="nn">bmesh</span>
    <span class="kn">from</span> <span class="nn">mathutils</span> <span class="k">import</span> <span class="n">Vector</span>
    <span class="kn">from</span> <span class="nn">bpy_extras</span> <span class="k">import</span> <span class="n">object_utils</span> <span class="c1">#Blender 2.63</span>
        
    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
      <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">idx</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
      <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">new</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="p">],</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">object_utils</span><span class="o">.</span><span class="n">object_data_add</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    
    <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">group_link</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div></div>
    
<div class="viewcode-block" id="HomogeneousMeshParameters1D"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.HomogeneousMeshParameters1D">[docs]</a><span class="k">class</span> <span class="nc">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="n">HomogeneousMesh1D</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A subclass of *HomogeneousMesh1D*, but for which the *MultiMesh1D::getLocalCoordinates()* function will take *spacing_max* into account to merge multiple *HomogeneousMeshParameters1D* in a smart way.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">pass</span></div>

<div class="viewcode-block" id="linspaces"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.linspaces">[docs]</a><span class="k">def</span> <span class="nf">linspaces</span><span class="p">(</span><span class="n">part_limits</span><span class="p">,</span> <span class="n">Ncells_per_part</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Return evenly spaced numbers over specified intervals.</span>
<span class="sd">  </span>
<span class="sd">  Example::</span>
<span class="sd">  </span>
<span class="sd">    &gt;&gt;&gt; linspaces([0,1,2,3,4], [2,3,4,5])</span>
<span class="sd">    [0.0, 0.5, # 2 cells on [0,1]</span>
<span class="sd">    1.0, 1.3333333333333333, 1.6666666666666665, # 3 cells on [1,2]</span>
<span class="sd">    2.0, 2.25, 2.5, 2.75, # 4 cells on [2,3]</span>
<span class="sd">    3.0, 3.2000000000000002, 3.3999999999999999, 3.6000000000000001, 3.7999999999999998, # 5 cells on [3,4]</span>
<span class="sd">    4.0]</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c1"># part_limits: length N+1</span>
  <span class="c1"># Ncells_per_part: length N</span>
  <span class="n">mesh_position_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">Ncells</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Ncells_per_part</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">part_limits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">part_limits</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">foo</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">part_limits</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">part_limits</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Ncells</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
        <span class="n">mesh_position_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">mesh_position_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
  <span class="k">return</span> <span class="n">mesh_position_list</span></div>

<div class="viewcode-block" id="subGridMultiLayer"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.subGridMultiLayer">[docs]</a><span class="k">def</span> <span class="nf">subGridMultiLayer</span><span class="p">(</span><span class="n">Section_MaxDeltaVector_in</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.76</span><span class="p">,</span> <span class="mf">2.1385</span><span class="p">,</span> <span class="mf">2.3535</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Section_ThicknessVector_in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
  <span class="sd">&#39;&#39;&#39; Create a list of thicknesses for meshing</span>
<span class="sd">  </span>
<span class="sd">  Usage::</span>
<span class="sd">  </span>
<span class="sd">    [Mesh_ThicknessVector, Section_FinalDeltaVector] = subGridMultiLayer(Section_MaxDeltaVector_in, Section_ThicknessVector_in)</span>
<span class="sd">  </span>
<span class="sd">  :param Section_ThicknessVector_in: list of the thickness of each section</span>
<span class="sd">  :param Section_MaxDeltaVector_in: list of maximum allowed deltas in each section</span>
<span class="sd">  </span>
<span class="sd">  :return: [Mesh_ThicknessVector, Section_FinalDeltaVector] where:</span>
<span class="sd">    * Mesh_ThicknessVector = thickness vector of the mesh</span>
<span class="sd">    * Section_FinalDeltaVector = list of final deltas used in the mesh</span>
<span class="sd">  </span>
<span class="sd">  Example::</span>
<span class="sd">  </span>
<span class="sd">    subGridMultiLayer([0.4,0.6,1], [2,3,5])</span>
<span class="sd">    </span>
<span class="sd">  This would return::</span>
<span class="sd">  </span>
<span class="sd">    Mesh_ThicknessVector = [ 0.4,  0.4,  0.4,  0.4,  0.4,</span>
<span class="sd">                             0.6,  0.6,  0.6,  0.6,  0.6,</span>
<span class="sd">                             1. , 1. ,  1. ,  1. ,  1. ]</span>
<span class="sd">    Section_FinalDeltaVector = [ 0.4,  0.6,  1. ]</span>
<span class="sd">  </span>
<span class="sd">  .. note:: If you are switching from the old to the new subGridMultiLayer version, replace the arguments as follows:</span>
<span class="sd">  </span>
<span class="sd">    * Section_MaxDeltaVector(new) = lambda(old)/16./indexVector(old)</span>
<span class="sd">    * Section_ThicknessVector(new) = thicknessVector(old)</span>

<span class="sd">  .. todo:: Make it work with Section_MaxDelta = numpy.inf as well.</span>

<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="c1"># check lengths</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Section_ThicknessVector_in</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">Section_MaxDeltaVector_in</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;FATAL ERROR: len(Section_ThicknessVector_in)!=len(Section_MaxDeltaVector_in)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
  <span class="c1">#if 0 in Section_ThicknessVector_in:</span>
    <span class="c1">#print(&#39;WARNING: Section_ThicknessVector_in contains zeroes&#39;)</span>
  
  <span class="n">Section_ThicknessVector</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">Section_MaxDeltaVector</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Section_ThicknessVector_in</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">Section_ThicknessVector_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">Section_ThicknessVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section_ThicknessVector_in</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">Section_MaxDeltaVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section_MaxDeltaVector_in</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      
  <span class="c1"># check for zeroes</span>
  <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">Section_MaxDeltaVector</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;FATAL ERROR: Section_MaxDeltaVector contains zeroes : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Section_MaxDeltaVector</span><span class="p">)))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="n">Section_MaxDeltaVector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Section_MaxDeltaVector</span><span class="p">)</span>
  <span class="n">Section_ThicknessVector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Section_MaxDeltaVector</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;FATAL ERROR: The 2 input vectors do not have the same size.&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">Section_MaxDeltaVector</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;FATAL ERROR: Section_MaxDeltaVector contains negative values: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Section_MaxDeltaVector</span><span class="p">))</span>

  <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;FATAL ERROR: Section_ThicknessVector contains negative values: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">))</span>

  <span class="n">totalHeight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">);</span>

  <span class="n">nLayers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Section_ThicknessVector</span><span class="p">);</span>

  <span class="n">nCellsV</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="n">Section_ThicknessVector</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">Section_MaxDeltaVector</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="p">)</span>
  <span class="c1">#print(&#39;nCellsV&#39;)</span>
  <span class="c1">#print(nCellsV)</span>
  <span class="c1">#sys.exit(-1)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nCellsV</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">nCellsV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">nCellsV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    
  <span class="n">Section_FinalDeltaVector</span> <span class="o">=</span> <span class="n">Section_ThicknessVector</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">nCellsV</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

  <span class="n">Mesh_ThicknessVector</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLayers</span><span class="p">):</span>
    <span class="n">Mesh_ThicknessVector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span> <span class="n">Mesh_ThicknessVector</span><span class="p">,</span> <span class="n">Section_FinalDeltaVector</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nCellsV</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span> <span class="p">)</span> <span class="p">)</span>

  <span class="k">return</span><span class="p">(</span><span class="n">Mesh_ThicknessVector</span><span class="p">,</span> <span class="n">Section_FinalDeltaVector</span><span class="p">)</span></div>

<div class="viewcode-block" id="mergeMeshingParameters"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.mergeMeshingParameters">[docs]</a><span class="k">def</span> <span class="nf">mergeMeshingParameters</span><span class="p">(</span><span class="n">MeshParamsList</span><span class="p">,</span> <span class="n">minimum_mesh_delta</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns a mesh based on a list of *MeshParams* objects.</span>
<span class="sd">  </span>
<span class="sd">  Original plan:</span>
<span class="sd">  </span>
<span class="sd">  * Return parameters that can be used for meshing with subGridMultiLayer.</span>
<span class="sd">  * Use in calculateMeshingParameters() function.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="c1">#print((&#39;MeshParamsList&#39;, MeshParamsList))</span>

  <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MeshParamsList</span><span class="p">)</span>
  
  <span class="c1"># Xvec is an array of size (N,2) containing a list of (lower,upper) pairs corresponding to the meshing subdomains defined by the various geometrical objects.</span>
  <span class="c1"># epsX is an array of size (N,1) containing a list of epsilon values corresponding to the meshing subdomains defined by the various geometrical objects.</span>
  <span class="c1"># The (lower,upper) pairs from Xvec are associated with the corresponding epsilon values from epsX to determine an appropriate mesh in the X direction.</span>
  <span class="n">Xvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">epsX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">mesh_params_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">mesh_params</span> <span class="o">=</span> <span class="n">MeshParamsList</span><span class="p">[</span><span class="n">mesh_params_idx</span><span class="p">]</span>
    <span class="n">Xvec</span><span class="p">[</span><span class="n">mesh_params_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_params</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">+</span> <span class="n">mesh_params</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    <span class="n">Xvec</span><span class="p">[</span><span class="n">mesh_params_idx</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_params</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">+</span> <span class="n">mesh_params</span><span class="o">.</span><span class="n">getGlobalLocation</span><span class="p">()</span>
    <span class="n">epsX</span><span class="p">[</span><span class="n">mesh_params_idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh_params</span><span class="o">.</span><span class="n">getSpacingMax</span><span class="p">()</span>
  
  <span class="n">VX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Xvec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Xvec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]])))</span>
  <span class="n">MX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Xvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">VX</span><span class="p">)))</span> <span class="c1"># We fill with numpy.inf so that when we take the min(), those values get discarded.</span>

  <span class="c1"># Fill MX so that each line is filled with the eps for that line, but only in the ranges where it should apply.</span>
  <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Xvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">indmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VX</span><span class="o">==</span><span class="n">Xvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># index in VX of Xvec[m,0] (=pos_min)</span>
    <span class="n">indmaX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">VX</span><span class="o">==</span><span class="n">Xvec</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># index in VX of Xvec[m,1] (=pos_max)</span>
    <span class="n">MX</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">indmin</span><span class="p">:</span><span class="n">indmaX</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsX</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1">#print((&#39;VX&#39;,VX))</span>
  <span class="c1">#print((&#39;MX&#39;,MX))</span>

  <span class="c1">#VX, MX = nukeMesh(VX, MX, nuke_lower, nuke_upper)</span>

  <span class="c1"># Compute thickness vector from position vector</span>
  <span class="n">thicknessVX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">VX</span><span class="p">)</span>
    
  <span class="c1"># epsVX = MX minus the last column</span>
  <span class="n">epsVX</span> <span class="o">=</span> <span class="n">MX</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">MX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="c1">#print((&#39;epsVX&#39;, epsVX))</span>

  <span class="n">epsVX</span> <span class="o">=</span> <span class="n">epsVX</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># different from current implementation in bfdtd_parser automesher!</span>
  
  <span class="c1">#print((&#39;epsVX&#39;, epsVX))</span>
  
  <span class="n">maxPermittivityVector_X</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">thicknessVector_X</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="c1"># TODO: use (thickness, epsilon) tuples so that filter() and similar functions can be used. Also prevents errors if lists have different lengths.</span>
  <span class="c1"># ex: t = filter(lambda x: x&gt;=1, t)</span>
  <span class="c1"># filter out parts smaller than minimum_mesh_delta_vector3[i]</span>
  <span class="c1"># NOTE: This might lead to errors because we never make up for the eliminated layers.</span>
  <span class="c1"># TODO: Fix by merging close lines instead of simply ignoring the corresponding layers.</span>
  <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thicknessVX</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">thicknessVX</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_mesh_delta</span><span class="p">:</span>
      <span class="n">maxPermittivityVector_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsVX</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
      <span class="n">thicknessVector_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thicknessVX</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span>  <span class="n">offset</span><span class="p">)</span>
      <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">offset</span> <span class="o">+=</span> <span class="n">thicknessVX</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
      <span class="c1">#raise Exception(&#39;TODO: Handle this case properly.&#39;)</span>
  
  <span class="c1">## TODO: Do the smoothing here.</span>
  <span class="c1">#spacing_max_new = []</span>
  <span class="c1">#thickness_new = []</span>
  <span class="c1">#maximum_mesh_delta_ratio = 2</span>
  <span class="c1">#for idx in range(len(maxPermittivityVector_X)):</span>
    <span class="c1">#delta_current = maxPermittivityVector_X[idx]</span>
    <span class="c1">#left_ok = True</span>
    <span class="c1">#right_ok = True</span>
    
    <span class="c1">#if idx-1 &gt; 0:</span>
      <span class="c1">#if delta_current &gt; maximum_mesh_delta_ratio*maxPermittivityVector_X[idx-1]:</span>
        <span class="c1">#left_ok = False</span>
    <span class="c1">#if idx+1 &lt; len(maxPermittivityVector_X):</span>
      <span class="c1">#if delta_current &gt; maximum_mesh_delta_ratio*maxPermittivityVector_X[idx+1]:</span>
        <span class="c1">#right_ok = False</span>
        
    <span class="c1">#if left_ok and right_ok:</span>
      <span class="c1">#spacing_max_new.append(maxPermittivityVector_X[idx])</span>
      <span class="c1">#thickness_new.append(thicknessVector_X[idx])</span>
    <span class="c1">#else:</span>
      <span class="c1">#pass # TODO: finish this</span>
      
  <span class="c1">#print(maxPermittivityVector_X, thicknessVector_X)</span>
  <span class="c1">#print(spacing_max_new, thickness_new)</span>
  
  <span class="n">delta_X_vector</span><span class="p">,</span> <span class="n">local_delta_X_vector</span> <span class="o">=</span> <span class="n">subGridMultiLayer</span><span class="p">(</span><span class="n">maxPermittivityVector_X</span><span class="p">,</span> <span class="n">thicknessVector_X</span><span class="p">)</span>

  <span class="n">mesh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">VX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">delta_X_vector</span><span class="p">)))</span>
  
  <span class="k">return</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="checkMesh"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.checkMesh">[docs]</a><span class="k">def</span> <span class="nf">checkMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">minimum_mesh_delta</span><span class="p">,</span> <span class="n">maximum_mesh_delta_ratio</span><span class="p">):</span>
  <span class="c1"># validate the mesh (min cell size, max cell size and smoothness)</span>
  <span class="c1"># TODO: later</span>
  
  <span class="n">minimum_mesh_delta_in_mesh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
  <span class="n">minimum_mesh_delta_in_mesh_idx</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">maximum_mesh_delta_ratio_in_mesh</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">maximum_mesh_delta_ratio_in_mesh_idx</span> <span class="o">=</span> <span class="kc">None</span>
  
  <span class="n">thickness_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thickness_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">thickness</span> <span class="o">&lt;</span> <span class="n">minimum_mesh_delta_in_mesh</span><span class="p">:</span>
      <span class="n">minimum_mesh_delta_in_mesh</span> <span class="o">=</span> <span class="n">thickness</span>
      <span class="n">minimum_mesh_delta_in_mesh_idx</span> <span class="o">=</span> <span class="n">idx</span>
    <span class="k">if</span> <span class="n">minimum_mesh_delta</span> <span class="ow">and</span> <span class="n">thickness</span> <span class="o">&lt;</span> <span class="n">minimum_mesh_delta</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;at idx=</span><span class="si">{}</span><span class="s1"> mesh[idx]=</span><span class="si">{}</span><span class="s1">: (thickness=</span><span class="si">{}</span><span class="s1">) &lt; (minimum_mesh_delta=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">mesh</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">minimum_mesh_delta</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">thickness_list</span><span class="p">):</span>
      <span class="n">t0</span> <span class="o">=</span> <span class="n">thickness_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
      <span class="n">t1</span> <span class="o">=</span> <span class="n">thickness_list</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">local_ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="nb">min</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">local_ratio</span> <span class="o">&gt;</span> <span class="n">maximum_mesh_delta_ratio_in_mesh</span><span class="p">:</span>
        <span class="n">maximum_mesh_delta_ratio_in_mesh</span> <span class="o">=</span> <span class="n">local_ratio</span>
        <span class="n">maximum_mesh_delta_ratio_in_mesh_idx</span> <span class="o">=</span> <span class="n">idx</span>
      <span class="k">if</span> <span class="n">maximum_mesh_delta_ratio</span> <span class="ow">and</span> <span class="n">local_ratio</span> <span class="o">&gt;</span> <span class="n">maximum_mesh_delta_ratio</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;at idx=</span><span class="si">{}</span><span class="s1"> mesh[idx]=</span><span class="si">{}</span><span class="s1">: (max(t0,t1)=</span><span class="si">{}</span><span class="s1">/min(t0,t1)=</span><span class="si">{}</span><span class="s1">) = </span><span class="si">{}</span><span class="s1"> &gt; maximum_mesh_delta_ratio=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">mesh</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">),</span> <span class="n">local_ratio</span><span class="p">,</span> <span class="n">maximum_mesh_delta_ratio</span><span class="p">))</span>
  
  <span class="k">return</span> <span class="p">(</span><span class="n">minimum_mesh_delta_in_mesh</span><span class="p">,</span> <span class="n">maximum_mesh_delta_ratio_in_mesh</span><span class="p">,</span> <span class="n">minimum_mesh_delta_in_mesh_idx</span><span class="p">,</span> <span class="n">maximum_mesh_delta_ratio_in_mesh_idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="truncateMeshList"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.truncateMeshList">[docs]</a><span class="k">def</span> <span class="nf">truncateMeshList</span><span class="p">(</span><span class="n">mesh_list</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; remove all submeshes where pos_min or pos_max are outside of [lower, upper] &#39;&#39;&#39;</span>
  
  <span class="c1">#default return value</span>
  <span class="n">new_mesh_list</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="c1">#print(&#39;lower={} upper={}&#39;.format(lower, upper))</span>
  <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">mesh_list</span><span class="p">:</span>
    <span class="c1">#print(&#39;mesh.pos_min={} mesh.pos_max={}&#39;.format(mesh.pos_min, mesh.pos_max))</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">pos_min</span> <span class="o">&lt;=</span> <span class="n">upper</span> <span class="ow">and</span> <span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">pos_max</span> <span class="o">&lt;=</span> <span class="n">upper</span><span class="p">:</span>
      <span class="c1">#print(&#39;OK&#39;)</span>
      <span class="n">new_mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">new_mesh_list</span></div>

<div class="viewcode-block" id="increaseResolution"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.increaseResolution">[docs]</a><span class="k">def</span> <span class="nf">increaseResolution</span><span class="p">(</span><span class="n">mesh_orig</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Increase the resolution of a mesh by dividing each cell into N equal cells.</span>
<span class="sd">  This means that a mesh with C cells and P = C+1 points will turn into a mesh with C&#39; = N*C cells and P&#39; = N*C+1 = P+(P-1)*(N-1) = P*N-(N-1) points.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">linspaces</span><span class="p">(</span><span class="n">mesh_orig</span><span class="p">,</span> <span class="n">N</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh_orig</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span></div>
  <span class="c1">#P = len(mesh_orig)</span>
  <span class="c1">#C = P-1</span>
  <span class="c1">#Pp = N*C+1</span>
  <span class="c1">#mesh_new = numpy.zeros(Pp)</span>
  <span class="c1">#for idx in range(P-1):</span>
    <span class="c1">#mesh_new[N*idx] = mesh_orig[idx]</span>
    
  <span class="c1">#return mesh_new</span>

<div class="viewcode-block" id="test_Meshing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing">[docs]</a><span class="k">class</span> <span class="nc">test_Meshing</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
  
<div class="viewcode-block" id="test_Meshing.setUp"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.setUp">[docs]</a>  <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="test_Meshing.test_printing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_printing">[docs]</a>  <span class="k">def</span> <span class="nf">test_printing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; test and example of the meshing system &#39;&#39;&#39;</span>
    
    <span class="n">param</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">PrintSelf</span><span class="p">(</span><span class="s1">&#39;fdsjhfsdjkh ---&gt;&#39;</span><span class="p">))</span>
    
    <span class="c1"># basic printing tests</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Mesh3D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">hetero</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hetero</span><span class="p">)</span>
    <span class="n">hetero</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hetero</span><span class="p">)</span>
    <span class="n">homo</span> <span class="o">=</span> <span class="n">HomogeneousMesh1D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">homo</span><span class="p">)</span>
    <span class="n">homo</span> <span class="o">=</span> <span class="n">HomogeneousMesh1D</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">homo</span><span class="p">)</span>
    <span class="n">homo</span> <span class="o">=</span> <span class="n">HomogeneousMesh1D</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">homo</span><span class="p">)</span>
    <span class="n">homo</span> <span class="o">=</span> <span class="n">HomogeneousMesh1D</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">homo</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiMesh1D</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== PART 1 =======&#39;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">homo</span><span class="p">,</span> <span class="n">hetero</span><span class="p">,</span> <span class="n">multi</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========&#39;</span><span class="p">)</span>
    <span class="c1">#c = obj.getLocalXCoordinates() # Currently broken. Do we need it?</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getGlobalXCoordinates</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== PART 2 =======&#39;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">homo</span><span class="p">,</span> <span class="n">hetero</span><span class="p">,</span> <span class="n">multi</span><span class="p">,</span> <span class="n">param</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="c1">#print(&#39;==========&#39;)</span>
    <span class="c1">#print(obj.PrintSelf(5*&#39;^&#39;))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== get =======&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getGlobalXCoordinates</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== print =======&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========&#39;</span><span class="p">)</span>
    
    <span class="c1">#print(param.PrintSelf(&#39;hello =&gt;&#39;))</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="test_Meshing.test_linspaces"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_linspaces">[docs]</a>  <span class="k">def</span> <span class="nf">test_linspaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">part_limits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">Ncells_per_part</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">mesh_position_list</span> <span class="o">=</span> <span class="n">linspaces</span><span class="p">(</span><span class="n">part_limits</span><span class="p">,</span> <span class="n">Ncells_per_part</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;part_limits&#39;</span><span class="p">,</span> <span class="n">part_limits</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Ncells_per_part&#39;</span><span class="p">,</span> <span class="n">Ncells_per_part</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;mesh_position_list&#39;</span><span class="p">,</span> <span class="n">mesh_position_list</span><span class="p">))</span></div>

<div class="viewcode-block" id="test_Meshing.test_subGridMultiLayer"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_subGridMultiLayer">[docs]</a>  <span class="k">def</span> <span class="nf">test_subGridMultiLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">Mesh_ThicknessVector</span><span class="p">,</span> <span class="n">Section_FinalDeltaVector</span> <span class="o">=</span> <span class="n">subGridMultiLayer</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Mesh_ThicknessVector = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Mesh_ThicknessVector</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Section_FinalDeltaVector = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Section_FinalDeltaVector</span><span class="p">)))</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="test_Meshing.test_mergeMeshingParameters"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_mergeMeshingParameters">[docs]</a>  <span class="k">def</span> <span class="nf">test_mergeMeshingParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">MeshParamsList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.20</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">4.25</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.10</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.25</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.15</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">MeshParamsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="n">merged</span> <span class="o">=</span> <span class="n">mergeMeshingParameters</span><span class="p">(</span><span class="n">MeshParamsList</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MeshParamsList</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;== mesh </span><span class="si">%d</span><span class="s1"> ==&#39;</span><span class="o">%</span><span class="n">idx</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">MeshParamsList</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;== merged ==&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="test_Meshing.test_parenting"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_parenting">[docs]</a>  <span class="k">def</span> <span class="nf">test_parenting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">grandpa</span> <span class="o">=</span> <span class="n">Mesh3D</span><span class="p">()</span>
    <span class="n">grandpa</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;grandpa&#39;</span>
    <span class="n">grandpa</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
    <span class="n">grandpa</span><span class="o">.</span><span class="n">xmesh</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grandpa</span><span class="o">.</span><span class="n">ymesh</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grandpa</span><span class="o">.</span><span class="n">zmesh</span><span class="o">.</span><span class="n">mesh_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">papa</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">papa</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;papa&#39;</span>
    <span class="n">papa</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
    
    <span class="n">child</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;child&#39;</span>
    <span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">papa</span>
    <span class="n">child</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="n">subchild</span> <span class="o">=</span> <span class="n">HeterogeneousMesh1D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">43</span><span class="p">,</span><span class="o">-</span><span class="mi">84</span><span class="p">])</span>
    <span class="n">subchild</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;subchild&#39;</span>
    <span class="n">subchild</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">child</span>
    <span class="n">subchild</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=====&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">papa</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;local: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">papa</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;global: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">papa</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=====&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;local: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;global: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=====&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">subchild</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;local: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subchild</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;global: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subchild</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()))</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="test_Meshing.test_MeshPostprocessing"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_MeshPostprocessing">[docs]</a>  <span class="k">def</span> <span class="nf">test_MeshPostprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">mesh1</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mesh1</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">mesh2</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">mesh3</span> <span class="o">=</span> <span class="n">HomogeneousMeshParameters1D</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">mesh3</span><span class="o">.</span><span class="n">setSpacingMax</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiMesh1D</span><span class="p">()</span>
    <span class="c1">#multi.maximum_mesh_delta_ratio = None</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh1</span><span class="p">)</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">mesh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh3</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">())</span>
    
    <span class="k">return</span></div>

<div class="viewcode-block" id="test_Meshing.test_nuke"><a class="viewcode-back" href="../../meshing.html#meshing.meshing.test_Meshing.test_nuke">[docs]</a>  <span class="k">def</span> <span class="nf">test_nuke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#.nukeothers</span>
    <span class="k">return</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Mike Taverne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>