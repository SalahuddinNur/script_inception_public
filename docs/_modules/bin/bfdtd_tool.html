
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>bin.bfdtd_tool &#8212; script_inception_public  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for bin.bfdtd_tool</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">script to quickly get various info from bfdtd related files</span>

<span class="sd">.. todo:: Integrate some of those functions into the BFDTD class?</span>
<span class="sd">.. todo:: Add something to create epsilon snapshots from a geometry? based on existing mode volume frequency snapshots?</span>
<span class="sd">.. todo:: Figure out how to pass lists of float via @config files...</span>
<span class="sd">.. todo:: move from parser groups to subparsers</span>
<span class="sd">.. todo:: Use parent parsers for input, output, verbose, etc?</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### Useful for debugging:</span>
<span class="c1">#import code</span>
<span class="c1">#code.interact(local=locals())</span>

<span class="c1">#for k,v in arguments.__dict__.items():</span>
  <span class="c1">#print((k,v))</span>
<span class="c1">#return</span>

<span class="kn">import</span> <span class="nn">bfdtd.bfdtd_parser</span> <span class="k">as</span> <span class="nn">bfdtd</span>
<span class="kn">from</span> <span class="nn">utilities.common</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utilities.brisFDTD_ID_info</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">constants</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">utilities.brisFDTD_ID_info</span> <span class="k">as</span> <span class="nn">brisFDTD_ID_info</span>
<span class="kn">import</span> <span class="nn">tkinter.filedialog</span>

<span class="kn">import</span> <span class="nn">bfdtd</span>

<span class="c1"># .. todo:: PyQt5+argparseui disabled until set up again. Fix.</span>
<span class="c1">#from PyQt5 import QtWidgets</span>
<span class="c1">#import argparseui</span>

<span class="kn">from</span> <span class="nn">utilities.harminv</span> <span class="k">import</span> <span class="n">getFrequencies</span>

<div class="viewcode-block" id="printNcells"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printNcells">[docs]</a><span class="k">def</span> <span class="nf">printNcells</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">getNcells</span><span class="p">())</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="printExcitation"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printExcitation">[docs]</a><span class="k">def</span> <span class="nf">printExcitation</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== excitation &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; ===&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="printSnapshotFrequencyList"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printSnapshotFrequencyList">[docs]</a><span class="k">def</span> <span class="nf">printSnapshotFrequencyList</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">getSnapshotFrequencySet</span><span class="p">())</span>
  <span class="k">return</span></div>
  
<div class="viewcode-block" id="printAll"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printAll">[docs]</a><span class="k">def</span> <span class="nf">printAll</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">sim_in</span><span class="p">)</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="printExcitationDirection"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printExcitationDirection">[docs]</a><span class="k">def</span> <span class="nf">printExcitationDirection</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">id_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== excitation &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; ===&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sim_in</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="rotate"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.rotate">[docs]</a><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">axis_point</span><span class="p">,</span> <span class="n">axis_direction</span><span class="p">,</span> <span class="n">angle_degrees</span><span class="p">):</span>
  <span class="n">sim</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">axis_point</span><span class="p">,</span> <span class="n">axis_direction</span><span class="p">,</span> <span class="n">angle_degrees</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">writeGeoFile</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="automeshWithMeshingFactor"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.automeshWithMeshingFactor">[docs]</a><span class="k">def</span> <span class="nf">automeshWithMeshingFactor</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">meshing_factor</span><span class="p">):</span>
  <span class="n">sim</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">meshing_factor</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<span class="c1"># .. todo:: finish this in a nice usable way</span>
<div class="viewcode-block" id="automeshWithMaxCells"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.automeshWithMaxCells">[docs]</a><span class="k">def</span> <span class="nf">automeshWithMaxCells</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">meshing_factor</span><span class="p">,</span> <span class="n">MAXCELLS</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
  <span class="n">sim</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">meshing_factor</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>

  <span class="n">sim</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">Lambda</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
  <span class="k">while</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">getNcells</span><span class="p">()</span><span class="o">&gt;</span><span class="n">MAXCELLS</span> <span class="ow">and</span> <span class="n">a</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">autoMeshGeometry</span><span class="p">(</span><span class="n">Lambda</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeInpFile"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.writeInpFile">[docs]</a><span class="k">def</span> <span class="nf">writeInpFile</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="c1"># read input</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
      <span class="n">FDTDobj</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="c1"># write output</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">)</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="printFrequencySnapshotInfo"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printFrequencySnapshotInfo">[docs]</a><span class="k">def</span> <span class="nf">printFrequencySnapshotInfo</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">BFDTDreader_verbosity</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fsnap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FDTDobj</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;idx+1=</span><span class="si">{}</span><span class="s1">, name=</span><span class="si">{}</span><span class="s1">, plane=</span><span class="si">{}</span><span class="s1">, f=</span><span class="si">{}</span><span class="s1">, centro=</span><span class="si">{}</span><span class="s1">, pos:</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getPlaneLetter</span><span class="p">(),</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getFrequencies</span><span class="p">(),</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getCentro</span><span class="p">(),</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getPlaneLetter</span><span class="p">(),</span>
                                                             <span class="n">fsnap</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()[</span><span class="n">fsnap</span><span class="o">.</span><span class="n">getPlanePythonIndex</span><span class="p">()]))</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="printFormattedString"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.printFormattedString">[docs]</a><span class="k">def</span> <span class="nf">printFormattedString</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">BFDTDreader_verbosity</span><span class="p">)</span>

  <span class="n">dt</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">getTimeStep</span><span class="p">()</span>
  <span class="n">iterations</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">getIterations</span><span class="p">()</span>
  <span class="n">total_time</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">getSimulationTime</span><span class="p">()</span>
  
  <span class="n">lmin</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">lcen</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">lmax</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">fmin</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">fcen</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">fmax</span><span class="o">=</span><span class="p">[]</span>
  <span class="n">eloc</span><span class="o">=</span><span class="p">[]</span>
  
  <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">getExcitations</span><span class="p">():</span>
    <span class="n">lmin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getWavelengthMin</span><span class="p">())</span>
    <span class="n">lcen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getWavelength</span><span class="p">())</span>
    <span class="n">lmax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getWavelengthMax</span><span class="p">())</span>
    <span class="n">fmin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMin</span><span class="p">())</span>
    <span class="n">fcen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">())</span>
    <span class="n">fmax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getFrequencyMax</span><span class="p">())</span>
    <span class="n">eloc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>

  <span class="nb">print</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="p">,</span>
                                <span class="n">total_time</span> <span class="o">=</span> <span class="n">total_time</span><span class="p">,</span>
                                <span class="n">iterations</span> <span class="o">=</span> <span class="n">iterations</span><span class="p">,</span>
                                <span class="n">lmin</span> <span class="o">=</span> <span class="n">lmin</span><span class="p">,</span>
                                <span class="n">lcen</span> <span class="o">=</span> <span class="n">lcen</span><span class="p">,</span>
                                <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                                <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span><span class="p">,</span>
                                <span class="n">fcen</span> <span class="o">=</span> <span class="n">fcen</span><span class="p">,</span>
                                <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span><span class="p">,</span>
                                <span class="n">eloc</span> <span class="o">=</span> <span class="n">eloc</span>
                                <span class="p">))</span>
  <span class="k">return</span></div>

<div class="viewcode-block" id="fixSnapshots"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.fixSnapshots">[docs]</a><span class="k">def</span> <span class="nf">fixSnapshots</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">newbasename</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  -read infile</span>
<span class="sd">  -remove any time snapshots</span>
<span class="sd">  -set frequency snapshots to first=3200, repetition=32000</span>
<span class="sd">  -move snapshots 1 grid away from excitation.P1</span>
<span class="sd">  -write to ./fixedSnapshots/newbasename</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">sim</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">clearTimeSnapshots</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">3200</span>
    <span class="n">s</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="mi">32000</span>

  <span class="n">refP</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">P1</span>

  <span class="p">(</span><span class="n">idxX</span><span class="p">,</span><span class="n">valX</span><span class="p">)</span><span class="o">=</span><span class="n">findNearest</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">(),</span><span class="n">refP</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="p">(</span><span class="n">idxY</span><span class="p">,</span><span class="n">valY</span><span class="p">)</span><span class="o">=</span><span class="n">findNearest</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">(),</span><span class="n">refP</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="p">(</span><span class="n">idxZ</span><span class="p">,</span><span class="n">valZ</span><span class="p">)</span><span class="o">=</span><span class="n">findNearest</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">(),</span><span class="n">refP</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

  <span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()[</span><span class="n">idxX</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()[</span><span class="n">idxY</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()[</span><span class="n">idxZ</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

  <span class="n">sim</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="s1">&#39;./fixedSnapshots&#39;</span><span class="p">,</span><span class="n">newbasename</span><span class="p">)</span></div>

<div class="viewcode-block" id="addModeVolumeFrequencySnapshots"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.addModeVolumeFrequencySnapshots">[docs]</a><span class="k">def</span> <span class="nf">addModeVolumeFrequencySnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  .. todo:: find nice generic+flexible system for this...</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  
  <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getSizeAndResolution</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;res = &#39;</span><span class="p">,</span><span class="n">res</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># take the direction with the smallest number of snapshots to reduce number of generated .prn files</span>
    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">res</span><span class="p">))]</span>
    
  <span class="n">frequency_vector</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">readFreqFromInput</span><span class="p">:</span>
    <span class="c1">#print(&#39;FUUUUUUUUUUUUUUUUUUUU&#39;)</span>
    <span class="n">frequency_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">freq_snap</span> <span class="ow">in</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">frequency_snapshot_list</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freq_snap</span><span class="o">.</span><span class="n">frequency_vector</span><span class="p">:</span>
        <span class="n">frequency_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frequency_vector</span><span class="p">)</span>

    <span class="c1">#sys.exit(-1)</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">freqListFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">getFrequencies</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">freqListFile</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">wavelength_mum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">wavelength_mum</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">frequency_MHz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">frequency_MHz</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_vector</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Great scot! You forgot to specify frequencies.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span>
  
  <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;ModeVolume&#39;</span>
  <span class="c1">#print(arguments.slicing_direction)</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span> <span class="o">+</span> <span class="s1">&#39;.eps&#39;</span>
      <span class="n">e</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">e</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># So that only one epsilon snapshot is created. We don&#39;t need more.</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span> <span class="o">+</span> <span class="s1">&#39;.freq&#39;</span>
      <span class="n">f</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">first</span>
      <span class="n">f</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">repetition</span>
      <span class="n">f</span><span class="o">.</span><span class="n">starting_sample</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">starting_sample</span>
      <span class="n">f</span><span class="o">.</span><span class="n">frequency_vector</span> <span class="o">=</span> <span class="n">frequency_vector</span>
  <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span> <span class="o">+</span> <span class="s1">&#39;.eps&#39;</span>
      <span class="n">e</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">e</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># So that only one epsilon snapshot is created. We don&#39;t need more.</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span> <span class="o">+</span> <span class="s1">&#39;.freq&#39;</span>
      <span class="n">f</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">first</span>
      <span class="n">f</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">repetition</span>
      <span class="n">f</span><span class="o">.</span><span class="n">starting_sample</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">starting_sample</span>
      <span class="n">f</span><span class="o">.</span><span class="n">frequency_vector</span> <span class="o">=</span> <span class="n">frequency_vector</span>
  <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
    <span class="c1">#for pos in pos_list:</span>
    <span class="c1"># another quick hack to reduce the number of snapshots to 101 around the center... .. todo:: add options for that...</span>
    <span class="n">reduced_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_list</span><span class="p">))</span>
    <span class="n">pos_mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#reduced_range = pos_list[ pos_mid-50:pos_mid+50+1]</span>
    <span class="n">reduced_range</span> <span class="o">=</span> <span class="n">pos_list</span><span class="p">[</span> <span class="n">pos_mid</span><span class="o">-</span><span class="mi">25</span><span class="p">:</span><span class="n">pos_mid</span><span class="o">+</span><span class="mi">25</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#reduced_range = pos_list[ pos_mid-1:pos_mid+1+1]</span>
    <span class="c1">#reduced_range = pos_list[ pos_mid-12:pos_mid+12+1]</span>

    <span class="c1"># temporary hack</span>
    <span class="c1">#arguments.repetition = FDTDobj.flag.iterations - arguments.first</span>
    
    <span class="n">full_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">reduced_range</span><span class="p">:</span>
      <span class="c1">##pos = pos_list[idx]</span>
      <span class="c1">#e = FDTDobj.addEpsilonSnapshot(&#39;Z&#39;,pos)</span>
      <span class="c1">#e.name = NAME + &#39;.eps&#39;</span>
      <span class="c1">#e.first = 1</span>
      <span class="c1">#e.repetition = FDTDobj.flag.iterations + 1 # So that only one epsilon snapshot is created. We don&#39;t need more.</span>
      
      <span class="c1">## and more quick hacks...</span>
      <span class="c1">#e.P1[0] = min(reduced_range)</span>
      <span class="c1">#e.P1[1] = min(reduced_range)</span>
      <span class="c1">#e.P2[0] = max(reduced_range)</span>
      <span class="c1">#e.P2[1] = max(reduced_range)</span>
      
      <span class="c1">#f = FDTDobj.addFrequencySnapshot(&#39;Z&#39;,pos)</span>
      <span class="c1">#f.name = NAME + &#39;.freq&#39;</span>
      <span class="c1">#f.first = arguments.first</span>
      <span class="c1">#f.repetition = arguments.repetition</span>
      <span class="c1">#f.frequency_vector = frequency_vector</span>
      
      <span class="n">F</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">FrequencySnapshot</span><span class="p">()</span>
      <span class="n">F</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span> <span class="o">+</span> <span class="s1">&#39;.freq&#39;</span>
      <span class="n">F</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>
      <span class="n">F</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">]</span>
      <span class="n">F</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="p">[</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">]</span>
      <span class="n">F</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">first</span>
      <span class="n">F</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">repetition</span>
      <span class="n">F</span><span class="o">.</span><span class="n">starting_sample</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">starting_sample</span>
      <span class="n">F</span><span class="o">.</span><span class="n">frequency_vector</span> <span class="o">=</span> <span class="n">frequency_vector</span>
      
      <span class="n">full_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
      
      <span class="c1">## and more quick hacks...</span>
      <span class="c1">#f.P1[0] = min(reduced_range)</span>
      <span class="c1">#f.P1[1] = min(reduced_range)</span>
      <span class="c1">#f.P2[0] = max(reduced_range)</span>
      <span class="c1">#f.P2[1] = max(reduced_range)</span>
      
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: invalid slicing direction : arguments.slicing_direction = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="c1">## temporary hack to rectify excitation direction</span>
  <span class="c1">#P1 = numpy.array(FDTDobj.excitation_list[0].P1)</span>
  <span class="c1">#P2 = numpy.array(FDTDobj.excitation_list[0].P2)</span>
  <span class="c1">#Pdiff = P2-P1</span>
  <span class="c1">#Pdiff = list(Pdiff)</span>
  <span class="c1">#exc_dir = Pdiff.index(max(Pdiff))</span>
  <span class="c1">#if exc_dir == 0:</span>
    <span class="c1">#FDTDobj.excitation_list[0].E = [1,0,0]</span>
  <span class="c1">#elif exc_dir == 1:</span>
    <span class="c1">#FDTDobj.excitation_list[0].E = [0,1,0]</span>
  <span class="c1">#elif exc_dir == 2:</span>
    <span class="c1">#FDTDobj.excitation_list[0].E = [0,0,1]</span>
  <span class="c1">#else:</span>
    <span class="c1">#print(&#39;ERROR: wrong exc_dir = &#39;+str(exc_dir)+&#39; Pdiff = &#39;+str(Pdiff), file=sys.stderr)</span>
    <span class="c1">#sys.exit(-1)</span>

  <span class="c1"># temporary hack to disable frequency snaphsots</span>
  <span class="c1">#FDTDobj.clearFrequencySnapshots()</span>
  <span class="c1">#FDTDobj.clearTimeSnapshots()</span>

  <span class="c1"># Add full X,Y,Z central snapshots for reference</span>
  <span class="n">pos</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">letter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="c1">#e = FDTDobj.addEpsilonSnapshot(letter,pos[i])</span>
    <span class="c1">#e.name = &#39;central.&#39;+letter+&#39;.eps&#39;</span>
    <span class="c1">#e.first = 1</span>
    <span class="c1">#e.repetition = FDTDobj.flag.iterations + 1 # So that only one epsilon snapshot is created. We don&#39;t need more.</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;central.&#39;</span><span class="o">+</span><span class="n">letter</span><span class="o">+</span><span class="s1">&#39;.fsnap&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">first</span>
    <span class="n">f</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">repetition</span>
    <span class="n">f</span><span class="o">.</span><span class="n">starting_sample</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">starting_sample</span>
    <span class="n">f</span><span class="o">.</span><span class="n">frequency_vector</span> <span class="o">=</span> <span class="n">frequency_vector</span>
    <span class="n">full_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="n">full_list</span><span class="p">)</span>
  <span class="n">list_1</span> <span class="o">=</span> <span class="n">full_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">full_list</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">list_2</span> <span class="o">=</span> <span class="n">full_list</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">full_list</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">full_list</span><span class="p">)]</span>
    
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
  
  <span class="c1"># hack: remove epsilon snapshots and probes to increase speed</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearEpsilonSnapshots</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearProbes</span><span class="p">()</span>
  
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="n">destdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;./part_1&#39;</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="n">list_1</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;$JOBDIR&#39;</span><span class="p">,</span> <span class="n">WALLTIME</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">)</span>

  <span class="n">destdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;./part_2&#39;</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">=</span> <span class="n">list_2</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">destdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;$JOBDIR&#39;</span><span class="p">,</span> <span class="n">WALLTIME</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">)</span>

  <span class="k">return</span></div>

<span class="c1"># .. todo:: nice default values for output dirs/basename</span>
<span class="c1"># .. todo:: support use of full epsilon snapshots, i.e. all epsilon values available for the full mesh</span>
<div class="viewcode-block" id="calculateModeVolume"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.calculateModeVolume">[docs]</a><span class="k">def</span> <span class="nf">calculateModeVolume</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="c1"># .. todo:: Finish this</span>
  <span class="c1"># NOTE: Add way to specify snapshots, epsilon/frequency snapshot pairs</span>

  <span class="c1"># read in mesh</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">meshfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No meshfile specified.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sim_mesh</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">meshfile</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>

  <span class="c1"># read in snapshot files from the various input files</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No infile(s) specified.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sim_in</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">sim_in</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">sim_in</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

  <span class="c1"># .. todo:: add path of file based on where it was read from</span>
  <span class="c1"># .. todo:: read in .prn files</span>
  <span class="c1"># calculate mode volume</span>

  <span class="n">snaplist</span> <span class="o">=</span> <span class="n">sim_in</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">numID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snaplist</span><span class="p">)):</span>
    <span class="n">snapshot</span> <span class="o">=</span> <span class="n">snaplist</span><span class="p">[</span><span class="n">numID</span><span class="p">]</span>
    <span class="c1">#print([&#39;x&#39;,&#39;y&#39;,&#39;z&#39;][snapshot.plane-1])</span>
    <span class="c1">#print(sim_in.flag.id_string)</span>
    <span class="n">fsnap_filename</span><span class="p">,</span> <span class="n">alphaID</span><span class="p">,</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">numID_to_alphaID_FrequencySnapshot</span><span class="p">(</span><span class="n">numID</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">snapshot</span><span class="o">.</span><span class="n">plane</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sim_in</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">id_string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">),</span> <span class="n">snap_time_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fsnap_filename</span><span class="p">)</span>
    <span class="n">esnap_filename</span><span class="p">,</span> <span class="n">alphaID</span><span class="p">,</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">brisFDTD_ID_info</span><span class="o">.</span><span class="n">numID_to_alphaID_EpsilonSnapshot</span><span class="p">(</span><span class="n">numID</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">snapshot</span><span class="o">.</span><span class="n">plane</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sim_in</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">id_string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">),</span> <span class="n">snap_time_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">esnap_filename</span><span class="p">)</span>
  
  <span class="c1">#if arguments.fsnapfiles is None:</span>
    <span class="c1">#arguments.fsnapfiles = sim_in.getFrequencySnapshots():</span>
  <span class="c1">#if arguments.esnapfiles is None:</span>
    <span class="c1">#arguments.esnapfiles = sim_in.getEpsilonSnapshots()</span>
    
  <span class="c1">#if len(arguments.fsnapfiles) != len(arguments.esnapfiles):</span>
    <span class="c1">#print(&#39;ERROR: number of frequency snapshots and epsilon snapshots do not match&#39;, file=sys.stderr)</span>
    <span class="c1">#sys.exit(-1)</span>
  <span class="c1">#else:</span>
    <span class="c1">#print(&#39;OK&#39;)</span>

  <span class="c1">#print(arguments.fsnapfiles)</span>
  <span class="c1">#print(arguments.esnapfiles)</span>
    
  <span class="k">return</span></div>

<div class="viewcode-block" id="addCentralXYZSnapshots"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.addCentralXYZSnapshots">[docs]</a><span class="k">def</span> <span class="nf">addCentralXYZSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No input file specified.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
  
  <span class="c1"># hack: remove epsilon snapshots and probes to increase speed</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearEpsilonSnapshots</span><span class="p">()</span>
  <span class="c1">#FDTDobj.clearProbes()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">()</span>
  
  <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getSizeAndResolution</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;res = &#39;</span><span class="p">,</span><span class="n">res</span><span class="p">)</span>
  
  <span class="n">frequency_vector</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">freqListFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">getFrequencies</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">freqListFile</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">wavelength_mum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">wavelength_mum</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">frequency_MHz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">frequency_vector</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">frequency_MHz</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_vector</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Great scot! You forgot to specify frequencies.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span>
  
  <span class="c1"># hack: Make sure there will be at least one long duration snapshot at the end</span>
  <span class="c1">#arguments.repetition = FDTDobj.flag.iterations - arguments.first</span>
    
  <span class="c1"># Add full X,Y,Z central snapshots</span>
  <span class="c1">#pos = FDTDobj.box.getCentro()</span>

  <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># another hack to get the defect position...</span>
  <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">geometry_object_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;defect&#39;</span><span class="p">:</span>
      <span class="n">pos</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
    <span class="n">letter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addFrequencySnapshot</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;central.&#39;</span><span class="o">+</span><span class="n">letter</span><span class="o">+</span><span class="s1">&#39;.fsnap&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">first</span>
    <span class="n">f</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">repetition</span>
    <span class="n">f</span><span class="o">.</span><span class="n">frequency_vector</span> <span class="o">=</span> <span class="n">frequency_vector</span>
    <span class="n">f</span><span class="o">.</span><span class="n">starting_sample</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">starting_sample</span>
    
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
  
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;$JOBDIR&#39;</span><span class="p">,</span> <span class="n">WALLTIME</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">)</span>

  <span class="k">return</span></div>
  
<div class="viewcode-block" id="clearOutputs"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.clearOutputs">[docs]</a><span class="k">def</span> <span class="nf">clearOutputs</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No infile specified.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
  
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearProbes</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">()</span>

  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;$JOBDIR&#39;</span><span class="p">,</span> <span class="n">WALLTIME</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">)</span>
  
  <span class="k">return</span></div>

<span class="c1"># .. todo:: no, really, there must be a better way to do this...</span>
<span class="c1"># .. todo:: Also, rewrite in-place? Read some args from shellscript? (would require shellscript parser essentially...)</span>
<div class="viewcode-block" id="clearAllSnapshots"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.clearAllSnapshots">[docs]</a><span class="k">def</span> <span class="nf">clearAllSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No infile specified.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
  
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">()</span>

  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="c1">#FDTDobj.writeShellScript(arguments.outdir + os.path.sep + arguments.basename + &#39;.sh&#39;, arguments.basename, arguments.executable, &#39;$JOBDIR&#39;, WALLTIME = arguments.walltime)</span>
  
  <span class="k">return</span></div>

<div class="viewcode-block" id="addEpsilonSnapshots"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.addEpsilonSnapshots">[docs]</a><span class="k">def</span> <span class="nf">addEpsilonSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No infile specified.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>

  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    
  <span class="c1">#FDTDobj.clearProbes()</span>
  <span class="c1">#FDTDobj.clearAllSnapshots()</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span>
  
  <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getSizeAndResolution</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;res = &#39;</span><span class="p">,</span><span class="n">res</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># take the direction with the smallest number of snapshots to reduce number of generated .prn files</span>
    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">res</span><span class="p">))]</span>
  
  <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;Epsilon&#39;</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span>
      <span class="n">e</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">e</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># So that only one epsilon snapshot is created. We don&#39;t need more.</span>
  <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span>
      <span class="n">e</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">e</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># So that only one epsilon snapshot is created. We don&#39;t need more.</span>
  <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
    <span class="n">pos_list</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pos_list</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">addEpsilonSnapshot</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span>
      <span class="n">e</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">e</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># So that only one epsilon snapshot is created. We don&#39;t need more.      </span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: invalid slicing direction : arguments.slicing_direction = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">slicing_direction</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="c1">#FDTDobj.fileList = []</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearFileList</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="c1">#FDTDobj.writeShellScript(arguments.outdir + os.path.sep + arguments.basename + &#39;.sh&#39;, arguments.basename, arguments.executable, &#39;$JOBDIR&#39;, WALLTIME = arguments.walltime)</span>
  <span class="c1">#FDTDobj.writeInpFile(arguments.outdir + os.path.sep + arguments.basename + &#39;.inp&#39;)</span>
    
  <span class="k">return</span></div>

<div class="viewcode-block" id="FreqToEps"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.FreqToEps">[docs]</a><span class="k">def</span> <span class="nf">FreqToEps</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Convert frequency snapshots to epsilon snapshots. The original frequency snapshots are removed by default, but can be left if desired.&#39;&#39;&#39;</span>
  
  <span class="c1"># read in snapshot files from the various input files</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: No infile(s) specified.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="n">FDTDobj</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">BFDTDobject</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span>
  <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">arguments</span><span class="o">.</span><span class="n">infile</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">readBristolFDTD</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">leaveProbes</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearProbes</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">setIterations</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="n">oldlist</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">getFrequencySnapshots</span><span class="p">()</span>
  <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oldlist</span><span class="p">)):</span>
    <span class="n">snap</span> <span class="o">=</span> <span class="n">oldlist</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">namefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">arguments</span><span class="o">.</span><span class="n">namefilter</span> <span class="ow">in</span> <span class="n">snap</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
      <span class="n">eps</span> <span class="o">=</span> <span class="n">bfdtd</span><span class="o">.</span><span class="n">EpsilonSnapshot</span><span class="p">()</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ModeVolume.eps&#39;</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">plane</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">P1</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">P2</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">eps</span><span class="o">.</span><span class="n">repetition</span> <span class="o">=</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">newlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">leaveFrequencySnapshots</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearFrequencySnapshots</span><span class="p">()</span>
  
  <span class="c1"># append the epsilon snapshots to FDTDobj</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">snapshot_list</span> <span class="o">+=</span> <span class="n">newlist</span>
  
  <span class="c1"># Just leave one excitation. Should be enough to prevent crash and reduce running time.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">leaveExcitations</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">excitation_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">FDTDobj</span><span class="o">.</span><span class="n">excitation_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
  
  <span class="c1"># set up output path components</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: no outdir specified&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
  
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">clearFileList</span><span class="p">()</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">setFileBaseName</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
  <span class="n">FDTDobj</span><span class="o">.</span><span class="n">setWallTime</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">)</span>
  
  <span class="c1"># write files</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">no_act</span><span class="p">:</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeAll</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="n">FDTDobj</span><span class="o">.</span><span class="n">writeShellScript</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="n">EXE</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">overwrite</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.outdir = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">outdir</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.basename = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">basename</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.executable = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">executable</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.walltime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">walltime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.overwrite = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">overwrite</span><span class="p">))</span>
  
  <span class="k">return</span></div>

<div class="viewcode-block" id="get_argument_parser"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.get_argument_parser">[docs]</a><span class="k">def</span> <span class="nf">get_argument_parser</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;return an ArgumentParser object p with this module&#39;s options;</span>
<span class="sd">  with an additional dict attribute p._geniegui to specify</span>
<span class="sd">  &quot;special&quot; treatment (file/path dialogs) for some options.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># .. todo:: split options into read-only and read-write operations?</span>
  <span class="c1"># operations: read &amp; print info, copy, copy with changes, write back with changes, create shellscript, create .in file, etc</span>
  <span class="c1"># too many operations. Needs GUI!</span>
  
  <span class="c1"># command-line option handling</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Get info about bfdtd related files and/or process them in certain ways.&#39;</span><span class="p">,</span> <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span><span class="s1">&#39;--infile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;input file(s) (.geo, .inp or .in) (can be more than one)&#39;</span><span class="p">)</span>
  <span class="c1">#parser.add_argument(&#39;-i&#39;,&#39;--infile&#39;, action=&quot;store&quot;, help=&#39;input file (.geo, .inp or .in)&#39;)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;verbosity level&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--BFDTDreader-verbosity&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;verbosity level of the BFDTD reader&#39;</span><span class="p">)</span>

  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span><span class="s1">&#39;--outfile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;outfile&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output file&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span><span class="s1">&#39;--outdir&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output directory&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="s1">&#39;--basename&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;basename&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output basename&#39;</span><span class="p">)</span>

  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--walltime&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;walltime in hours (default: 360 hours = 15*24 hours = 15 days)&#39;</span><span class="p">)</span>
  
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--format&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;FORMAT&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FORMAT&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Use FORMAT as the format string that controls the output.&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;iterations=</span><span class="si">{iterations}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="c1">#parser.add_argument(&#39;FORMAT&#39;, nargs=&#39;?&#39;, metavar=&#39;FORMAT&#39;, help=&#39;formatting string&#39;, default=&#39;timestep = {dt}\niterations = {iterations}\ntotal_time = {total_time}\nfmin = {fmin[0]}\nfcen = {fcen[0]}\nfmax = {fmax[0]}\nlambda_min = {lmin[0]}\nlambda_cen = {lcen[0]}\nlambda_max = {lmax[0]}&#39;)</span>

  <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Available subcommands&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;chosen_subcommand&#39;</span><span class="p">)</span>
  
  <span class="c1"># parser for printExcitation</span>
  <span class="n">parser_printExcitation</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;printExcitation&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out the Excitation objects&#39;</span><span class="p">)</span>
  <span class="n">parser_printExcitation</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">printExcitation</span><span class="p">)</span>

  <span class="c1"># parser for printExcitationDirection</span>
  <span class="n">parser_printExcitationDirection</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;printExcitationDirection&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out the directions of excitation objects&#39;</span><span class="p">)</span>
  <span class="n">parser_printExcitationDirection</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">printExcitationDirection</span><span class="p">)</span>

  <span class="c1"># parser for printFrequencySnapshotInfo</span>
  <span class="n">parser_printFrequencySnapshotInfo</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;printFrequencySnapshotInfo&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print information about the frequency snapshots&#39;</span><span class="p">)</span>
  <span class="n">parser_printFrequencySnapshotInfo</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">printFrequencySnapshotInfo</span><span class="p">)</span>
  
  <span class="c1"># parser for printAll</span>
  <span class="n">parser_printAll</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;printAll&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out all information&#39;</span><span class="p">)</span>
  <span class="n">parser_printAll</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">printAll</span><span class="p">)</span>

  <span class="c1"># parser for FreqToEps</span>
  <span class="n">parser_FreqToEps</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;FreqToEps&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Convert frequency to epsilon snapshots.&#39;</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">FreqToEps</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--leaveProbes&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not remove probe entries (default: False).&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--leaveFrequencySnapshots&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not remove frequency snapshot entries (default: False).&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--leaveExcitations&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not remove excitation entries (default: False). Note that one excitation will always be left for the simulation to run.&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-act&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;no_act&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not write output files. Just show what would be written.&quot;</span><span class="p">)</span>
  <span class="n">parser_FreqToEps</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Overwrite existing files. (default: False)&quot;</span><span class="p">)</span>

  <span class="c1"># excitation + timestep info (useful for probe analysis)</span>
  <span class="n">parser_printFormattedString</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;printFormattedString&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out formatted information&#39;</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">        Print out formatted information.</span>
<span class="s1">        </span>
<span class="s1">        Usage:</span>
<span class="s1">          bfdtd_tool.py -i qedc3_2_05.in -f FORMAT printFormattedString</span>

<span class="s1">        FORMAT controls the output.  Interpreted &quot;replacement fields&quot; are:</span>

<span class="s1">          dt : the timestep used by the simulation</span>
<span class="s1">          iterations : number of iterations</span>
<span class="s1">          total_time : total simulation time</span>

<span class="s1">          fmin[n] : the minimum frequency of the nth excitation</span>
<span class="s1">          fcen[n] : the central frequency of the nth excitation</span>
<span class="s1">          fmax[n] : the maximum frequency of the nth excitation</span>
<span class="s1">          lmin[n] : the minimum wavelength of the nth excitation</span>
<span class="s1">          lcen[n] : the central wavelength of the nth excitation</span>
<span class="s1">          lmax[n] : the maximum wavelength of the nth excitation</span>
<span class="s1">          eloc[n] : the location of the nth excitation</span>

<span class="s1">        Example format strings:</span>
<span class="s1">          &#39;timestep=</span><span class="si">{dt:.2f}</span><span class="s1"> fmin=</span><span class="si">{fmin[0]:.3e}</span><span class="s1"> fcen=</span><span class="si">{fcen[0]}</span><span class="s1"> fmax=</span><span class="si">{fmax[0]:.0f}</span><span class="s1"> lambda_min=</span><span class="si">{lmin[0]}</span><span class="s1"> lambda_cen=</span><span class="si">{lcen[0]}</span><span class="s1"> lambda_max=</span><span class="si">{lmax[0]}</span><span class="s1">&#39;</span>
<span class="s1">          &#39;timestep=</span><span class="si">{dt:.2f}</span><span class="s1"> iterations=</span><span class="si">{iterations}</span><span class="s1"> total_time={total_time:.f}&#39;</span>
<span class="s1">          &#39;</span><span class="si">{eloc[0][0]}</span><span class="s1"> </span><span class="si">{eloc[0][1]}</span><span class="s1"> </span><span class="si">{eloc[0][2]}</span><span class="s1">&#39;</span>
<span class="s1">      &#39;&#39;&#39;</span><span class="p">)</span>
  <span class="n">parser_printFormattedString</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">printFormattedString</span><span class="p">)</span>
  <span class="c1">#parser_printFormattedString.add_argument(&#39;FORMAT&#39;, nargs=&#39;?&#39;, metavar=&#39;FORMAT&#39;, help=&#39;formatting string&#39;, default=&#39;timestep = {dt}\niterations = {iterations}\ntotal_time = {total_time}\nfmin = {fmin[0]}\nfcen = {fcen[0]}\nfmax = {fmax[0]}\nlambda_min = {lmin[0]}\nlambda_cen = {lcen[0]}\nlambda_max = {lmax[0]}&#39;)</span>
  
  <span class="c1">#group = parser.add_mutually_exclusive_group()</span>
  <span class="c1">#group.add_argument(&#39;--foo&#39;, action=&#39;store_true&#39;)</span>
  <span class="c1">#group.add_argument(&#39;--bar&#39;, action=&#39;store_false&#39;)</span>
  
  <span class="c1">#subparsers = parser.add_subparsers(help=&#39;functions&#39;,dest=&#39;subparser_name&#39;)</span>
  <span class="c1">#modevolume_parser = subparsers.add_parser(&#39;modevolume&#39;, help=&#39;Add frequency snapshots to calculate the mode volume&#39;)</span>
  <span class="c1">#modevolume_parser.add_argument(&#39;--slicing-direction&#39;, choices=[&#39;X&#39;,&#39;Y&#39;,&#39;Z&#39;])</span>

  <span class="c1">#tmp_parser = subparsers.add_parser(&#39;lol&#39;, help=&#39;lalalala&#39;)</span>
  <span class="c1">#tmp_parser.add_argument(&#39;--slicing-death&#39;, choices=[&#39;Xoxo&#39;,&#39;Yoyo&#39;,&#39;Zozo&#39;], help=&#39;lol you are LEAKING!&#39;)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Read-only operations&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-N&#39;</span><span class="p">,</span><span class="s1">&#39;--ncells&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_Ncells&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print the number of cells&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--printSnapshotFrequencyList&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;printSnapshotFrequencyList&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out a list of frequencies used in frequency snapshots&#39;</span><span class="p">)</span>
  
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--id&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;id_list&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;ID(s) of the object(s) you want to print out.&#39;</span><span class="p">)</span>
  
  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Writing operations&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--writeInpFile&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;create .inp file based on all the specified input&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">)</span>
  
  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Add mode volume snapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--add-modevolume-snapshots&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Add frequency snapshots to calculate the mode volume&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--slicing-direction&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;slicing_direction&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--first&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3200</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;first iteration at which to take snapshot&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--repetition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">32000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;step in number of iterations at which to take snapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--starting_sample&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">6400</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;starting sample for the snapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--iterations&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of iterations&#39;</span><span class="p">)</span> <span class="c1"># previous default: 67200</span>
  <span class="c1"># .. todo:: Make linebreaks work in CLI help. :(</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--freqListFile&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">                                                            frequency list file</span>
<span class="s1">                                                            format:</span>
<span class="s1">                                                            PeakNo	Frequency(Hz)	Wavelength(nm)	QFactor</span>
<span class="s1">                                                            1	4.7257745e+14	634.37741293	40.4569</span>
<span class="s1">                                                            2	4.9540615e+14	605.14480606	90.37&#39;&#39;&#39;</span><span class="p">)</span>

  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--readFreqFromInput&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;read frequencies from input&#39;</span><span class="p">)</span>

  <span class="c1"># .. todo:: default args should probably be gotten from the various classes</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--exe&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;EXE&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;executable&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;exe to use&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;fdtd&#39;</span><span class="p">)</span>

  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--frequency_MHz&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;frequency in MHz&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;f(MHz)&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--wavelength_mum&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;wavelength in µm&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;lambda(µm)&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Calculate mode volume (NOT YET WORKING!!!)&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--calc-modevolume&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Calculate the mode volume (NOT YET WORKING!!!)&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;calc_modevolume&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--fsnapfiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FSNAP&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Frequency snapshots to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tsnapfiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;TSNAP&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Time snapshots to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--esnapfiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;ESNAP&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Epsilon snapshots to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--msnapfiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;MSNAP&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Mode filtered probes to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--probefiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PROBE&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Probes to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--prnfiles&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PRN&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;.prn files to use&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--namefilter&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;string to look for in object names&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--meshfile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;INP&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;.inp file containing the mesh to use&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;addCentralXYZSnapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--addCentralXYZSnapshots&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;addCentralXYZSnapshots&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;addCentralXYZSnapshots&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;clearAllOutput&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--clearAllOutput&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;clearAllOutput&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;clearAllOutput&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  
  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;addEpsilonSnapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--addEpsilonSnapshots&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;addEpsilonSnapshots&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;addEpsilonSnapshots&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;clearOutputs&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--clearOutputs&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;clearOutputs&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;clearOutputs&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;clearAllSnapshots&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--clearAllSnapshots&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;clearAllSnapshots&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;clearAllSnapshots&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Rotate&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="s1">&#39;--rotate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;rotate&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Rotate the geometry.&#39;</span><span class="p">)</span>
  <span class="c1">#axis_point</span>
  <span class="c1">#axis_direction</span>
  <span class="c1">#angle_degrees</span>

  <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;Meshing&#39;</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span><span class="s1">&#39;--mesh&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Automatically mesh the geometry.&#39;</span><span class="p">)</span>

  <span class="c1"># .. todo:: for later use :)</span>
  <span class="c1">#parser.add_argument(&quot;--path&quot;,&quot;-p&quot;, default=&quot;&quot;,</span>
                 <span class="c1">#help = &quot;project path (directory) containing an .sff file&quot;)</span>
  <span class="c1">#parser._geniegui = dict()</span>
  <span class="c1">#parser._geniegui[&quot;--path&quot;] = &quot;dir&quot;</span>
  <span class="k">return</span> <span class="n">parser</span></div>

<span class="c1"># .. todo:: Add PPN specification option?</span>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[]):</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">get_argument_parser</span><span class="p">()</span>

  <span class="c1"># use graphical dialogs if no arguments are given</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">open_dialog</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">filedialog</span><span class="o">.</span><span class="n">Open</span><span class="p">()</span>

    <span class="c1"># options (all have default values):</span>
    <span class="c1">#</span>
    <span class="c1"># - defaultextension: added to filename if not explicitly given</span>
    <span class="c1">#</span>
    <span class="c1"># - filetypes: sequence of (label, pattern) tuples.  the same pattern</span>
    <span class="c1">#   may occur with several patterns.  use &quot;*&quot; as pattern to indicate</span>
    <span class="c1">#   all files.</span>
    <span class="c1">#</span>
    <span class="c1"># - initialdir: initial directory.  preserved by dialog instance.</span>
    <span class="c1">#</span>
    <span class="c1"># - initialfile: initial file (ignored by the open dialog).  preserved</span>
    <span class="c1">#   by dialog instance.</span>
    <span class="c1">#</span>
    <span class="c1"># - parent: which window to place the dialog on top of</span>
    <span class="c1">#</span>
    <span class="c1"># - title: dialog title</span>
    <span class="c1">#</span>
    <span class="c1"># - multiple: if true user may select more than one file</span>
    <span class="c1">#</span>
    <span class="c1"># options for the directory chooser:</span>
    <span class="c1">#</span>
    <span class="c1"># - initialdir, parent, title: see above</span>
    <span class="c1">#</span>
    <span class="c1"># - mustexist: if true, user must pick an existing directory</span>
    <span class="c1">#</span>
    <span class="n">open_dialog</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Choose a .cfg file...&#39;</span>
    <span class="n">open_dialog</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;filetypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;configuration files&quot;</span><span class="p">,</span><span class="s2">&quot;*.cfg&quot;</span><span class="p">),(</span><span class="s2">&quot;all files&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)]</span>
    <span class="n">cfgfile</span> <span class="o">=</span> <span class="n">open_dialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">):</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="n">cfgfile</span><span class="p">]</span>

  <span class="n">arguments</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------&#39;</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="k">elif</span> <span class="s1">&#39;func&#39;</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span> <span class="c1"># if a sub-command has been chosen</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># if no sub-command has been chosen</span>
    <span class="c1"># .. todo:: implement this nicer way?:</span>
    <span class="c1">#  Only works if func has been defined (for example with subcommand and set_defaults())</span>
    <span class="c1">#  arguments.func(arguments)  # call the appropriate subcommand function</span>
    
    <span class="c1"># .. todo:: Some/most functions could be moved into the BFDTD object class</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeInpFile</span><span class="p">:</span>
      <span class="n">writeInpFile</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">print_Ncells</span><span class="p">:</span>
      <span class="n">printNcells</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">printSnapshotFrequencyList</span><span class="p">:</span>
      <span class="n">printSnapshotFrequencyList</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">add_modevolume_snapshots</span><span class="p">:</span>
      <span class="n">addModeVolumeFrequencySnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">calc_modevolume</span><span class="p">:</span>
      <span class="n">calculateModeVolume</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">addCentralXYZSnapshots</span><span class="p">:</span>
      <span class="n">addCentralXYZSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">clearAllOutput</span><span class="p">:</span>
      <span class="n">clearAllOutput</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">addEpsilonSnapshots</span><span class="p">:</span>
      <span class="n">addEpsilonSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">clearOutputs</span><span class="p">:</span>
      <span class="n">clearOutputs</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">clearAllSnapshots</span><span class="p">:</span>
      <span class="n">clearAllSnapshots</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="c1"># default action:</span>
    <span class="c1">#printAll(arguments)</span>
    <span class="n">printFormattedString</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="do_something"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.do_something">[docs]</a><span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">argparseuiinstance</span><span class="p">):</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">argparseuiinstance</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Options: &quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="main_argparseui"><a class="viewcode-back" href="../../bin.html#bin.bfdtd_tool.main_argparseui">[docs]</a><span class="k">def</span> <span class="nf">main_argparseui</span><span class="p">():</span>
  
  <span class="n">parser</span> <span class="o">=</span> <span class="n">get_argument_parser</span><span class="p">()</span>
  
  <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">argparseui</span><span class="o">.</span><span class="n">ArgparseUi</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span><span class="n">use_save_load_button</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ok_button_handler</span><span class="o">=</span><span class="n">do_something</span><span class="p">)</span>
  <span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c1"># Do what you like with the arguments...</span>
      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Cancel pressed&quot;</span><span class="p">)</span>
  <span class="k">return</span></div>
    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
  <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
  <span class="c1">#main_argparseui()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Mike Taverne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>