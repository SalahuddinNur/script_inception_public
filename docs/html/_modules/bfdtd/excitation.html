
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>bfdtd.excitation &#8212; script_inception_public  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for bfdtd.excitation</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span>

<span class="kn">import</span> <span class="nn">utilities</span>
<span class="kn">from</span> <span class="nn">utilities.common</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">constants.physcon</span> <span class="k">import</span> <span class="n">get_c0</span><span class="p">,</span> <span class="n">get_e</span><span class="p">,</span> <span class="n">get_eV</span><span class="p">,</span> <span class="n">get_epsilon0</span><span class="p">,</span> <span class="n">get_mu0</span><span class="p">,</span> <span class="n">get_h</span><span class="p">,</span> <span class="n">get_h_eVs</span><span class="p">,</span> <span class="n">get_hb</span><span class="p">,</span> <span class="n">get_me</span>

<span class="kn">from</span> <span class="nn">.meshobject</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.excitationTemplate</span> <span class="k">import</span> <span class="o">*</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Various type of Excitation objects, used for writing the excitations into the .inp file.</span>
<span class="sd">.. todo:: Check that MIN_TIME_OFFSET_TIME_CONSTANT_RATIO=3 is a sufficient condition.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span> <span class="o">=</span> <span class="mi">5</span>

<div class="viewcode-block" id="Excitation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation">[docs]</a><span class="k">class</span> <span class="nc">Excitation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  The base class for BFDTD excitations.</span>
<span class="sd">  </span>
<span class="sd">  When using a gaussian sinewave, undesired effects (part of the signal cut off) might happen, if the time offset is too small compared to the time constant.</span>
<span class="sd">  </span>
<span class="sd">  To prevent this, the writing procedure automatically checks if::</span>
<span class="sd">  </span>
<span class="sd">      MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant &gt; self.time_offset.</span>
<span class="sd">  </span>
<span class="sd">  If this is the case, there are 3 possible outcomes, depending on the value of **self.TimeOffsetSafetyBehaviour**:</span>

<span class="sd">  * self.TimeOffsetSafetyBehaviour=0 (the default): adapt the time offset by setting ``self.time_offset = MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant``</span>
<span class="sd">  * self.TimeOffsetSafetyBehaviour=1: raise an Exception</span>
<span class="sd">  * self.TimeOffsetSafetyBehaviour=2: ignore and continue writing</span>
<span class="sd">  </span>
<span class="sd">  .. note:: You can change MIN_TIME_OFFSET_TIME_CONSTANT_RATIO in interactive mode as follows: ``bfdtd.excitation.MIN_TIME_OFFSET_TIME_CONSTANT_RATIO=42``</span>
<span class="sd">  </span>
<span class="sd">  From MEEP documentation. Not fully implemented yet, but the plan is to clearly and accurately document the sources and make it easier to get exactly what we want.</span>
<span class="sd">  It is possible that BFDTD gaussian sources behave differently than MEEP sources.</span>
<span class="sd">  BFDTD sources do not seem to have a proper cutoff for instance, or at least not properly return to zero and stay there.</span>
<span class="sd">  </span>
<span class="sd">  .. note:: Units: Usually DISTANCE=1μm, so that frequencies are in MHz and times in μs.</span>
<span class="sd">  </span>
<span class="sd">  Gaussian source:</span>
<span class="sd">  </span>
<span class="sd">    A Gaussian-pulse source roughly proportional to exp( − iωt − (t − t0)^2 / (2*w^2)). cf MEEP documentation.</span>
<span class="sd">  </span>
<span class="sd">  Attributes:</span>
<span class="sd">  </span>
<span class="sd">  * frequency [number]:</span>
<span class="sd">  </span>
<span class="sd">      The center frequency f in units of (m/s)/DISTANCE (or ω in units of 2π*(m/s)/DISTANCE).</span>
<span class="sd">      </span>
<span class="sd">      No default value.</span>
<span class="sd">      </span>
<span class="sd">      You can instead specify:</span>
<span class="sd">      </span>
<span class="sd">        * wavelength = c0/f in units of DISTANCE</span>
<span class="sd">        * period = 1/f in units of DISTANCE/(m/s)</span>
<span class="sd">      </span>
<span class="sd">  * width [number]:</span>
<span class="sd">  </span>
<span class="sd">      The width w used in the Gaussian.</span>
<span class="sd">      No default value.</span>
<span class="sd">      You can instead specify:</span>
<span class="sd">      </span>
<span class="sd">      * fwidth x, which is a synonym for (width (/ 1 x)) (i.e. the frequency width is proportional to the inverse of the temporal width)      </span>
<span class="sd">      * FWHM_time</span>
<span class="sd">      * FWHM_frequency</span>
<span class="sd">      * FWHM_angular_frequency</span>
<span class="sd">      </span>
<span class="sd">  * start-time [number]:</span>
<span class="sd">  </span>
<span class="sd">      The starting time for the source; default is 0 (turn on at t = 0). (Not the time of the peak! See below.)</span>
<span class="sd">      You can instead specify:</span>
<span class="sd">      </span>
<span class="sd">      * end-time</span>
<span class="sd">      * peak-time</span>
<span class="sd">      </span>
<span class="sd">  * cutoff [number]:</span>
<span class="sd">  </span>
<span class="sd">      How many widths the current decays for before we cut it off and set it to zero—this applies for both turn-on and turn-off of the pulse.</span>
<span class="sd">      The default is 5.0.</span>
<span class="sd">      A larger value of cutoff will reduce the amount of high-frequency components that are introduced by the start/stop of the source,</span>
<span class="sd">      but will of course lead to longer simulation times.</span>
<span class="sd">      The peak of the gaussian is reached at the time t0= start-time + cutoff*width. </span>
<span class="sd">  </span>
<span class="sd">  .. todo:: check coherence between excitation_direction (templates) and E,H (excitation) attributes. Are both necessary? Leads to confusion.</span>
<span class="sd">  .. todo:: add centre/size/orientation options/attributes/methods to excitation, to make it easier to switch between orientations</span>
<span class="sd">  .. todo:: Improve documentation.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">current_source</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">P1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">P2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">E</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">Type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">time_constant</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">amplitude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">time_offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">frequency</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">param1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">param2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">template_filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">template_source_plane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">template_target_plane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">template_direction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">template_rotation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">layer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;excitation&#39;</span>
    <span class="k">if</span> <span class="n">current_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">current_source</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="k">if</span> <span class="n">P1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">P2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">E</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">time_constant</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">time_constant</span> <span class="o">=</span> <span class="mf">4.000000E-09</span> <span class="c1">#mus</span>
    <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">1.000000E+01</span> <span class="c1">#V/mum???</span>
    <span class="k">if</span> <span class="n">time_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">time_offset</span> <span class="o">=</span> <span class="mf">2.700000E-08</span> <span class="c1">#mus</span>
    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">frequency</span> <span class="o">=</span> <span class="n">get_c0</span><span class="p">()</span> <span class="c1"># in MHz, this corresponds to a wavelength of 1mum</span>
    <span class="k">if</span> <span class="n">param1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">param1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">param2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">param2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">template_source_plane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_source_plane</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">if</span> <span class="n">template_target_plane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_target_plane</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">if</span> <span class="n">template_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_direction</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">template_rotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_rotation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;excitation&#39;</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;excitation&#39;</span>

    <span class="c1"># read configuration options from a config file</span>
    <span class="c1"># if it does not exist, use defaults and create the config file</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">({</span>
                                          <span class="s1">&#39;SafetyChecks&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;AutoFix&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                                        <span class="p">})</span>
    
    <span class="n">configdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utilities</span><span class="o">.</span><span class="n">getuserdir</span><span class="o">.</span><span class="n">getuserdir</span><span class="p">(),</span> <span class="s1">&#39;.config&#39;</span><span class="p">,</span> <span class="s1">&#39;script_inception_public&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">configdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">configfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configdir</span><span class="p">,</span> <span class="s1">&#39;Excitation.ini&#39;</span><span class="p">)</span>
    <span class="c1">#print(&#39;configfile_name = &#39;, configfile_name)</span>
    <span class="n">configfiles_read</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">)</span>
    <span class="c1">#print(&#39;configfiles_read = &#39;, configfiles_read)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;SafetyChecks&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;AutoFix&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">configfiles_read</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No config file found. Creating </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">))</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="n">current_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">P1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">P2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span> <span class="o">=</span> <span class="n">time_constant</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">=</span> <span class="n">time_offset</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param1</span> <span class="o">=</span> <span class="n">param1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param2</span> <span class="o">=</span> <span class="n">param2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="n">template_filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span> <span class="o">=</span> <span class="n">template_source_plane</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span> <span class="o">=</span> <span class="n">template_target_plane</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span> <span class="o">=</span> <span class="n">template_direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span> <span class="o">=</span> <span class="n">template_rotation</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">meshing_parameters</span> <span class="o">=</span> <span class="n">MeshingParameters</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fixLowerUpperAtWrite</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">useForMeshing</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># set to False to disable use of this object during automeshing</span>
    
    <span class="c1"># .. todo:: deprecated, to be removed once a better safety/autofix system with adjustable reactions is put in place</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">TimeOffsetSafetyBehaviour</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Excitation.getName"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getName">[docs]</a>  <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Excitation.setEx"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setEx">[docs]</a>  <span class="k">def</span> <span class="nf">setEx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Excitation.setEy"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setEy">[docs]</a>  <span class="k">def</span> <span class="nf">setEy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Excitation.setEz"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setEz">[docs]</a>  <span class="k">def</span> <span class="nf">setEz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Excitation.getExcitedComponentNames"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getExcitedComponentNames">[docs]</a>  <span class="k">def</span> <span class="nf">getExcitedComponentNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Hx&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Hy&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Excitation.setName"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setName">[docs]</a>  <span class="k">def</span> <span class="nf">setName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Excitation.setWavelength"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setWavelength">[docs]</a>  <span class="k">def</span> <span class="nf">setWavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lambda_mum</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">lambda_mum</span></div>
<div class="viewcode-block" id="Excitation.setLambda"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setLambda">[docs]</a>  <span class="k">def</span> <span class="nf">setLambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lambda_mum</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;setLambda() is deprecated. Please use setWavelength() instead.&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWavelength</span><span class="p">(</span><span class="n">lambda_mum</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Excitation.setFrequency"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setFrequency">[docs]</a>  <span class="k">def</span> <span class="nf">setFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq_MHz</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_MHz</span></div>

<div class="viewcode-block" id="Excitation.setPeriod"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setPeriod">[docs]</a>  <span class="k">def</span> <span class="nf">setPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setFrequency</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">period</span><span class="p">)</span></div>

<div class="viewcode-block" id="Excitation.printInfo"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.printInfo">[docs]</a>  <span class="k">def</span> <span class="nf">printInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;StartTime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PeakTime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeakTime</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EndTime = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndTime</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Period = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WavelengthRange = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getWavelengthRange</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WavelengthCentral = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getWavelength</span><span class="p">()))</span></div>

  <span class="c1">#######</span>
  <span class="c1"># start, peak, end time settings, i.e. time offsets</span>
<div class="viewcode-block" id="Excitation.setTimeOffset"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setTimeOffset">[docs]</a>  <span class="k">def</span> <span class="nf">setTimeOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set the time offset.</span>
<span class="sd">    If *time_offset* is *None*, it adapts the time offset by setting ``self.time_offset = MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant``</span>
<span class="sd">    </span>
<span class="sd">    The time offset can be get/set using the following three alternatives:</span>
<span class="sd">    </span>
<span class="sd">    * StartTime = self.time_offset - MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant :</span>
<span class="sd">    </span>
<span class="sd">      * :py:func:`setStartTime`</span>
<span class="sd">      * :py:func:`getStartTime`</span>
<span class="sd">      </span>
<span class="sd">    * PeakTime = self.time_offset :</span>
<span class="sd">    </span>
<span class="sd">      * :py:func:`getPeakTime`</span>
<span class="sd">      * :py:func:`setPeakTime`</span>
<span class="sd">      </span>
<span class="sd">    * EndTime = self.time_offset + MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant :</span>
<span class="sd">    </span>
<span class="sd">      * :py:func:`getEndTime`</span>
<span class="sd">      * :py:func:`setEndTime`</span>

<span class="sd">    .. image:: /images/excitation_doc_annotated.png</span>
<span class="sd">       :align: center</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">time_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAdaptedTimeOffset</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">=</span> <span class="n">time_offset</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.getTimeOffset"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getTimeOffset">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span></div>
  
<div class="viewcode-block" id="Excitation.getAdaptedTimeOffset"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getAdaptedTimeOffset">[docs]</a>  <span class="k">def</span> <span class="nf">getAdaptedTimeOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns ``MIN_TIME_OFFSET_TIME_CONSTANT_RATIO*self.time_constant``</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Round up to 6 decimals to make sure it is bigger than the required min value after writing out files with &quot;{:E}&quot;.format(time_offset).</span>
<span class="sd">    </span>
<span class="sd">    cf :py:func:`setTimeOffset`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">new_time_offset</span> <span class="o">=</span> <span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span>
    <span class="c1">#exponent = np.floor(np.log10(np.abs(x)))</span>
    <span class="c1">#mantissa = </span>
    <span class="k">return</span><span class="p">(</span><span class="n">new_time_offset</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.getStartTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getStartTime">[docs]</a>  <span class="k">def</span> <span class="nf">getStartTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeakTime</span><span class="p">()</span> <span class="o">-</span> <span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">())</span></div>
  
<div class="viewcode-block" id="Excitation.getPeakTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getPeakTime">[docs]</a>  <span class="k">def</span> <span class="nf">getPeakTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">()</span></div>
  
<div class="viewcode-block" id="Excitation.getEndTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getEndTime">[docs]</a>  <span class="k">def</span> <span class="nf">getEndTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeakTime</span><span class="p">()</span> <span class="o">+</span> <span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="Excitation.setStartTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setStartTime">[docs]</a>  <span class="k">def</span> <span class="nf">setStartTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setPeakTime</span><span class="p">(</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">())</span></div>

<div class="viewcode-block" id="Excitation.setPeakTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setPeakTime">[docs]</a>  <span class="k">def</span> <span class="nf">setPeakTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak_time</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setTimeOffset</span><span class="p">(</span><span class="n">peak_time</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.setEndTime"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setEndTime">[docs]</a>  <span class="k">def</span> <span class="nf">setEndTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_time</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; cf :py:func:`setTimeOffset` &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setPeakTime</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">())</span></div>
    
  <span class="c1">#######</span>
  
<div class="viewcode-block" id="Excitation.setTimeConstant"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setTimeConstant">[docs]</a>  <span class="k">def</span> <span class="nf">setTimeConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_constant</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span> <span class="o">=</span> <span class="n">time_constant</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Excitation.setFrequencyRange"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setFrequencyRange">[docs]</a>  <span class="k">def</span> <span class="nf">setFrequencyRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">autofix</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets central frequency and frequency width so that the FFT of the pulse covers from fmin to fmax.</span>
<span class="sd">    </span>
<span class="sd">    Formulas used:</span>
<span class="sd">    </span>
<span class="sd">      * frequency = 0.5*(fmin+fmax)</span>
<span class="sd">      * time_constant = 1/(4*(fmax-fmin))</span>
<span class="sd">    </span>
<span class="sd">    .. todo:: Explain what exactly it means for the FFT (FWHM or other?).</span>
<span class="sd">    .. todo:: Make it equivalent to fwidth setting in MEEP.</span>
<span class="sd">    .. todo:: Add a warning if the user is trying to make the frequency range too wide (which leads to not really oscillating source since time width will be smaller than sine period).</span>
<span class="sd">    .. todo:: Add warning if the time offset is to short OR set the time offset as well...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fmin</span> <span class="o">+</span> <span class="n">fmax</span><span class="p">)</span>
    <span class="n">deltaFreq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fmax</span> <span class="o">-</span> <span class="n">fmin</span><span class="p">)</span>
    
    <span class="c1">#if f0 &lt; 4*deltaFreq:</span>
      <span class="c1">#print(&#39;ERROR: f0={} &lt; 4*deltaFreq={}&#39;.format(f0, 4*deltaFreq))</span>
    <span class="k">if</span> <span class="n">f0</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">*</span><span class="n">deltaFreq</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">deltaFreq</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">f0</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">fa</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">-</span> <span class="n">D</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">+</span> <span class="n">D</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">autofix</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setFrequencyRange</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">autofix</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Specified frequency range is too large.</span>
<span class="s1">            f0=</span><span class="si">{}</span><span class="s1"> &lt; 4*|fmax-fmin|=</span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            Make sure that 4*|fmax-fmin| &lt; f0=(fmax+fmin)/2.</span>
<span class="s1">            fmin = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            fmax = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            f0 = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            |fmax-fmin| = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            Try:</span>
<span class="s1">              fmin = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">              fmax = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">deltaFreq</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">deltaFreq</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">fb</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Specified frequency range is slighty too big, but close enough: f0=</span><span class="si">{}</span><span class="s1"> &lt; 4*deltaFreq=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">deltaFreq</span><span class="p">))</span>
      
    <span class="bp">self</span><span class="o">.</span><span class="n">setFrequency</span><span class="p">(</span> <span class="n">f0</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setTimeConstant</span><span class="p">(</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">deltaFreq</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">checkPeriodvsTimeConstant</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.setWavelengthRange"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setWavelengthRange">[docs]</a>  <span class="k">def</span> <span class="nf">setWavelengthRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lambda_min</span><span class="p">,</span> <span class="n">lambda_max</span><span class="p">):</span>
    <span class="n">fmax</span> <span class="o">=</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">lambda_min</span>
    <span class="n">fmin</span> <span class="o">=</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">lambda_max</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setFrequencyRange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.getFrequencyRange"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getFrequencyRange">[docs]</a>  <span class="k">def</span> <span class="nf">getFrequencyRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">()</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">df</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.getFrequencyMin"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getFrequencyMin">[docs]</a>  <span class="k">def</span> <span class="nf">getFrequencyMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencyRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fmin</span></div>
  
<div class="viewcode-block" id="Excitation.getFrequencyMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getFrequencyMax">[docs]</a>  <span class="k">def</span> <span class="nf">getFrequencyMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencyRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fmax</span></div>

<div class="viewcode-block" id="Excitation.getWavelengthRange"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getWavelengthRange">[docs]</a>  <span class="k">def</span> <span class="nf">getWavelengthRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencyRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">fmax</span><span class="p">,</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">fmin</span><span class="p">)</span></div>

<div class="viewcode-block" id="Excitation.getWavelengthMin"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getWavelengthMin">[docs]</a>  <span class="k">def</span> <span class="nf">getWavelengthMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencyRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">fmax</span></div>

<div class="viewcode-block" id="Excitation.getWavelengthMax"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getWavelengthMax">[docs]</a>  <span class="k">def</span> <span class="nf">getWavelengthMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrequencyRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="n">fmin</span></div>

<div class="viewcode-block" id="Excitation.setAmplitude"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setAmplitude">[docs]</a>  <span class="k">def</span> <span class="nf">setAmplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="Excitation.getWavelength"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getWavelength">[docs]</a>  <span class="k">def</span> <span class="nf">getWavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span></div>

<div class="viewcode-block" id="Excitation.getLambda"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getLambda">[docs]</a>  <span class="k">def</span> <span class="nf">getLambda</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;getLambda() is deprecated. Please use getWavelength() instead.&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWavelength</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Excitation.getFrequency"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getFrequency">[docs]</a>  <span class="k">def</span> <span class="nf">getFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span></div>

<div class="viewcode-block" id="Excitation.getPeriod"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getPeriod">[docs]</a>  <span class="k">def</span> <span class="nf">getPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">())</span></div>

<div class="viewcode-block" id="Excitation.getAmplitude"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getAmplitude">[docs]</a>  <span class="k">def</span> <span class="nf">getAmplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span></div>

<div class="viewcode-block" id="Excitation.getTimeConstant"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getTimeConstant">[docs]</a>  <span class="k">def</span> <span class="nf">getTimeConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span></div>
    
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ret</span>  <span class="o">=</span> <span class="s1">&#39;name = &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;current_source = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_source</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;P1 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;P2 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;E = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;H = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;Type = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;time_constant = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;amplitude = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;time_offset = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;frequency = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;param1 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;param2 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;template_filename = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;template_source_plane = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;template_target_plane = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;template_direction = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
    <span class="s1">&#39;template_rotation = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
    
<div class="viewcode-block" id="Excitation.getExtension"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getExtension">[docs]</a>  <span class="k">def</span> <span class="nf">getExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Excitation.setExtension"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setExtension">[docs]</a>  <span class="k">def</span> <span class="nf">setExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">P1</span><span class="p">,</span><span class="n">P2</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">fixLowerUpper</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Excitation.getLocation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getLocation">[docs]</a>  <span class="k">def</span> <span class="nf">getLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span></div>

<div class="viewcode-block" id="Excitation.setLocation"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setLocation">[docs]</a>  <span class="k">def</span> <span class="nf">setLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCentro</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Excitation.getCentro"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getCentro">[docs]</a>  <span class="k">def</span> <span class="nf">getCentro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Excitation.getSize"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getSize">[docs]</a>  <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span> <span class="o">-</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Excitation.setSize"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setSize">[docs]</a>  <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_vec3</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
    <span class="n">size_vec3</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">size_vec3</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">size_vec3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">size_vec3</span>
    <span class="k">return</span> <span class="n">size_vec3</span></div>
    
<div class="viewcode-block" id="Excitation.setCentro"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.setCentro">[docs]</a>  <span class="k">def</span> <span class="nf">setCentro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nova_centro</span><span class="p">):</span>
    <span class="n">nova_centro</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">nova_centro</span><span class="p">)</span>    
    <span class="n">nuna_centro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCentro</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">nova_centro</span> <span class="o">-</span> <span class="n">nuna_centro</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nova_centro</span></div>
    
<div class="viewcode-block" id="Excitation.translate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.translate">[docs]</a>  <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">)</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="n">vec3</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span> <span class="o">+</span> <span class="n">array</span><span class="p">(</span><span class="n">vec3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vec3</span></div>
    
<div class="viewcode-block" id="Excitation.read_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.read_entry">[docs]</a>  <span class="k">def</span> <span class="nf">read_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entry</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">float_array</span><span class="p">([</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">int_array</span><span class="p">([</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">int_array</span><span class="p">([</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">param1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">param2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="Excitation.check"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.check">[docs]</a>  <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks the excitation for common mistakes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">checkPeriodvsTimeConstant</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      
    <span class="c1"># check that start time is positive</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;self.getStartTime()=</span><span class="si">{}</span><span class="s1"> &lt; 0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStartTime</span><span class="p">()))</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="Excitation.checkPeriodvsTimeConstant"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.checkPeriodvsTimeConstant">[docs]</a>  <span class="k">def</span> <span class="nf">checkPeriodvsTimeConstant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># check that Period &lt;= TimeConstant</span>
    <span class="c1">#</span>
    <span class="c1"># The 1e-6 part is a hack to deal with the limited number of digits in the ASCII input files.</span>
    <span class="c1"># Do this properly using the decimal module and/or math.isclose. cf: https://stackoverflow.com/questions/5595425/what-is-the-best-way-to-compare-floats-for-almost-equality-in-python</span>
    <span class="c1"># .. todo:: finish testing by writing, then reading.</span>
    
    <span class="c1">#if self.getPeriod() &gt; self.getTimeConstant():</span>
      <span class="c1">#if not math.isclose(self.getPeriod(), self.getTimeConstant()):</span>
        <span class="c1">#raise Exception(&#39;NEW: self.getPeriod()={} &gt; self.getTimeConstant()={}&#39;.format(self.getPeriod(), self.getTimeConstant()))</span>
        
    <span class="c1">#if self.getPeriod()/self.getTimeConstant() - 1 &gt; 1e-6:</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">():</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;self.getPeriod()=</span><span class="si">{}</span><span class="s1"> &gt; self.getTimeConstant()=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">())</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1">#print(&#39;self.getPeriod()/self.getTimeConstant() - 1 = {:e}&#39;.format(self.getPeriod()/self.getTimeConstant() - 1))</span>
        <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The period is slightly bigger than the time constant, but close enough: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">True</span></div>
  
<div class="viewcode-block" id="Excitation.fix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.fix">[docs]</a>  <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Automatically fix common mistakes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># fix time constant</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkPeriodvsTimeConstant</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: Setting time_constant = period = </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">()))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setTimeConstant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPeriod</span><span class="p">())</span>
    
    <span class="c1"># fix time offset</span>
    <span class="c1"># round min_time_offset before checking to avoid unnecessary warnings</span>
    <span class="n">min_time_offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">min_time_offset</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">():</span>
      <span class="n">default_message</span> <span class="o">=</span> <span class="s1">&#39;WARNING: ( </span><span class="si">{}</span><span class="s1">*time_constant = </span><span class="si">{}</span><span class="s1"> ) &gt; ( time_offset = </span><span class="si">{}</span><span class="s1"> ). cf documentation on self.TimeOffsetSafetyBehaviour.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="p">,</span> <span class="n">min_time_offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">())</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeOffsetSafetyBehaviour</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTimeOffset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAdaptedTimeOffset</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">default_message</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: Setting time_offset = </span><span class="si">{}</span><span class="s1">*time_constant = </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MIN_TIME_OFFSET_TIME_CONSTANT_RATIO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">()))</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeOffsetSafetyBehaviour</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">default_message</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">default_message</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>
  
<div class="viewcode-block" id="Excitation.disableSafetyChecks"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.disableSafetyChecks">[docs]</a>  <span class="k">def</span> <span class="nf">disableSafetyChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="kc">False</span></div>
  
<div class="viewcode-block" id="Excitation.enableSafetyChecks"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.enableSafetyChecks">[docs]</a>  <span class="k">def</span> <span class="nf">enableSafetyChecks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SafetyChecks</span> <span class="o">=</span> <span class="kc">True</span></div>
  
<div class="viewcode-block" id="Excitation.disableAutoFix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.disableAutoFix">[docs]</a>  <span class="k">def</span> <span class="nf">disableAutoFix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="kc">False</span></div>
  
<div class="viewcode-block" id="Excitation.enableAutoFix"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.enableAutoFix">[docs]</a>  <span class="k">def</span> <span class="nf">enableAutoFix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AutoFix</span> <span class="o">=</span> <span class="kc">True</span></div>
  
<div class="viewcode-block" id="Excitation.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">AutoFix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">SafetyChecks</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    write entry into FILE</span>
<span class="sd">    .. todo:: reduce code duplication here</span>
<span class="sd">    .. todo:: Should fix+check functions be called from BFDTDobject? Or should fix+check args be passed to write_entry? or should object&#39;s AutoFix/SafetyChecks be modified from BFDTDobject?</span>
<span class="sd">    </span>
<span class="sd">    Every function should do one thing and do it well -&gt; no fix+check in here</span>
<span class="sd">    Having fix+check in here reduces risk of accidental bad output writing -&gt; fix+check should be in here</span>
<span class="sd">    </span>
<span class="sd">    Writing bad output should be made difficult, but not too difficult for testing purposes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># autofix</span>
    <span class="k">if</span> <span class="n">AutoFix</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
    
    <span class="c1"># safety checks</span>
    <span class="k">if</span> <span class="n">SafetyChecks</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">!=</span> <span class="mi">11</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixLowerUpperAtWrite</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">fixLowerUpper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EXCITATION **name=</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> ** CURRENT SOURCE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_source</span><span class="p">))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **X1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **Y1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **Z1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **X2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **Y2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **Z2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **EX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **EY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **EZ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **HX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **HY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **HZ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> **GAUSSIAN MODULATED SINUSOID</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **TIME CONSTANT (mus if dimensions in mum)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeConstant</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **AMPLITUDE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAmplitude</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **TIME OFFSET (mus if dimensions in mum)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **FREQUENCY (MHz if dimensions in mum) (c0/f = </span><span class="si">{:E}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">(),</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">getFrequency</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **UNUSED PARAMETER</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param1</span><span class="p">))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **UNUSED PARAMETER</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param2</span><span class="p">))</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">:</span>
        <span class="c1"># template specific</span>
        <span class="c1"># NOTE: Adding these template parameters seems to have no effect with current_source!=11, but it makes sense to not write them if no template_filename has been defined.</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addDoubleQuotesIfMissing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ** TEMPLATE FILENAME</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addDoubleQuotesIfMissing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ** TEMPLATE SOURCE PLANE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">fixLowerUpper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;EXCITATION **name=&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> ** CURRENT SOURCE</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **X1</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **Y1</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **Z1</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **X2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **Y2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **Z2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **EX</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **EY</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **EZ</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **HX</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **HY</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **HZ</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **GAUSSIAN MODULATED SINUSOID</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **TIME CONSTANT</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_constant</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **AMPLITUDE</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:E}</span><span class="s2"> **TIME OFFSET</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeOffset</span><span class="p">()))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%E</span><span class="s2"> **FREQUENCY (MHz if dimensions in mum) (c0/f = </span><span class="si">%E</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">get_c0</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">))</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **UNUSED PARAMETER</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">param1</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> **UNUSED PARAMETER</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">param2</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">:</span>
        <span class="c1"># template specific</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addDoubleQuotesIfMissing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ** TEMPLATE FILENAME</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addDoubleQuotesIfMissing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ** TEMPLATE SOURCE PLANE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addDoubleQuotesIfMissing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ** TEMPLATE TARGET PLANE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> ** DIRECTION 0=-ve 1=+ve</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span><span class="p">)</span>
        <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> ** ROTATE 0=no, 1=yes</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Excitation.getMeshingParameters"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.Excitation.getMeshingParameters">[docs]</a>  <span class="k">def</span> <span class="nf">getMeshingParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xvec</span><span class="p">,</span><span class="n">yvec</span><span class="p">,</span><span class="n">zvec</span><span class="p">,</span><span class="n">epsx</span><span class="p">,</span><span class="n">epsy</span><span class="p">,</span><span class="n">epsz</span><span class="p">):</span>
    <span class="n">objx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">objy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">objz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">xvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xvec</span><span class="p">,</span><span class="n">objx</span><span class="p">])</span>
    <span class="n">yvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">yvec</span><span class="p">,</span><span class="n">objy</span><span class="p">])</span>
    <span class="n">zvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">zvec</span><span class="p">,</span><span class="n">objz</span><span class="p">])</span>
    <span class="n">epsx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">epsx</span><span class="p">,</span><span class="n">eps</span><span class="p">])</span>
    <span class="n">epsy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">epsy</span><span class="p">,</span><span class="n">eps</span><span class="p">])</span>
    <span class="n">epsz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">epsz</span><span class="p">,</span><span class="n">eps</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">xvec</span><span class="p">,</span><span class="n">yvec</span><span class="p">,</span><span class="n">zvec</span><span class="p">,</span><span class="n">epsx</span><span class="p">,</span><span class="n">epsy</span><span class="p">,</span><span class="n">epsz</span></div></div>

<div class="viewcode-block" id="ExcitationWithGaussianTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithGaussianTemplate">[docs]</a><span class="k">class</span> <span class="nc">ExcitationWithGaussianTemplate</span><span class="p">(</span><span class="n">Excitation</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">centre</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="n">sigma_x</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plane_direction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excitation_direction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_gaussian_template&#39;</span>
    <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_gaussian_template&#39;</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_gaussian_template&#39;</span>
    <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">centre</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sigma_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">sigma_x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">sigma_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">sigma_y</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">plane_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">plane_direction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">excitation_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">excitation_direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Exre&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">frequency</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">template_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_filename</span> <span class="o">=</span> <span class="s1">&#39;template.dat&#39;</span>
    <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshObject</span><span class="p">()</span>

    <span class="n">Excitation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sigma_x</span> <span class="o">=</span> <span class="n">sigma_x</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span> <span class="o">=</span> <span class="n">sigma_y</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
    
    <span class="c1"># the mesh is essential for template excitations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span> <span class="o">=</span> <span class="n">plane_direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_direction</span> <span class="o">=</span> <span class="n">excitation_direction</span> <span class="c1"># for the template generation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="n">template_filename</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># for the .inp file</span>

    <span class="c1"># set extension</span>
    <span class="n">plane_direction_vector</span><span class="p">,</span> <span class="n">plane_direction_alpha</span> <span class="o">=</span> <span class="n">getVecAlphaDirectionFromVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span><span class="p">)</span>
    <span class="n">diagonal</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plane_direction_vector</span><span class="p">)</span><span class="o">^</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="n">centre</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">diagonal</span><span class="p">,</span> <span class="n">centre</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">diagonal</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">updateTemplate</span><span class="p">()</span>
  
<div class="viewcode-block" id="ExcitationWithGaussianTemplate.getTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithGaussianTemplate.getTemplate">[docs]</a>  <span class="k">def</span> <span class="nf">getTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">updateTemplate</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span></div>
  
<div class="viewcode-block" id="ExcitationWithGaussianTemplate.updateTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithGaussianTemplate.updateTemplate">[docs]</a>  <span class="k">def</span> <span class="nf">updateTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># set up template</span>
    <span class="n">plane_direction_vector</span><span class="p">,</span> <span class="n">plane_direction_alpha</span> <span class="o">=</span> <span class="n">getVecAlphaDirectionFromVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span> <span class="o">=</span> <span class="n">plane_direction_alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span> <span class="o">=</span> <span class="n">plane_direction_alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">out_col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_direction</span>
  
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;y&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      
    <span class="n">column_titles</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Exre&#39;</span><span class="p">,</span><span class="s1">&#39;Exim&#39;</span><span class="p">,</span><span class="s1">&#39;Eyre&#39;</span><span class="p">,</span><span class="s1">&#39;Eyim&#39;</span><span class="p">,</span><span class="s1">&#39;Ezre&#39;</span><span class="p">,</span><span class="s1">&#39;Ezim&#39;</span><span class="p">,</span><span class="s1">&#39;Hxre&#39;</span><span class="p">,</span><span class="s1">&#39;Hxim&#39;</span><span class="p">,</span><span class="s1">&#39;Hyre&#39;</span><span class="p">,</span><span class="s1">&#39;Hyim&#39;</span><span class="p">,</span><span class="s1">&#39;Hzre&#39;</span><span class="p">,</span><span class="s1">&#39;Hzim&#39;</span><span class="p">])</span>

    <span class="c1"># set extension</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">ExcitationGaussian1</span><span class="p">(</span><span class="n">amplitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">beam_centre_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">beam_centre_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span>
    <span class="c1">#template = ExcitationGaussian2(amplitude = amplitude, beam_centre_x = x, beam_centre_y = y, c = 0, sigma = size, fileName=&#39;template.dat&#39;)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">y_list</span> <span class="o">=</span> <span class="n">y_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">out_col_name</span> <span class="o">=</span> <span class="n">out_col_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">column_titles</span> <span class="o">=</span> <span class="n">column_titles</span></div>
    
<div class="viewcode-block" id="ExcitationWithGaussianTemplate.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithGaussianTemplate.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">updateTemplate</span><span class="p">()</span>
    
    <span class="c1"># write the INP entry using the parent class</span>
    <span class="n">Excitation</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="p">)</span>
    
    <span class="c1"># write the template</span>
    <span class="c1">#print self.mesh</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">writeDatFile</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">FILE</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span> <span class="p">)</span></div></div>

<div class="viewcode-block" id="ExcitationWithUniformTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithUniformTemplate">[docs]</a><span class="k">class</span> <span class="nc">ExcitationWithUniformTemplate</span><span class="p">(</span><span class="n">Excitation</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">centre</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="n">amplitude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plane_direction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excitation_direction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_uniform_template&#39;</span>
    <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">layer</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_uniform_template&#39;</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;excitation_with_uniform_template&#39;</span>
    <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">centre</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">plane_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">plane_direction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">excitation_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">excitation_direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Exre&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">frequency</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">template_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">template_filename</span> <span class="o">=</span> <span class="s1">&#39;template.dat&#39;</span>
    <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshObject</span><span class="p">()</span>

    <span class="n">Excitation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
    
    <span class="c1"># the mesh is essential for template excitations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span> <span class="o">=</span> <span class="n">plane_direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excitation_direction</span> <span class="o">=</span> <span class="n">excitation_direction</span> <span class="c1"># for the template generation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="n">template_filename</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># for the .inp file</span>

    <span class="c1"># set extension</span>
    <span class="n">plane_direction_vector</span><span class="p">,</span> <span class="n">plane_direction_alpha</span> <span class="o">=</span> <span class="n">getVecAlphaDirectionFromVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span><span class="p">)</span>
    <span class="n">diagonal</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plane_direction_vector</span><span class="p">)</span><span class="o">^</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="n">centre</span> <span class="o">-</span> <span class="n">diagonal</span><span class="p">,</span> <span class="n">centre</span> <span class="o">+</span> <span class="n">diagonal</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">updateTemplate</span><span class="p">()</span>
  
<div class="viewcode-block" id="ExcitationWithUniformTemplate.getTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithUniformTemplate.getTemplate">[docs]</a>  <span class="k">def</span> <span class="nf">getTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">updateTemplate</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span></div>
  
<div class="viewcode-block" id="ExcitationWithUniformTemplate.updateTemplate"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithUniformTemplate.updateTemplate">[docs]</a>  <span class="k">def</span> <span class="nf">updateTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># set up template</span>
    <span class="n">plane_direction_vector</span><span class="p">,</span> <span class="n">plane_direction_alpha</span> <span class="o">=</span> <span class="n">getVecAlphaDirectionFromVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plane_direction</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">template_source_plane</span> <span class="o">=</span> <span class="n">plane_direction_alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_target_plane</span> <span class="o">=</span> <span class="n">plane_direction_alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_direction</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_rotation</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">out_col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_direction</span>
  
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;y&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getZmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">plane_direction_alpha</span><span class="o">==</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
      <span class="n">column_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">x_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getXmesh</span><span class="p">()</span>
      <span class="n">y_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getYmesh</span><span class="p">()</span>
      <span class="n">P1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">y_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      <span class="n">P2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x_list</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y_list</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
      
    <span class="n">column_titles</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Exre&#39;</span><span class="p">,</span><span class="s1">&#39;Exim&#39;</span><span class="p">,</span><span class="s1">&#39;Eyre&#39;</span><span class="p">,</span><span class="s1">&#39;Eyim&#39;</span><span class="p">,</span><span class="s1">&#39;Ezre&#39;</span><span class="p">,</span><span class="s1">&#39;Ezim&#39;</span><span class="p">,</span><span class="s1">&#39;Hxre&#39;</span><span class="p">,</span><span class="s1">&#39;Hxim&#39;</span><span class="p">,</span><span class="s1">&#39;Hyre&#39;</span><span class="p">,</span><span class="s1">&#39;Hyim&#39;</span><span class="p">,</span><span class="s1">&#39;Hzre&#39;</span><span class="p">,</span><span class="s1">&#39;Hzim&#39;</span><span class="p">])</span>

    <span class="c1"># set extension</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setExtension</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">ExcitationUniform</span><span class="p">(</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="p">)</span>
    <span class="c1">#template = ExcitationGaussian2(amplitude = amplitude, beam_centre_x = x, beam_centre_y = y, c = 0, sigma = size, fileName=&#39;template.dat&#39;)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">y_list</span> <span class="o">=</span> <span class="n">y_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">out_col_name</span> <span class="o">=</span> <span class="n">out_col_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">column_titles</span> <span class="o">=</span> <span class="n">column_titles</span></div>
    
<div class="viewcode-block" id="ExcitationWithUniformTemplate.write_entry"><a class="viewcode-back" href="../../bfdtd.html#bfdtd.excitation.ExcitationWithUniformTemplate.write_entry">[docs]</a>  <span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">updateTemplate</span><span class="p">()</span>
    
    <span class="c1"># write the INP entry using the parent class</span>
    <span class="n">Excitation</span><span class="o">.</span><span class="n">write_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FILE</span><span class="p">)</span>
    
    <span class="c1"># write the template</span>
    <span class="c1">#print self.mesh</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">writeDatFile</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">FILE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span><span class="p">)</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">script_inception_public  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Mike Taverne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>